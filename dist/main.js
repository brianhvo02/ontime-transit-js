!function(){"use strict";var t={m:{},u:function(t){return t+".js"}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&(e=n.currentScript.src),!e)){var i=n.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}(),t.b=document.baseURI||self.location.href,function(){const e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,n=Object.keys,i=Array.isArray;function r(t,e){return"object"!=typeof e||n(e).forEach((function(n){t[n]=e[n]})),t}"undefined"==typeof Promise||e.Promise||(e.Promise=Promise);const s=Object.getPrototypeOf,o={}.hasOwnProperty;function a(t,e){return o.call(t,e)}function l(t,e){"function"==typeof e&&(e=e(s(t))),("undefined"==typeof Reflect?n:Reflect.ownKeys)(e).forEach((n=>{u(t,n,e[n])}))}const h=Object.defineProperty;function u(t,e,n,i){h(t,e,r(n&&a(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function c(t){return{from:function(e){return t.prototype=Object.create(e.prototype),u(t.prototype,"constructor",t),{extend:l.bind(null,t.prototype)}}}}const d=Object.getOwnPropertyDescriptor;function f(t,e){let n;return d(t,e)||(n=s(t))&&f(n,e)}const g=[].slice;function p(t,e,n){return g.call(t,e,n)}function m(t,e){return e(t)}function _(t){if(!t)throw new Error("Assertion Failed")}function y(t){e.setImmediate?setImmediate(t):setTimeout(t,0)}function v(t,e){return t.reduce(((t,n,i)=>{var r=e(n,i);return r&&(t[r[0]]=r[1]),t}),{})}function w(t,e){if(a(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],i=0,r=e.length;i<r;++i){var s=w(t,e[i]);n.push(s)}return n}var o=e.indexOf(".");if(-1!==o){var l=t[e.substr(0,o)];return void 0===l?void 0:w(l,e.substr(o+1))}}function b(t,e,n){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){_("string"!=typeof n&&"length"in n);for(var r=0,s=e.length;r<s;++r)b(t,e[r],n[r])}else{var o=e.indexOf(".");if(-1!==o){var l=e.substr(0,o),h=e.substr(o+1);if(""===h)void 0===n?i(t)&&!isNaN(parseInt(l))?t.splice(l,1):delete t[l]:t[l]=n;else{var u=t[l];u&&a(t,l)||(u=t[l]={}),b(u,h,n)}}else void 0===n?i(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function x(t){var e={};for(var n in t)a(t,n)&&(e[n]=t[n]);return e}const E=[].concat;function C(t){return E.apply([],t)}const T="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map((t=>["Int","Uint","Float"].map((e=>e+t+"Array")))))).filter((t=>e[t])),R=T.map((t=>e[t]));v(T,(t=>[t,!0]));let P=null;function S(t){P="undefined"!=typeof WeakMap&&new WeakMap;const e=A(t);return P=null,e}function A(t){if(!t||"object"!=typeof t)return t;let e=P&&P.get(t);if(e)return e;if(i(t)){e=[],P&&P.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(A(t[n]))}else if(R.indexOf(t.constructor)>=0)e=t;else{const n=s(t);for(var o in e=n===Object.prototype?{}:Object.create(n),P&&P.set(t,e),t)a(t,o)&&(e[o]=A(t[o]))}return e}const{toString:I}={};function M(t){return I.call(t).slice(8,-1)}const k="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",L="symbol"==typeof k?function(t){var e;return null!=t&&(e=t[k])&&e.apply(t)}:function(){return null},O={};function F(t){var e,n,r,s;if(1===arguments.length){if(i(t))return t.slice();if(this===O&&"string"==typeof t)return[t];if(s=L(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const N="undefined"!=typeof Symbol?t=>"AsyncFunction"===t[Symbol.toStringTag]:()=>!1;var D="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function K(t,e){D=t,j=e}var j=()=>!0;const z=!new Error("").stack;function G(){if(z)try{throw G.arguments,new Error}catch(t){return t}return new Error}function B(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(j).map((t=>"\n"+t)).join("")):""}var q=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],U=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(q),Z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function X(t,e){this._e=G(),this.name=t,this.message=e}function V(t,e){return t+". Errors: "+Object.keys(e).map((t=>e[t].toString())).filter(((t,e,n)=>n.indexOf(t)===e)).join("\n")}function W(t,e,n,i){this._e=G(),this.failures=e,this.failedKeys=i,this.successCount=n,this.message=V(t,e)}function Y(t,e){this._e=G(),this.name="BulkError",this.failures=Object.keys(e).map((t=>e[t])),this.failuresByPos=e,this.message=V(t,e)}c(X).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+B(this._e,2))}},toString:function(){return this.name+": "+this.message}}),c(W).from(X),c(Y).from(X);var H=U.reduce(((t,e)=>(t[e]=e+"Error",t)),{});const $=X;var Q=U.reduce(((t,e)=>{var n=e+"Error";function i(t,i){this._e=G(),this.name=n,t?"string"==typeof t?(this.message=`${t}${i?"\n "+i:""}`,this.inner=i||null):"object"==typeof t&&(this.message=`${t.name} ${t.message}`,this.inner=t):(this.message=Z[e]||n,this.inner=null)}return c(i).from($),t[e]=i,t}),{});Q.Syntax=SyntaxError,Q.Type=TypeError,Q.Range=RangeError;var J=q.reduce(((t,e)=>(t[e+"Error"]=Q[e],t)),{}),tt=U.reduce(((t,e)=>(-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=Q[e]),t)),{});function et(){}function nt(t){return t}function it(t,e){return null==t||t===nt?e:function(n){return e(t(n))}}function rt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function st(t,e){return t===et?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var i=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?rt(i,this.onsuccess):i),r&&(this.onerror=this.onerror?rt(r,this.onerror):r),void 0!==s?s:n}}function ot(t,e){return t===et?e:function(){t.apply(this,arguments);var n=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?rt(n,this.onsuccess):n),i&&(this.onerror=this.onerror?rt(i,this.onerror):i)}}function at(t,e){return t===et?e:function(n){var i=t.apply(this,arguments);r(n,i);var s=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?rt(s,this.onsuccess):s),o&&(this.onerror=this.onerror?rt(o,this.onerror):o),void 0===i?void 0===a?void 0:a:r(i,a)}}function lt(t,e){return t===et?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function ht(t,e){return t===et?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var i=this,r=arguments.length,s=new Array(r);r--;)s[r]=arguments[r];return n.then((function(){return e.apply(i,s)}))}return e.apply(this,arguments)}}tt.ModifyError=W,tt.DexieError=X,tt.BulkError=Y;var ut={};const[ct,dt,ft]="undefined"==typeof Promise?[]:(()=>{let t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,s(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,s(e),t]})(),gt=dt&&dt.then,pt=ct&&ct.constructor,mt=!!ft;var _t=!1,yt=ft?()=>{ft.then(Gt)}:e.setImmediate?setImmediate.bind(null,Gt):e.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver((()=>{Gt(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Gt,0)},vt=function(t,e){St.push([t,e]),bt&&(yt(),bt=!1)},wt=!0,bt=!0,xt=[],Et=[],Ct=null,Tt=nt,Rt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ce,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((t=>{try{ce(t[0],t[1])}catch(t){}}))}},Pt=Rt,St=[],At=0,It=[];function Mt(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=et,this._lib=!1;var e=this._PSD=Pt;if(D&&(this._stackHolder=G(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==ut)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ft(this,this._value))}this._state=null,this._value=null,++e.ref,Ot(this,t)}const kt={get:function(){var t=Pt,e=$t;function n(n,i){var r=!t.global&&(t!==Pt||e!==$t);const s=r&&!ee();var o=new Mt(((e,o)=>{Dt(this,new Lt(he(n,t,r,s),he(i,t,r,s),e,o,t))}));return D&&zt(o,this),o}return n.prototype=ut,n},set:function(t){u(this,"then",t&&t.prototype===ut?kt:{get:function(){return t},set:kt.set})}};function Lt(t,e,n,i,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=i,this.psd=r}function Ot(t,e){try{e((e=>{if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&Bt();e&&"function"==typeof e.then?Ot(t,((t,n)=>{e instanceof Mt?e._then(t,n):e.then(t,n)})):(t._state=!0,t._value=e,Nt(t)),n&&qt()}}),Ft.bind(null,t))}catch(e){Ft(t,e)}}function Ft(t,e){if(Et.push(e),null===t._state){var n=t._lib&&Bt();e=Tt(e),t._state=!1,t._value=e,D&&null!==e&&"object"==typeof e&&!e._promise&&function(t,e,n){try{t.apply(null,void 0)}catch(t){}}((()=>{var n=f(e,"stack");e._promise=t,u(e,"stack",{get:()=>_t?n&&(n.get?n.get.apply(e):n.value):t.stack})})),function(t){xt.some((e=>e._value===t._value))||xt.push(t)}(t),Nt(t),n&&qt()}}function Nt(t){var e=t._listeners;t._listeners=[];for(var n=0,i=e.length;n<i;++n)Dt(t,e[n]);var r=t._PSD;--r.ref||r.finalize(),0===At&&(++At,vt((()=>{0==--At&&Ut()}),[]))}function Dt(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++At,vt(Kt,[n,t,e])}else t._listeners.push(e)}function Kt(t,e,n){try{Ct=e;var i,r=e._value;e._state?i=t(r):(Et.length&&(Et=[]),i=t(r),-1===Et.indexOf(r)&&function(t){for(var e=xt.length;e;)if(xt[--e]._value===t._value)return void xt.splice(e,1)}(e)),n.resolve(i)}catch(t){n.reject(t)}finally{Ct=null,0==--At&&Ut(),--n.psd.ref||n.psd.finalize()}}function jt(t,e,n){if(e.length===n)return e;var i="";if(!1===t._state){var r,s,o=t._value;null!=o?(r=o.name||"Error",s=o.message||o,i=B(o,0)):(r=o,s=""),e.push(r+(s?": "+s:"")+i)}return D&&((i=B(t._stackHolder,2))&&-1===e.indexOf(i)&&e.push(i),t._prev&&jt(t._prev,e,n)),e}function zt(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function Gt(){Bt()&&qt()}function Bt(){var t=wt;return wt=!1,bt=!1,t}function qt(){var t,e,n;do{for(;St.length>0;)for(t=St,St=[],n=t.length,e=0;e<n;++e){var i=t[e];i[0].apply(null,i[1])}}while(St.length>0);wt=!0,bt=!0}function Ut(){var t=xt;xt=[],t.forEach((t=>{t._PSD.onunhandled.call(null,t._value,t)}));for(var e=It.slice(0),n=e.length;n;)e[--n]()}function Zt(t){return new Mt(ut,!1,t)}function Xt(t,e){var n=Pt;return function(){var i=Bt(),r=Pt;try{return se(n,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{se(r,!1),i&&qt()}}}l(Mt.prototype,{then:kt,_then:function(t,e){Dt(this,new Lt(null,null,t,e,Pt))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return"function"==typeof e?this.then(null,(t=>t instanceof e?n(t):Zt(t))):this.then(null,(t=>t&&t.name===e?n(t):Zt(t)))},finally:function(t){return this.then((e=>(t(),e)),(e=>(t(),Zt(e))))},stack:{get:function(){if(this._stack)return this._stack;try{_t=!0;var t=jt(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{_t=!1}}},timeout:function(t,e){return t<1/0?new Mt(((n,i)=>{var r=setTimeout((()=>i(new Q.Timeout(e))),t);this.then(n,i).finally(clearTimeout.bind(null,r))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&u(Mt.prototype,Symbol.toStringTag,"Dexie.Promise"),Rt.env=oe(),l(Mt,{all:function(){var t=F.apply(null,arguments).map(ne);return new Mt((function(e,n){0===t.length&&e([]);var i=t.length;t.forEach(((r,s)=>Mt.resolve(r).then((n=>{t[s]=n,--i||e(t)}),n)))}))},resolve:t=>{if(t instanceof Mt)return t;if(t&&"function"==typeof t.then)return new Mt(((e,n)=>{t.then(e,n)}));var e=new Mt(ut,!0,t);return zt(e,Ct),e},reject:Zt,race:function(){var t=F.apply(null,arguments).map(ne);return new Mt(((e,n)=>{t.map((t=>Mt.resolve(t).then(e,n)))}))},PSD:{get:()=>Pt,set:t=>Pt=t},totalEchoes:{get:()=>$t},newPSD:Jt,usePSD:ae,scheduler:{get:()=>vt,set:t=>{vt=t}},rejectionMapper:{get:()=>Tt,set:t=>{Tt=t}},follow:(t,e)=>new Mt(((n,i)=>Jt(((e,n)=>{var i=Pt;i.unhandleds=[],i.onunhandled=n,i.finalize=rt((function(){!function(t){It.push((function e(){t(),It.splice(It.indexOf(e),1)})),++At,vt((()=>{0==--At&&Ut()}),[])}((()=>{0===this.unhandleds.length?e():n(this.unhandleds[0])}))}),i.finalize),t()}),e,n,i)))}),pt&&(pt.allSettled&&u(Mt,"allSettled",(function(){const t=F.apply(null,arguments).map(ne);return new Mt((e=>{0===t.length&&e([]);let n=t.length;const i=new Array(n);t.forEach(((t,r)=>Mt.resolve(t).then((t=>i[r]={status:"fulfilled",value:t}),(t=>i[r]={status:"rejected",reason:t})).then((()=>--n||e(i)))))}))})),pt.any&&"undefined"!=typeof AggregateError&&u(Mt,"any",(function(){const t=F.apply(null,arguments).map(ne);return new Mt(((e,n)=>{0===t.length&&n(new AggregateError([]));let i=t.length;const r=new Array(i);t.forEach(((t,s)=>Mt.resolve(t).then((t=>e(t)),(t=>{r[s]=t,--i||n(new AggregateError(r))}))))}))})));const Vt={awaits:0,echoes:0,id:0};var Wt=0,Yt=[],Ht=0,$t=0,Qt=0;function Jt(t,e,n,i){var s=Pt,o=Object.create(s);o.parent=s,o.ref=0,o.global=!1,o.id=++Qt;var a=Rt.env;o.env=mt?{Promise:Mt,PromiseProp:{value:Mt,configurable:!0,writable:!0},all:Mt.all,race:Mt.race,allSettled:Mt.allSettled,any:Mt.any,resolve:Mt.resolve,reject:Mt.reject,nthen:ue(a.nthen,o),gthen:ue(a.gthen,o)}:{},e&&r(o,e),++s.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=ae(o,t,n,i);return 0===o.ref&&o.finalize(),l}function te(){return Vt.id||(Vt.id=++Wt),++Vt.awaits,Vt.echoes+=100,Vt.id}function ee(){return!!Vt.awaits&&(0==--Vt.awaits&&(Vt.id=0),Vt.echoes=100*Vt.awaits,!0)}function ne(t){return Vt.echoes&&t&&t.constructor===pt?(te(),t.then((t=>(ee(),t)),(t=>(ee(),de(t))))):t}function ie(t){++$t,Vt.echoes&&0!=--Vt.echoes||(Vt.echoes=Vt.id=0),Yt.push(Pt),se(t,!0)}function re(){var t=Yt[Yt.length-1];Yt.pop(),se(t,!1)}function se(t,n){var i=Pt;if((n?!Vt.echoes||Ht++&&t===Pt:!Ht||--Ht&&t===Pt)||le(n?ie.bind(null,t):re),t!==Pt&&(Pt=t,i===Rt&&(Rt.env=oe()),mt)){var r=Rt.env.Promise,s=t.env;dt.then=s.nthen,r.prototype.then=s.gthen,(i.global||t.global)&&(Object.defineProperty(e,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function oe(){var t=e.Promise;return mt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(e,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:dt.then,gthen:t.prototype.then}:{}}function ae(t,e,n,i,r){var s=Pt;try{return se(t,!0),e(n,i,r)}finally{se(s,!1)}}function le(t){gt.call(ct,t)}function he(t,e,n,i){return"function"!=typeof t?t:function(){var r=Pt;n&&te(),se(e,!0);try{return t.apply(this,arguments)}finally{se(r,!1),i&&le(ee)}}}function ue(t,e){return function(n,i){return t.call(this,he(n,e),he(i,e))}}function ce(t,n){var i;try{i=n.onuncatched(t)}catch(t){}if(!1!==i)try{var s,o={promise:n,reason:t};if(e.document&&document.createEvent?((s=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),r(s,o)):e.CustomEvent&&r(s=new CustomEvent("unhandledrejection",{detail:o}),o),s&&e.dispatchEvent&&(dispatchEvent(s),!e.PromiseRejectionEvent&&e.onunhandledrejection))try{e.onunhandledrejection(s)}catch(t){}D&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(t){}}-1===(""+gt).indexOf("[native code]")&&(te=ee=et);var de=Mt.reject;function fe(t,e,n,i){if(t.idbdb&&(t._state.openComplete||Pt.letThrough||t._vip)){var r=t._createTransaction(e,n,t._dbSchema);try{r.create(),t._state.PR1398_maxLoop=3}catch(r){return r.name===H.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then((()=>fe(t,e,n,i)))):de(r)}return r._promise(e,((t,e)=>Jt((()=>(Pt.trans=r,i(t,e,r)))))).then((t=>r._completion.then((()=>t))))}if(t._state.openComplete)return de(new Q.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return de(new Q.DatabaseClosed);t.open().catch(et)}return t._state.dbReadyPromise.then((()=>fe(t,e,n,i)))}const ge=String.fromCharCode(65535),pe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",me=[],_e="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ye=_e,ve=_e,we=t=>!/(dexie\.js|dexie\.min\.js)/.test(t);function be(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const xe={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ee(t){return"string"!=typeof t||/\./.test(t)?t=>t:e=>(void 0===e[t]&&t in e&&delete(e=S(e))[t],e)}class Ce{_trans(t,e,n){const i=this._tx||Pt.trans,r=this.name;function s(t,n,i){if(!i.schema[r])throw new Q.NotFound("Table "+r+" not part of transaction");return e(i.idbtrans,i)}const o=Bt();try{return i&&i.db===this.db?i===Pt.trans?i._promise(t,s,n):Jt((()=>i._promise(t,s,n)),{trans:i,transless:Pt.transless||Pt}):fe(this.db,t,[this.name],s)}finally{o&&qt()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",(e=>this.core.get({trans:e,key:t}).then((t=>this.hook.reading.fire(t))))).then(e)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(i(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=n(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((t=>t.compound&&e.every((e=>t.keyPath.indexOf(e)>=0))&&t.keyPath.every((t=>e.indexOf(t)>=0))))[0];if(r&&this.db._maxKey!==ge)return this.where(r.name).equals(r.keyPath.map((e=>t[e])));!r&&D&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);const{idxByName:s}=this.schema,o=this.db._deps.indexedDB;function a(t,e){try{return 0===o.cmp(t,e)}catch(t){return!1}}const[l,h]=e.reduce((([e,n],r)=>{const o=s[r],l=t[r];return[e||o,e||!o?be(n,o&&o.multi?t=>{const e=w(t,r);return i(e)&&e.some((t=>a(l,t)))}:t=>a(l,w(t,r))):n]}),[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(h):r?this.filter(h):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,i(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=e=>{if(!e)return e;const n=Object.create(t.prototype);for(var i in e)if(a(e,i))try{n[i]=e[i]}catch(t){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass((function(t){r(this,t)}))}add(t,e){const{auto:n,keyPath:i}=this.schema.primKey;let r=t;return i&&n&&(r=Ee(i)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[r]}))).then((t=>t.numFailures?Mt.reject(t.failures[0]):t.lastResult)).then((e=>{if(i)try{b(t,i,e)}catch(t){}return e}))}update(t,e){if("object"!=typeof t||i(t))return this.where(":id").equals(t).modify(e);{const i=w(t,this.schema.primKey.keyPath);if(void 0===i)return de(new Q.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?n(e).forEach((n=>{b(t,n,e[n])})):e(t,{value:t,primKey:i})}catch(t){}return this.where(":id").equals(i).modify(e)}}put(t,e){const{auto:n,keyPath:i}=this.schema.primKey;let r=t;return i&&n&&(r=Ee(i)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"put",values:[r],keys:null!=e?[e]:null}))).then((t=>t.numFailures?Mt.reject(t.failures[0]):t.lastResult)).then((e=>{if(i)try{b(t,i,e)}catch(t){}return e}))}delete(t){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:[t]}))).then((t=>t.numFailures?Mt.reject(t.failures[0]):void 0))}clear(){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"deleteRange",range:xe}))).then((t=>t.numFailures?Mt.reject(t.failures[0]):void 0))}bulkGet(t){return this._trans("readonly",(e=>this.core.getMany({keys:t,trans:e}).then((t=>t.map((t=>this.hook.reading.fire(t)))))))}bulkAdd(t,e,n){const i=Array.isArray(e)?e:void 0,r=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&i)throw new Q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");const o=t.length;let a=s&&n?t.map(Ee(s)):t;return this.core.mutate({trans:e,type:"add",keys:i,values:a,wantResults:r}).then((({numFailures:t,results:e,lastResult:n,failures:i})=>{if(0===t)return r?e:n;throw new Y(`${this.name}.bulkAdd(): ${t} of ${o} operations failed`,i)}))}))}bulkPut(t,e,n){const i=Array.isArray(e)?e:void 0,r=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&i)throw new Q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");const o=t.length;let a=s&&n?t.map(Ee(s)):t;return this.core.mutate({trans:e,type:"put",keys:i,values:a,wantResults:r}).then((({numFailures:t,results:e,lastResult:n,failures:i})=>{if(0===t)return r?e:n;throw new Y(`${this.name}.bulkPut(): ${t} of ${o} operations failed`,i)}))}))}bulkDelete(t){const e=t.length;return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:t}))).then((({numFailures:t,lastResult:n,failures:i})=>{if(0===t)return n;throw new Y(`${this.name}.bulkDelete(): ${t} of ${e} operations failed`,i)}))}}function Te(t){var e={},r=function(n,i){if(i){for(var r=arguments.length,s=new Array(r-1);--r;)s[r-1]=arguments[r];return e[n].subscribe.apply(null,s),t}if("string"==typeof n)return e[n]};r.addEventType=a;for(var s=1,o=arguments.length;s<o;++s)a(arguments[s]);return r;function a(t,n,i){if("object"==typeof t)return l(t);n||(n=lt),i||(i=et);var s={subscribers:[],fire:i,subscribe:function(t){-1===s.subscribers.indexOf(t)&&(s.subscribers.push(t),s.fire=n(s.fire,t))},unsubscribe:function(t){s.subscribers=s.subscribers.filter((function(e){return e!==t})),s.fire=s.subscribers.reduce(n,i)}};return e[t]=r[t]=s,s}function l(t){n(t).forEach((function(e){var n=t[e];if(i(n))a(e,t[e][0],t[e][1]);else{if("asap"!==n)throw new Q.InvalidArgument("Invalid event config");var r=a(e,nt,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach((function(t){y((function(){t.apply(null,e)}))}))}))}}))}}function Re(t,e){return c(e).from({prototype:t}),e}function Pe(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Se(t,e){t.filter=be(t.filter,e)}function Ae(t,e,n){var i=t.replayFilter;t.replayFilter=i?()=>be(i(),e()):e,t.justLimit=n&&!i}function Ie(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new Q.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Me(t,e,n){const i=Ie(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:i,range:t.range}})}function ke(t,e,n,i){const r=t.replayFilter?be(t.filter,t.replayFilter()):t.filter;if(t.or){const s={},o=(t,n,i)=>{if(!r||r(n,i,(t=>n.stop(t)),(t=>n.fail(t)))){var o=n.primaryKey,l=""+o;"[object ArrayBuffer]"===l&&(l=""+new Uint8Array(o)),a(s,l)||(s[l]=!0,e(t,n,i))}};return Promise.all([t.or._iterate(o,n),Le(Me(t,i,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return Le(Me(t,i,n),be(t.algorithm,r),e,!t.keysOnly&&t.valueMapper)}function Le(t,e,n,i){var r=Xt(i?(t,e,r)=>n(i(t),e,r):n);return t.then((t=>{if(t)return t.start((()=>{var n=()=>t.continue();e&&!e(t,(t=>n=t),(e=>{t.stop(e),n=et}),(e=>{t.fail(e),n=et}))||r(t.value,t,(t=>n=t)),n()}))}))}function Oe(t,e){try{const n=Fe(t),i=Fe(e);if(n!==i)return"Array"===n?1:"Array"===i?-1:"binary"===n?1:"binary"===i?-1:"string"===n?1:"string"===i?-1:"Date"===n?1:"Date"!==i?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(t,e){const n=t.length,i=e.length,r=n<i?n:i;for(let n=0;n<r;++n)if(t[n]!==e[n])return t[n]<e[n]?-1:1;return n===i?0:n<i?-1:1}(Ne(t),Ne(e));case"Array":return function(t,e){const n=t.length,i=e.length,r=n<i?n:i;for(let n=0;n<r;++n){const i=Oe(t[n],e[n]);if(0!==i)return i}return n===i?0:n<i?-1:1}(t,e)}}catch(t){}return NaN}function Fe(t){const e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";const n=M(t);return"ArrayBuffer"===n?"binary":n}function Ne(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class De{_read(t,e){var n=this._ctx;return n.error?n.table._trans(null,de.bind(null,n.error)):n.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,de.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=be(e.algorithm,t)}_iterate(t,e){return ke(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&r(n,t),e._ctx=n,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read((n=>ke(e,t,n,e.table.core)))}count(t){return this._read((t=>{const e=this._ctx,n=e.table.core;if(Pe(e,!0))return n.count({trans:t,query:{index:Ie(e,n.schema),range:e.range}}).then((t=>Math.min(t,e.limit)));var i=0;return ke(e,(()=>(++i,!1)),t,n).then((()=>i))})).then(t)}sortBy(t,e){const n=t.split(".").reverse(),i=n[0],r=n.length-1;function s(t,e){return e?s(t[n[e]],e-1):t[i]}var o="next"===this._ctx.dir?1:-1;function a(t,e){var n=s(t,r),i=s(e,r);return n<i?-o:n>i?o:0}return this.toArray((function(t){return t.sort(a)})).then(e)}toArray(t){return this._read((t=>{var e=this._ctx;if("next"===e.dir&&Pe(e,!0)&&e.limit>0){const{valueMapper:n}=e,i=Ie(e,e.table.core.schema);return e.table.core.query({trans:t,limit:e.limit,values:!0,query:{index:i,range:e.range}}).then((({result:t})=>n?t.map(n):t))}{const n=[];return ke(e,(t=>n.push(t)),t,e.table.core).then((()=>n))}}),t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,Pe(e)?Ae(e,(()=>{var e=t;return(t,n)=>0===e||(1===e?(--e,!1):(n((()=>{t.advance(e),e=0})),!1))})):Ae(e,(()=>{var e=t;return()=>--e<0}))),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Ae(this._ctx,(()=>{var e=t;return function(t,n,i){return--e<=0&&n(i),e>=0}}),!0),this}until(t,e){return Se(this._ctx,(function(n,i,r){return!t(n.value)||(i(r),e)})),this}first(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,n;return Se(this._ctx,(function(e){return t(e.value)})),e=this._ctx,n=t,e.isMatch=be(e.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.key,n)}))}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.primaryKey,n)}))}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.key)})).then((function(){return n})).then(t)}primaryKeys(t){var e=this._ctx;if("next"===e.dir&&Pe(e,!0)&&e.limit>0)return this._read((t=>{var n=Ie(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:n,range:e.range}})})).then((({result:t})=>t)).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.primaryKey)})).then((function(){return n})).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys((function(t){return t[0]})).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var n={};return Se(this._ctx,(function(t){var e=t.primaryKey.toString(),i=a(n,e);return n[e]=!0,!i})),this}modify(t){var e=this._ctx;return this._write((i=>{var r;if("function"==typeof t)r=t;else{var s=n(t),o=s.length;r=function(e){for(var n=!1,i=0;i<o;++i){var r=s[i],a=t[r];w(e,r)!==a&&(b(e,r,a),n=!0)}return n}}const a=e.table.core,{outbound:l,extractKey:h}=a.schema.primaryKey,u=this.db._options.modifyChunkSize||200,c=[];let d=0;const f=[],g=(t,e)=>{const{failures:i,numFailures:r}=e;d+=t-r;for(let t of n(i))c.push(i[t])};return this.clone().primaryKeys().then((n=>{const s=o=>{const c=Math.min(u,n.length-o);return a.getMany({trans:i,keys:n.slice(o,o+c),cache:"immutable"}).then((d=>{const f=[],p=[],m=l?[]:null,_=[];for(let t=0;t<c;++t){const e=d[t],i={value:S(e),primKey:n[o+t]};!1!==r.call(i,i.value,i)&&(null==i.value?_.push(n[o+t]):l||0===Oe(h(e),h(i.value))?(p.push(i.value),l&&m.push(n[o+t])):(_.push(n[o+t]),f.push(i.value)))}const y=Pe(e)&&e.limit===1/0&&("function"!=typeof t||t===Ke)&&{index:e.index,range:e.range};return Promise.resolve(f.length>0&&a.mutate({trans:i,type:"add",values:f}).then((t=>{for(let e in t.failures)_.splice(parseInt(e),1);g(f.length,t)}))).then((()=>(p.length>0||y&&"object"==typeof t)&&a.mutate({trans:i,type:"put",keys:m,values:p,criteria:y,changeSpec:"function"!=typeof t&&t}).then((t=>g(p.length,t))))).then((()=>(_.length>0||y&&t===Ke)&&a.mutate({trans:i,type:"delete",keys:_,criteria:y}).then((t=>g(_.length,t))))).then((()=>n.length>o+c&&s(o+u)))}))};return s(0).then((()=>{if(c.length>0)throw new W("Error modifying one or more objects",c,d,f);return n.length}))}))}))}delete(){var t=this._ctx,e=t.range;return Pe(t)&&(t.isPrimKey&&!ve||3===e.type)?this._write((n=>{const{primaryKey:i}=t.table.core.schema,r=e;return t.table.core.count({trans:n,query:{index:i,range:r}}).then((e=>t.table.core.mutate({trans:n,type:"deleteRange",range:r}).then((({failures:t,lastResult:n,results:i,numFailures:r})=>{if(r)throw new W("Could not delete some values",Object.keys(t).map((e=>t[e])),e-r);return e-r}))))})):this.modify(Ke)}}const Ke=(t,e)=>e.value=null;function je(t,e){return t<e?-1:t===e?0:1}function ze(t,e){return t>e?-1:t===e?0:1}function Ge(t,e,n){var i=t instanceof Ve?new t.Collection(t):t;return i._ctx.error=n?new n(e):new TypeError(e),i}function Be(t){return new t.Collection(t,(()=>Xe(""))).limit(0)}function qe(t,e,n,i,r,s){for(var o=Math.min(t.length,i.length),a=-1,l=0;l<o;++l){var h=e[l];if(h!==i[l])return r(t[l],n[l])<0?t.substr(0,l)+n[l]+n.substr(l+1):r(t[l],i[l])<0?t.substr(0,l)+i[l]+n.substr(l+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;r(t[l],h)<0&&(a=l)}return o<i.length&&"next"===s?t+n.substr(t.length):o<t.length&&"prev"===s?t.substr(0,n.length):a<0?null:t.substr(0,a)+i[a]+n.substr(a+1)}function Ue(t,e,n,i){var r,s,o,a,l,h,u,c=n.length;if(!n.every((t=>"string"==typeof t)))return Ge(t,"String expected.");function d(t){r=function(t){return"next"===t?t=>t.toUpperCase():t=>t.toLowerCase()}(t),s=function(t){return"next"===t?t=>t.toLowerCase():t=>t.toUpperCase()}(t),o="next"===t?je:ze;var e=n.map((function(t){return{lower:s(t),upper:r(t)}})).sort((function(t,e){return o(t.lower,e.lower)}));a=e.map((function(t){return t.upper})),l=e.map((function(t){return t.lower})),h=t,u="next"===t?"":i}d("next");var f=new t.Collection(t,(()=>Ze(a[0],l[c-1]+i)));f._ondirectionchange=function(t){d(t)};var g=0;return f._addAlgorithm((function(t,n,i){var r=t.key;if("string"!=typeof r)return!1;var d=s(r);if(e(d,l,g))return!0;for(var f=null,p=g;p<c;++p){var m=qe(r,d,a[p],l[p],o,h);null===m&&null===f?g=p+1:(null===f||o(f,m)>0)&&(f=m)}return n(null!==f?function(){t.continue(f+u)}:i),!1})),f}function Ze(t,e,n,i){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:i}}function Xe(t){return{type:1,lower:t,upper:t}}class Ve{get Collection(){return this._ctx.table.db.Collection}between(t,e,n,i){n=!1!==n,i=!0===i;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(n||i)&&(!n||!i)?Be(this):new this.Collection(this,(()=>Ze(t,e,!n,!i)))}catch(t){return Ge(this,pe)}}equals(t){return null==t?Ge(this,pe):new this.Collection(this,(()=>Xe(t)))}above(t){return null==t?Ge(this,pe):new this.Collection(this,(()=>Ze(t,void 0,!0)))}aboveOrEqual(t){return null==t?Ge(this,pe):new this.Collection(this,(()=>Ze(t,void 0,!1)))}below(t){return null==t?Ge(this,pe):new this.Collection(this,(()=>Ze(void 0,t,!1,!0)))}belowOrEqual(t){return null==t?Ge(this,pe):new this.Collection(this,(()=>Ze(void 0,t)))}startsWith(t){return"string"!=typeof t?Ge(this,"String expected."):this.between(t,t+ge,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):Ue(this,((t,e)=>0===t.indexOf(e[0])),[t],ge)}equalsIgnoreCase(t){return Ue(this,((t,e)=>t===e[0]),[t],"")}anyOfIgnoreCase(){var t=F.apply(O,arguments);return 0===t.length?Be(this):Ue(this,((t,e)=>-1!==e.indexOf(t)),t,"")}startsWithAnyOfIgnoreCase(){var t=F.apply(O,arguments);return 0===t.length?Be(this):Ue(this,((t,e)=>e.some((e=>0===t.indexOf(e)))),t,ge)}anyOf(){const t=F.apply(O,arguments);let e=this._cmp;try{t.sort(e)}catch(t){return Ge(this,pe)}if(0===t.length)return Be(this);const n=new this.Collection(this,(()=>Ze(t[0],t[t.length-1])));n._ondirectionchange=n=>{e="next"===n?this._ascending:this._descending,t.sort(e)};let i=0;return n._addAlgorithm(((n,r,s)=>{const o=n.key;for(;e(o,t[i])>0;)if(++i,i===t.length)return r(s),!1;return 0===e(o,t[i])||(r((()=>{n.continue(t[i])})),!1)})),n}notEqual(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=F.apply(O,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return Ge(this,pe)}const e=t.reduce(((t,e)=>t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const n=this._cmp,i=this._ascending,r=this._descending,s=this._min,o=this._max;if(0===t.length)return Be(this);if(!t.every((t=>void 0!==t[0]&&void 0!==t[1]&&i(t[0],t[1])<=0)))return Ge(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Q.InvalidArgument);const a=!e||!1!==e.includeLowers,l=e&&!0===e.includeUppers;let h,u=i;function c(t,e){return u(t[0],e[0])}try{h=t.reduce((function(t,e){let i=0,r=t.length;for(;i<r;++i){const r=t[i];if(n(e[0],r[1])<0&&n(e[1],r[0])>0){r[0]=s(r[0],e[0]),r[1]=o(r[1],e[1]);break}}return i===r&&t.push(e),t}),[]),h.sort(c)}catch(t){return Ge(this,pe)}let d=0;const f=l?t=>i(t,h[d][1])>0:t=>i(t,h[d][1])>=0,g=a?t=>r(t,h[d][0])>0:t=>r(t,h[d][0])>=0;let p=f;const m=new this.Collection(this,(()=>Ze(h[0][0],h[h.length-1][1],!a,!l)));return m._ondirectionchange=t=>{"next"===t?(p=f,u=i):(p=g,u=r),h.sort(c)},m._addAlgorithm(((t,e,n)=>{for(var r=t.key;p(r);)if(++d,d===h.length)return e(n),!1;return!!function(t){return!f(t)&&!g(t)}(r)||(0===this._cmp(r,h[d][1])||0===this._cmp(r,h[d][0])||e((()=>{u===i?t.continue(h[d][0]):t.continue(h[d][1])})),!1)})),m}startsWithAnyOf(){const t=F.apply(O,arguments);return t.every((t=>"string"==typeof t))?0===t.length?Be(this):this.inAnyRange(t.map((t=>[t,t+ge]))):Ge(this,"startsWithAnyOf() only works with strings")}}function We(t){return Xt((function(e){return Ye(e),t(e.target.error),!1}))}function Ye(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const He=Te(null,"storagemutated");class $e{_lock(){return _(!Pt.global),++this._reculock,1!==this._reculock||Pt.global||(Pt.lockOwnerFor=this),this}_unlock(){if(_(!Pt.global),0==--this._reculock)for(Pt.global||(Pt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{ae(t[1],t[0])}catch(t){}}return this}_locked(){return this._reculock&&Pt.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,n=this.db._state.dbOpenError;if(_(!this.idbtrans),!t&&!e)switch(n&&n.name){case"DatabaseClosedError":throw new Q.DatabaseClosed(n);case"MissingAPIError":throw new Q.MissingAPI(n.message,n);default:throw new Q.OpenFailed(n)}if(!this.active)throw new Q.TransactionInactive;return _(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Xt((e=>{Ye(e),this._reject(t.error)})),t.onabort=Xt((e=>{Ye(e),this.active&&this._reject(new Q.Abort(t.error)),this.active=!1,this.on("abort").fire(e)})),t.oncomplete=Xt((()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&He.storagemutated.fire(t.mutatedParts)})),this}_promise(t,e,n){if("readwrite"===t&&"readwrite"!==this.mode)return de(new Q.ReadOnly("Transaction is readonly"));if(!this.active)return de(new Q.TransactionInactive);if(this._locked())return new Mt(((i,r)=>{this._blockedFuncs.push([()=>{this._promise(t,e,n).then(i,r)},Pt])}));if(n)return Jt((()=>{var t=new Mt(((t,n)=>{this._lock();const i=e(t,n,this);i&&i.then&&i.then(t,n)}));return t.finally((()=>this._unlock())),t._lib=!0,t}));var i=new Mt(((t,n)=>{var i=e(t,n,this);i&&i.then&&i.then(t,n)}));return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();const n=Mt.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then((()=>n));else{e._waitingFor=n,e._waitingQueue=[];var i=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(i.get(-1/0).onsuccess=t)}()}var r=e._waitingFor;return new Mt(((t,i)=>{n.then((n=>e._waitingQueue.push(Xt(t.bind(null,n)))),(t=>e._waitingQueue.push(Xt(i.bind(null,t))))).finally((()=>{e._waitingFor===r&&(e._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Q.Abort))}table(t){const e=this._memoizedTables||(this._memoizedTables={});if(a(e,t))return e[t];const n=this.schema[t];if(!n)throw new Q.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,n,this);return i.core=this.db.core.table(t),e[t]=i,i}}function Qe(t,e,n,i,r,s,o){return{name:t,keyPath:e,unique:n,multi:i,auto:r,compound:s,src:(n&&!o?"&":"")+(i?"*":"")+(r?"++":"")+Je(e)}}function Je(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function tn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:v(n,(t=>[t.name,t]))}}let en=t=>{try{return t.only([[]]),en=()=>[[]],[[]]}catch(t){return en=()=>ge,ge}};function nn(t){return null==t?()=>{}:"string"==typeof t?function(t){return 1===t.split(".").length?e=>e[t]:e=>w(e,t)}(t):e=>w(e,t)}function rn(t){return[].slice.call(t)}let sn=0;function on(t){return null==t?":id":"string"==typeof t?t:`[${t.join("+")}]`}function an(t,e,n){function r(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:i,lowerOpen:r,upperOpen:s}=t;return void 0===n?void 0===i?null:e.upperBound(i,!!s):void 0===i?e.lowerBound(n,!!r):e.bound(n,i,!!r,!!s)}const{schema:s,hasGetAll:o}=function(t,e){const n=rn(t.objectStoreNames);return{schema:{name:t.name,tables:n.map((t=>e.objectStore(t))).map((t=>{const{keyPath:e,autoIncrement:n}=t,r=i(e),s=null==e,o={},a={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:s,compound:r,keyPath:e,autoIncrement:n,unique:!0,extractKey:nn(e)},indexes:rn(t.indexNames).map((e=>t.index(e))).map((t=>{const{name:e,unique:n,multiEntry:r,keyPath:s}=t,a={name:e,compound:i(s),keyPath:s,unique:n,multiEntry:r,extractKey:nn(s)};return o[on(s)]=a,a})),getIndexByKeyPath:t=>o[on(t)]};return o[":id"]=a.primaryKey,null!=e&&(o[on(e)]=a.primaryKey),a}))},hasGetAll:n.length>0&&"getAll"in e.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),a=s.tables.map((t=>function(t){const e=t.name;return{name:e,schema:t,mutate:function({trans:t,type:n,keys:i,values:s,range:o}){return new Promise(((a,l)=>{a=Xt(a);const h=t.objectStore(e),u=null==h.keyPath,c="put"===n||"add"===n;if(!c&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:d}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let f;const g=[],p=[];let m=0;const _=t=>{++m,Ye(t)};if("deleteRange"===n){if(4===o.type)return a({numFailures:m,failures:p,results:[],lastResult:void 0});3===o.type?g.push(f=h.clear()):g.push(f=h.delete(r(o)))}else{const[t,e]=c?u?[s,i]:[s,null]:[i,null];if(c)for(let i=0;i<d;++i)g.push(f=e&&void 0!==e[i]?h[n](t[i],e[i]):h[n](t[i])),f.onerror=_;else for(let e=0;e<d;++e)g.push(f=h[n](t[e])),f.onerror=_}const y=t=>{const e=t.target.result;g.forEach(((t,e)=>null!=t.error&&(p[e]=t.error))),a({numFailures:m,failures:p,results:"delete"===n?i:g.map((t=>t.result)),lastResult:e})};f.onerror=t=>{_(t),y(t)},f.onsuccess=y}))},getMany:({trans:t,keys:n})=>new Promise(((i,r)=>{i=Xt(i);const s=t.objectStore(e),o=n.length,a=new Array(o);let l,h=0,u=0;const c=t=>{const e=t.target;a[e._pos]=e.result,++u===h&&i(a)},d=We(r);for(let t=0;t<o;++t)null!=n[t]&&(l=s.get(n[t]),l._pos=t,l.onsuccess=c,l.onerror=d,++h);0===h&&i(a)})),get:({trans:t,key:n})=>new Promise(((i,r)=>{i=Xt(i);const s=t.objectStore(e).get(n);s.onsuccess=t=>i(t.target.result),s.onerror=We(r)})),query:function(t){return n=>new Promise(((i,s)=>{i=Xt(i);const{trans:o,values:a,limit:l,query:h}=n,u=l===1/0?void 0:l,{index:c,range:d}=h,f=o.objectStore(e),g=c.isPrimaryKey?f:f.index(c.name),p=r(d);if(0===l)return i({result:[]});if(t){const t=a?g.getAll(p,u):g.getAllKeys(p,u);t.onsuccess=t=>i({result:t.target.result}),t.onerror=We(s)}else{let t=0;const e=a||!("openKeyCursor"in g)?g.openCursor(p):g.openKeyCursor(p),n=[];e.onsuccess=r=>{const s=e.result;return s?(n.push(a?s.value:s.primaryKey),++t===l?i({result:n}):void s.continue()):i({result:n})},e.onerror=We(s)}}))}(o),openCursor:function({trans:t,values:n,query:i,reverse:s,unique:o}){return new Promise(((a,l)=>{a=Xt(a);const{index:h,range:u}=i,c=t.objectStore(e),d=h.isPrimaryKey?c:c.index(h.name),f=s?o?"prevunique":"prev":o?"nextunique":"next",g=n||!("openKeyCursor"in d)?d.openCursor(r(u),f):d.openKeyCursor(r(u),f);g.onerror=We(l),g.onsuccess=Xt((e=>{const n=g.result;if(!n)return void a(null);n.___id=++sn,n.done=!1;const i=n.continue.bind(n);let r=n.continuePrimaryKey;r&&(r=r.bind(n));const s=n.advance.bind(n),o=()=>{throw new Error("Cursor not stopped")};n.trans=t,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Xt(l),n.next=function(){let t=1;return this.start((()=>t--?this.continue():this.stop())).then((()=>this))},n.start=t=>{const e=new Promise(((t,e)=>{t=Xt(t),g.onerror=We(e),n.fail=e,n.stop=e=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=o,t(e)}})),a=()=>{if(g.result)try{t()}catch(t){n.fail(t)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return g.onsuccess=Xt((t=>{g.onsuccess=a,a()})),n.continue=i,n.continuePrimaryKey=r,n.advance=s,a(),e},a(n)}),l)}))},count({query:t,trans:n}){const{index:i,range:s}=t;return new Promise(((t,o)=>{const a=n.objectStore(e),l=i.isPrimaryKey?a:a.index(i.name),h=r(s),u=h?l.count(h):l.count();u.onsuccess=Xt((e=>t(e.target.result))),u.onerror=We(o)}))}}}(t))),l={};return a.forEach((t=>l[t.name]=t)),{stack:"dbcore",transaction:t.transaction.bind(t),table(t){if(!l[t])throw new Error(`Table '${t}' not found`);return l[t]},MIN_KEY:-1/0,MAX_KEY:en(e),schema:s}}function ln({_novip:t},e){const n=e.db,i=function(t,e,{IDBKeyRange:n,indexedDB:i},r){const s=function(t,e){return e.reduce(((t,{create:e})=>({...t,...e(t)})),t)}(an(e,n,r),t.dbcore);return{dbcore:s}}(t._middlewares,n,t._deps,e);t.core=i.dbcore,t.tables.forEach((e=>{const n=e.name;t.core.schema.tables.some((t=>t.name===n))&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))}))}function hn({_novip:t},e,n,i){n.forEach((n=>{const r=i[n];e.forEach((e=>{const i=f(e,n);(!i||"value"in i&&void 0===i.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?u(e,n,{get(){return this.table(n)},set(t){h(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new t.Table(n,r))}))}))}function un({_novip:t},e){e.forEach((e=>{for(let n in e)e[n]instanceof t.Table&&delete e[n]}))}function cn(t,e){return t._cfg.version-e._cfg.version}function dn(t,e,i,r){const s=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,s);o.create(i),o._completion.catch(r);const a=o._reject.bind(o),l=Pt.transless||Pt;Jt((()=>{Pt.trans=o,Pt.transless=l,0===e?(n(s).forEach((t=>{gn(i,t,s[t].primKey,s[t].indexes)})),ln(t,i),Mt.follow((()=>t.on.populate.fire(o))).catch(a)):function({_novip:t},e,i,r){const s=[],o=t._versions;let a=t._dbSchema=mn(0,t.idbdb,r),l=!1;return o.filter((t=>t._cfg.version>=e)).forEach((o=>{s.push((()=>{const s=a,h=o._cfg.dbschema;_n(t,s,r),_n(t,h,r),a=t._dbSchema=h;const u=fn(s,h);u.add.forEach((t=>{gn(r,t[0],t[1].primKey,t[1].indexes)})),u.change.forEach((t=>{if(t.recreate)throw new Q.Upgrade("Not yet support for changing primary key");{const e=r.objectStore(t.name);t.add.forEach((t=>pn(e,t))),t.change.forEach((t=>{e.deleteIndex(t.name),pn(e,t)})),t.del.forEach((t=>e.deleteIndex(t)))}}));const c=o._cfg.contentUpgrade;if(c&&o._cfg.version>e){ln(t,r),i._memoizedTables={},l=!0;let e=x(h);u.del.forEach((t=>{e[t]=s[t]})),un(t,[t.Transaction.prototype]),hn(t,[t.Transaction.prototype],n(e),e),i.schema=e;const o=N(c);let a;o&&te();const d=Mt.follow((()=>{if(a=c(i),a&&o){var t=ee.bind(null,null);a.then(t,t)}}));return a&&"function"==typeof a.then?Mt.resolve(a):d.then((()=>a))}})),s.push((e=>{l&&ye||function(t,e){[].slice.call(e.db.objectStoreNames).forEach((n=>null==t[n]&&e.db.deleteObjectStore(n)))}(o._cfg.dbschema,e),un(t,[t.Transaction.prototype]),hn(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),i.schema=t._dbSchema}))})),function t(){return s.length?Mt.resolve(s.shift()(i.idbtrans)).then(t):Mt.resolve()}().then((()=>{var t,e;e=r,n(t=a).forEach((n=>{e.db.objectStoreNames.contains(n)||gn(e,n,t[n].primKey,t[n].indexes)}))}))}(t,e,o,i).catch(a)}))}function fn(t,e){const n={del:[],add:[],change:[]};let i;for(i in t)e[i]||n.del.push(i);for(i in e){const r=t[i],s=e[i];if(r){const t={name:i,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||r.primKey.auto!==s.primKey.auto&&!_e)t.recreate=!0,n.change.push(t);else{const e=r.idxByName,i=s.idxByName;let o;for(o in e)i[o]||t.del.push(o);for(o in i){const n=e[o],r=i[o];n?n.src!==r.src&&t.change.push(r):t.add.push(r)}(t.del.length>0||t.add.length>0||t.change.length>0)&&n.change.push(t)}}else n.add.push([i,s])}return n}function gn(t,e,n,i){const r=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return i.forEach((t=>pn(r,t))),r}function pn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function mn(t,e,n){const i={};return p(e.objectStoreNames,0).forEach((t=>{const e=n.objectStore(t);let r=e.keyPath;const s=Qe(Je(r),r||"",!1,!1,!!e.autoIncrement,r&&"string"!=typeof r,!0),o=[];for(let t=0;t<e.indexNames.length;++t){const n=e.index(e.indexNames[t]);r=n.keyPath;var a=Qe(n.name,r,!!n.unique,!!n.multiEntry,!1,r&&"string"!=typeof r,!1);o.push(a)}i[t]=tn(t,s,o)})),i}function _n({_novip:t},n,i){const r=i.db.objectStoreNames;for(let e=0;e<r.length;++e){const s=r[e],o=i.objectStore(s);t._hasGetAll="getAll"in o;for(let t=0;t<o.indexNames.length;++t){const e=o.indexNames[t],i=o.index(e).keyPath,r="string"==typeof i?i:"["+p(i).join("+")+"]";if(n[s]){const t=n[s].idxByName[r];t&&(t.name=e,delete n[s].idxByName[r],n[s].idxByName[e]=t)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&e.WorkerGlobalScope&&e instanceof e.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class yn{_parseStoresSpec(t,e){n(t).forEach((n=>{if(null!==t[n]){var r=t[n].split(",").map(((t,e)=>{const n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Qe(n,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),i(r),0===e)})),s=r.shift();if(s.multi)throw new Q.Schema("Primary key cannot be multi-valued");r.forEach((t=>{if(t.auto)throw new Q.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new Q.Schema("Index must have a name and cannot be an empty string")})),e[n]=tn(n,s,r)}}))}stores(t){const e=this.db;this._cfg.storesSource=this._cfg.storesSource?r(this._cfg.storesSource,t):t;const i=e._versions,s={};let o={};return i.forEach((t=>{r(s,t._cfg.storesSource),o=t._cfg.dbschema={},t._parseStoresSpec(s,o)})),e._dbSchema=o,un(e,[e._allTables,e,e.Transaction.prototype]),hn(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],n(o),o),e._storeNames=n(o),this}upgrade(t){return this._cfg.contentUpgrade=ht(this._cfg.contentUpgrade||et,t),this}}function vn(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new zn("__dbnames",{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function wn(t){return t&&"function"==typeof t.databases}function bn(t){return Jt((function(){return Pt.letThrough=!0,t()}))}function xn(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()})).finally((function(){return clearInterval(t)})):Promise.resolve()}function En(t){var e=e=>t.next(e),n=s(e),r=s((e=>t.throw(e)));function s(t){return e=>{var s=t(e),o=s.value;return s.done?o:o&&"function"==typeof o.then?o.then(n,r):i(o)?Promise.all(o).then(n,r):n(o)}}return s(e)()}function Cn(t,e,n){var i=arguments.length;if(i<2)throw new Q.InvalidArgument("Too few arguments");for(var r=new Array(i-1);--i;)r[i-1]=arguments[i];return n=r.pop(),[t,C(r),n]}function Tn(t,e,n,i,r){return Mt.resolve().then((()=>{const s=Pt.transless||Pt,o=t._createTransaction(e,n,t._dbSchema,i),a={trans:o,transless:s};if(i)o.idbtrans=i.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(i){return i.name===H.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then((()=>Tn(t,e,n,null,r)))):de(i)}const l=N(r);let h;l&&te();const u=Mt.follow((()=>{if(h=r.call(o,o),h)if(l){var t=ee.bind(null,null);h.then(t,t)}else"function"==typeof h.next&&"function"==typeof h.throw&&(h=En(h))}),a);return(h&&"function"==typeof h.then?Mt.resolve(h).then((t=>o.active?t:de(new Q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>h))).then((t=>(i&&o._resolve(),o._completion.then((()=>t))))).catch((t=>(o._reject(t),de(t))))}))}function Rn(t,e,n){const r=i(t)?t.slice():[t];for(let t=0;t<n;++t)r.push(e);return r}const Pn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:i}=n,r={},s=[];function o(t,e,n){const i=on(t),a=r[i]=r[i]||[],l=null==t?0:"string"==typeof t?1:t.length,h=e>0,u={...n,isVirtual:h,keyTail:e,keyLength:l,extractKey:nn(t),unique:!h&&n.unique};return a.push(u),u.isPrimaryKey||s.push(u),l>1&&o(2===l?t[0]:t.slice(0,l-1),e+1,n),a.sort(((t,e)=>t.keyTail-e.keyTail)),u}const a=o(i.primaryKey.keyPath,0,i.primaryKey);r[":id"]=[a];for(const t of i.indexes)o(t.keyPath,0,t);function l(e){const n=e.query.index;return n.isVirtual?{...e,query:{index:n,range:(i=e.query.range,r=n.keyTail,{type:1===i.type?2:i.type,lower:Rn(i.lower,i.lowerOpen?t.MAX_KEY:t.MIN_KEY,r),lowerOpen:!0,upper:Rn(i.upper,i.upperOpen?t.MIN_KEY:t.MAX_KEY,r),upperOpen:!0})}}:e;var i,r}const h={...n,schema:{...i,primaryKey:a,indexes:s,getIndexByKeyPath:function(t){const e=r[on(t)];return e&&e[0]}},count:t=>n.count(l(t)),query:t=>n.query(l(t)),openCursor(e){const{keyTail:i,isVirtual:r,keyLength:s}=e.query.index;return r?n.openCursor(l(e)).then((n=>n&&function(n){const r=Object.create(n,{continue:{value:function(r){null!=r?n.continue(Rn(r,e.reverse?t.MAX_KEY:t.MIN_KEY,i)):e.unique?n.continue(n.key.slice(0,s).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value(e,r){n.continuePrimaryKey(Rn(e,t.MAX_KEY,i),r)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const t=n.key;return 1===s?t[0]:t.slice(0,s)}},value:{get:()=>n.value}});return r}(n))):n.openCursor(e)}};return h}}}};function Sn(t,e,i,r){return i=i||{},r=r||"",n(t).forEach((n=>{if(a(e,n)){var s=t[n],o=e[n];if("object"==typeof s&&"object"==typeof o&&s&&o){const t=M(s);t!==M(o)?i[r+n]=e[n]:"Object"===t?Sn(s,o,i,r+n+"."):s!==o&&(i[r+n]=e[n])}else s!==o&&(i[r+n]=e[n])}else i[r+n]=void 0})),n(e).forEach((n=>{a(t,n)||(i[r+n]=e[n])})),i}const An={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:i}=n.schema,r={...n,mutate(t){const r=Pt.trans,{deleting:s,creating:o,updating:l}=r.table(e).hook;switch(t.type){case"add":if(o.fire===et)break;return r._promise("readwrite",(()=>h(t)),!0);case"put":if(o.fire===et&&l.fire===et)break;return r._promise("readwrite",(()=>h(t)),!0);case"delete":if(s.fire===et)break;return r._promise("readwrite",(()=>h(t)),!0);case"deleteRange":if(s.fire===et)break;return r._promise("readwrite",(()=>function(t){return u(t.trans,t.range,1e4)}(t)),!0)}return n.mutate(t);function h(t){const e=Pt.trans,r=t.keys||function(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}(i,t);if(!r)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?{...t,keys:r}:{...t}).type&&(t.values=[...t.values]),t.keys&&(t.keys=[...t.keys]),function(t,e,n){return"add"===e.type?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}(n,t,r).then((h=>{const u=r.map(((n,r)=>{const u=h[r],c={onerror:null,onsuccess:null};if("delete"===t.type)s.fire.call(c,n,u,e);else if("add"===t.type||void 0===u){const s=o.fire.call(c,n,t.values[r],e);null==n&&null!=s&&(n=s,t.keys[r]=n,i.outbound||b(t.values[r],i.keyPath,n))}else{const i=Sn(u,t.values[r]),s=l.fire.call(c,i,n,u,e);if(s){const e=t.values[r];Object.keys(s).forEach((t=>{a(e,t)?e[t]=s[t]:b(e,t,s[t])}))}}return c}));return n.mutate(t).then((({failures:e,results:n,numFailures:i,lastResult:s})=>{for(let i=0;i<r.length;++i){const s=n?n[i]:r[i],o=u[i];null==s?o.onerror&&o.onerror(e[i]):o.onsuccess&&o.onsuccess("put"===t.type&&h[i]?t.values[i]:s)}return{failures:e,results:n,numFailures:i,lastResult:s}})).catch((t=>(u.forEach((e=>e.onerror&&e.onerror(t))),Promise.reject(t))))}))}function u(t,e,r){return n.query({trans:t,values:!1,query:{index:i,range:e},limit:r}).then((({result:n})=>h({type:"delete",keys:n,trans:t}).then((i=>i.numFailures>0?Promise.reject(i.failures[0]):n.length<r?{failures:[],numFailures:0,lastResult:void 0}:u(t,{...e,lower:n[n.length-1],lowerOpen:!0},r)))))}}};return r}})};function In(t,e,n){try{if(!e)return null;if(e.keys.length<t.length)return null;const i=[];for(let r=0,s=0;r<e.keys.length&&s<t.length;++r)0===Oe(e.keys[r],t[s])&&(i.push(n?S(e.values[r]):e.values[r]),++s);return i.length===t.length?i:null}catch(t){return null}}const Mn={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:t=>{if(!t.cache)return n.getMany(t);const e=In(t.keys,t.trans._cache,"clone"===t.cache);return e?Mt.resolve(e):n.getMany(t).then((e=>(t.trans._cache={keys:t.keys,values:"clone"===t.cache?S(e):e},e)))},mutate:t=>("add"!==t.type&&(t.trans._cache=null),n.mutate(t))}}})};function kn(t){return!("from"in t)}const Ln=function(t,e){if(!this){const e=new Ln;return t&&"d"in t&&r(e,t),e}r(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function On(t,e,n){const i=Oe(e,n);if(isNaN(i))return;if(i>0)throw RangeError();if(kn(t))return r(t,{from:e,to:n,d:1});const s=t.l,o=t.r;if(Oe(n,t.from)<0)return s?On(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Dn(t);if(Oe(e,t.to)>0)return o?On(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Dn(t);Oe(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),Oe(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;s&&!t.l&&Fn(t,s),o&&a&&Fn(t,o)}function Fn(t,e){kn(e)||function t(e,{from:n,to:i,l:r,r:s}){On(e,n,i),r&&t(e,r),s&&t(e,s)}(t,e)}function Nn(t){let e=kn(t)?null:{s:0,n:t};return{next(t){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Oe(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Oe(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Dn(t){var e,n;const i=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(n=t.l)||void 0===n?void 0:n.d)||0),r=i>1?"r":i<-1?"l":"";if(r){const e="r"===r?"l":"r",n={...t},i=t[r];t.from=i.from,t.to=i.to,t[r]=i[r],n[r]=i[e],t[e]=n,n.d=Kn(n)}t.d=Kn(t)}function Kn({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}l(Ln.prototype,{add(t){return Fn(this,t),this},addKey(t){return On(this,t,t),this},addKeys(t){return t.forEach((t=>On(this,t,t))),this},[k](){return Nn(this)}});const jn={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,r=new Ln(t.MIN_KEY,t.MAX_KEY);return{...t,table:s=>{const o=t.table(s),{schema:a}=o,{primaryKey:l}=a,{extractKey:h,outbound:u}=l,c={...o,mutate:t=>{const n=t.trans,l=n.mutatedParts||(n.mutatedParts={}),h=t=>{const n=`idb://${e}/${s}/${t}`;return l[n]||(l[n]=new Ln)},u=h(""),c=h(":dels"),{type:d}=t;let[f,g]="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[[],t.values]:[];const p=t.trans._cache;return o.mutate(t).then((t=>{if(i(f)){"delete"!==d&&(f=t.results),u.addKeys(f);const e=In(f,p);e||"add"===d||c.addKeys(f),(e||g)&&function(t,e,n,r){e.indexes.forEach((function(e){const s=t(e.name||"");function o(t){return null!=t?e.extractKey(t):null}const a=t=>e.multiEntry&&i(t)?t.forEach((t=>s.addKey(t))):s.addKey(t);(n||r).forEach(((t,e)=>{const i=n&&o(n[e]),s=r&&o(r[e]);0!==Oe(i,s)&&(null!=i&&a(i),null!=s&&a(s))}))}))}(h,a,e,g)}else if(f){const t={from:f.lower,to:f.upper};c.add(t),u.add(t)}else u.add(r),c.add(r),a.indexes.forEach((t=>h(t.name).add(r)));return t}))}},d=({query:{index:e,range:n}})=>{var i,r;return[e,new Ln(null!==(i=n.lower)&&void 0!==i?i:t.MIN_KEY,null!==(r=n.upper)&&void 0!==r?r:t.MAX_KEY)]},f={get:t=>[l,new Ln(t.key)],getMany:t=>[l,(new Ln).addKeys(t.keys)],count:d,query:d,openCursor:d};return n(f).forEach((t=>{c[t]=function(n){const{subscr:i}=Pt;if(i){const a=t=>{const n=`idb://${e}/${s}/${t}`;return i[n]||(i[n]=new Ln)},l=a(""),c=a(":dels"),[d,g]=f[t](n);if(a(d.name||"").add(g),!d.isPrimaryKey){if("count"!==t){const e="query"===t&&u&&n.values&&o.query({...n,values:!1});return o[t].apply(this,arguments).then((i=>{if("query"===t){if(u&&n.values)return e.then((({result:t})=>(l.addKeys(t),i)));const t=n.values?i.result.map(h):i.result;n.values?l.addKeys(t):c.addKeys(t)}else if("openCursor"===t){const t=i,e=n.values;return t&&Object.create(t,{key:{get:()=>(c.addKey(t.primaryKey),t.key)},primaryKey:{get(){const e=t.primaryKey;return c.addKey(e),e}},value:{get:()=>(e&&l.addKey(t.primaryKey),t.value)}})}return i}))}c.add(r)}}return o[t].apply(this,arguments)}})),c}}}};class zn{constructor(t,e){this._middlewares={},this.verno=0;const n=zn.dependencies;this._options=e={addons:zn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:i}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const r={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:et,dbReadyPromise:null,cancelOpen:et,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;r.dbReadyPromise=new Mt((t=>{r.dbReadyResolve=t})),r.openCanceller=new Mt(((t,e)=>{r.cancelOpen=e})),this._state=r,this.name=t,this.on=Te(this,"populate","blocked","versionchange","close",{ready:[ht,et]}),this.on.ready.subscribe=m(this.on.ready.subscribe,(t=>(e,n)=>{zn.vip((()=>{const i=this._state;if(i.openComplete)i.dbOpenError||Mt.resolve().then(e),n&&t(e);else if(i.onReadyBeingFired)i.onReadyBeingFired.push(e),n&&t(e);else{t(e);const i=this;n||t((function t(){i.on.ready.unsubscribe(e),i.on.ready.unsubscribe(t)}))}}))})),this.Collection=(s=this,Re(De.prototype,(function(t,e){this.db=s;let n=xe,i=null;if(e)try{n=e()}catch(t){i=t}const r=t._ctx,o=r.table,a=o.hook.reading.fire;this._ctx={table:o,index:r.index,isPrimKey:!r.index||o.schema.primKey.keyPath&&r.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:r.or,valueMapper:a!==nt?a:null}}))),this.Table=function(t){return Re(Ce.prototype,(function(e,n,i){this.db=t,this._tx=i,this.name=e,this.schema=n,this.hook=t._allTables[e]?t._allTables[e].hook:Te(null,{creating:[st,et],reading:[it,nt],updating:[at,et],deleting:[ot,et]})}))}(this),this.Transaction=function(t){return Re($e.prototype,(function(e,n,i,r,s){this.db=t,this.mode=e,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=Te(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Mt(((t,e)=>{this._resolve=t,this._reject=e})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(t=>{var e=this.active;return this.active=!1,this.on.error.fire(t),this.parent?this.parent._reject(t):e&&this.idbtrans&&this.idbtrans.abort(),de(t)}))}))}(this),this.Version=function(t){return Re(yn.prototype,(function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(t){return Re(Ve.prototype,(function(e,n,i){this.db=t,this._ctx={table:e,index:":id"===n?null:n,or:i};const r=t._deps.indexedDB;if(!r)throw new Q.MissingAPI;this._cmp=this._ascending=r.cmp.bind(r),this._descending=(t,e)=>r.cmp(e,t),this._max=(t,e)=>r.cmp(t,e)>0?t:e,this._min=(t,e)=>r.cmp(t,e)<0?t:e,this._IDBKeyRange=t._deps.IDBKeyRange}))}(this),this.on("versionchange",(t=>{t.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(t=>{!t.newVersion||t.newVersion<t.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${t.oldVersion/10}`)})),this._maxKey=en(e.IDBKeyRange),this._createTransaction=(t,e,n,i)=>new this.Transaction(t,e,n,this._options.chromeTransactionDurability,i),this._fireOnBlocked=t=>{this.on("blocked").fire(t),me.filter((t=>t.name===this.name&&t!==this&&!t._state.vcFired)).map((e=>e.on("versionchange").fire(t)))},this.use(Pn),this.use(An),this.use(jn),this.use(Mn),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach((t=>t(this)))}version(t){if(isNaN(t)||t<.1)throw new Q.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new Q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this._versions;var n=e.filter((e=>e._cfg.version===t))[0];return n||(n=new this.Version(t),e.push(n),e.sort(cn),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(t){return this.idbdb&&(this._state.openComplete||Pt.letThrough||this._vip)?t():new Mt(((t,e)=>{if(this._state.openComplete)return e(new Q.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void e(new Q.DatabaseClosed);this.open().catch(et)}this._state.dbReadyPromise.then(t,e)})).then(t)}use({stack:t,create:e,level:n,name:i}){i&&this.unuse({stack:t,name:i});const r=this._middlewares[t]||(this._middlewares[t]=[]);return r.push({stack:t,create:e,level:null==n?10:n,name:i}),r.sort(((t,e)=>t.level-e.level)),this}unuse({stack:t,name:e,create:n}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((t=>n?t.create!==n:!!e&&t.name!==e))),this}open(){return function(t){const e=t._state,{indexedDB:i}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((()=>e.dbOpenError?de(e.dbOpenError):t));D&&(e.openCanceller._stackHolder=G()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new Q.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,a=null,l=!1;return Mt.race([r,("undefined"==typeof navigator?Mt.resolve():xn()).then((()=>new Mt(((r,o)=>{if(s(),!i)throw new Q.MissingAPI;const h=t.name,u=e.autoSchema?i.open(h):i.open(h,Math.round(10*t.verno));if(!u)throw new Q.MissingAPI;u.onerror=We(o),u.onblocked=Xt(t._fireOnBlocked),u.onupgradeneeded=Xt((n=>{if(a=u.transaction,e.autoSchema&&!t._options.allowEmptyDB){u.onerror=Ye,a.abort(),u.result.close();const t=i.deleteDatabase(h);t.onsuccess=t.onerror=Xt((()=>{o(new Q.NoSuchDatabase(`Database ${h} doesnt exist`))}))}else{a.onerror=We(o);var r=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;l=r<1,t._novip.idbdb=u.result,dn(t,r/10,a,o)}}),o),u.onsuccess=Xt((()=>{a=null;const i=t._novip.idbdb=u.result,s=p(i.objectStoreNames);if(s.length>0)try{const r=i.transaction(1===(o=s).length?o[0]:o,"readonly");e.autoSchema?function({_novip:t},e,i){t.verno=e.version/10;const r=t._dbSchema=mn(0,e,i);t._storeNames=p(e.objectStoreNames,0),hn(t,[t._allTables],n(r),r)}(t,i,r):(_n(t,t._dbSchema,r),function(t,e){const n=fn(mn(0,t.idbdb,e),t._dbSchema);return!(n.add.length||n.change.some((t=>t.add.length||t.change.length)))}(t,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ln(t,r)}catch(t){}var o;me.push(t),i.onversionchange=Xt((n=>{e.vcFired=!0,t.on("versionchange").fire(n)})),i.onclose=Xt((e=>{t.on("close").fire(e)})),l&&function({indexedDB:t,IDBKeyRange:e},n){!wn(t)&&"__dbnames"!==n&&vn(t,e).put({name:n}).catch(et)}(t._deps,h),r()}),o)}))))]).then((()=>(s(),e.onReadyBeingFired=[],Mt.resolve(bn((()=>t.on.ready.fire(t.vip)))).then((function n(){if(e.onReadyBeingFired.length>0){let i=e.onReadyBeingFired.reduce(ht,et);return e.onReadyBeingFired=[],Mt.resolve(bn((()=>i(t.vip)))).then(n)}}))))).finally((()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1})).then((()=>t)).catch((n=>{e.dbOpenError=n;try{a&&a.abort()}catch(t){}return r===e.openCanceller&&t._close(),de(n)})).finally((()=>{e.openComplete=!0,o()}))}(this)}_close(){const t=this._state,e=me.indexOf(this);if(e>=0&&me.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this._novip.idbdb=null}t.dbReadyPromise=new Mt((e=>{t.dbReadyResolve=e})),t.openCanceller=new Mt(((e,n)=>{t.cancelOpen=n}))}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new Q.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._state;return new Mt(((n,i)=>{const r=()=>{this.close();var t=this._deps.indexedDB.deleteDatabase(this.name);t.onsuccess=Xt((()=>{!function({indexedDB:t,IDBKeyRange:e},n){!wn(t)&&"__dbnames"!==n&&vn(t,e).delete(n).catch(et)}(this._deps,this.name),n()})),t.onerror=We(i),t.onblocked=this._fireOnBlocked};if(t)throw new Q.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(r):r()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return n(this._allTables).map((t=>this._allTables[t]))}transaction(){const t=Cn.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,n){let i=Pt.trans;i&&i.db===this&&-1===t.indexOf("!")||(i=null);const r=-1!==t.indexOf("?");let s,o;t=t.replace("!","").replace("?","");try{if(o=e.map((t=>{var e=t instanceof this.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||"readonly"===t)s="readonly";else{if("rw"!=t&&"readwrite"!=t)throw new Q.InvalidArgument("Invalid transaction mode: "+t);s="readwrite"}if(i){if("readonly"===i.mode&&"readwrite"===s){if(!r)throw new Q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach((t=>{if(i&&-1===i.storeNames.indexOf(t)){if(!r)throw new Q.SubTransaction("Table "+t+" not included in parent transaction.");i=null}})),r&&i&&!i.active&&(i=null)}}catch(t){return i?i._promise(null,((e,n)=>{n(t)})):de(t)}const a=Tn.bind(null,this,s,o,i,n);return i?i._promise(s,a,"lock"):Pt.trans?ae(Pt.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(t){if(!a(this._allTables,t))throw new Q.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Gn="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Bn{constructor(t){this._subscribe=t}subscribe(t,e,n){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:n})}[Gn](){return this}}function qn(t,e){return n(e).forEach((n=>{Fn(t[n]||(t[n]=new Ln),e[n])})),t}let Un;try{Un={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange}}catch(e){Un={indexedDB:null,IDBKeyRange:null}}const Zn=zn;function Xn(t){let e=Vn;try{Vn=!0,He.storagemutated.fire(t)}finally{Vn=e}}l(Zn,{...tt,delete:t=>new Zn(t,{addons:[]}).delete(),exists:t=>new Zn(t,{addons:[]}).open().then((t=>(t.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(t){try{return function({indexedDB:t,IDBKeyRange:e}){return wn(t)?Promise.resolve(t.databases()).then((t=>t.map((t=>t.name)).filter((t=>"__dbnames"!==t)))):vn(t,e).toCollection().primaryKeys()}(Zn.dependencies).then(t)}catch(t){return de(new Q.MissingAPI)}},defineClass:()=>function(t){r(this,t)},ignoreTransaction:t=>Pt.trans?ae(Pt.transless,t):t(),vip:bn,async:function(t){return function(){try{var e=En(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Mt.resolve(e)}catch(t){return de(t)}}},spawn:function(t,e,n){try{var i=En(t.apply(n,e||[]));return i&&"function"==typeof i.then?i:Mt.resolve(i)}catch(t){return de(t)}},currentTransaction:{get:()=>Pt.trans||null},waitFor:function(t,e){const n=Mt.resolve("function"==typeof t?Zn.ignoreTransaction(t):t).timeout(e||6e4);return Pt.trans?Pt.trans.waitFor(n):n},Promise:Mt,debug:{get:()=>D,set:t=>{K(t,"dexie"===t?()=>!0:we)}},derive:c,extend:r,props:l,override:m,Events:Te,on:He,liveQuery:function(t){return new Bn((e=>{const i=N(t);let r=!1,s={},o={};const a={get closed(){return r},unsubscribe:()=>{r=!0,He.storagemutated.unsubscribe(c)}};e.start&&e.start(a);let l=!1,h=!1;function u(){return n(o).some((t=>s[t]&&function(t,e){const n=Nn(e);let i=n.next();if(i.done)return!1;let r=i.value;const s=Nn(t);let o=s.next(r.from),a=o.value;for(;!i.done&&!o.done;){if(Oe(a.from,r.to)<=0&&Oe(a.to,r.from)>=0)return!0;Oe(r.from,a.from)<0?r=(i=n.next(a.from)).value:a=(o=s.next(r.from)).value}return!1}(s[t],o[t])))}const c=t=>{qn(s,t),u()&&d()},d=()=>{if(l||r)return;s={};const n={},f=function(e){i&&te();const n=()=>Jt(t,{subscr:e,trans:null}),r=Pt.trans?ae(Pt.transless,n):n();return i&&r.then(ee,ee),r}(n);h||(He("storagemutated",c),h=!0),l=!0,Promise.resolve(f).then((t=>{l=!1,r||(u()?d():(s={},o=n,e.next&&e.next(t)))}),(t=>{l=!1,e.error&&e.error(t),a.unsubscribe()}))};return d(),a}))},extendObservabilitySet:qn,getByKeyPath:w,setByKeyPath:b,delByKeyPath:function(t,e){"string"==typeof e?b(t,e,void 0):"length"in e&&[].map.call(e,(function(e){b(t,e,void 0)}))},shallowClone:x,deepClone:S,getObjectDiff:Sn,cmp:Oe,asap:y,minKey:-1/0,addons:[],connections:me,errnames:H,dependencies:Un,semVer:"3.2.3",version:"3.2.3".split(".").map((t=>parseInt(t))).reduce(((t,e,n)=>t+e/Math.pow(10,2*n)))}),Zn.maxKey=en(Zn.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(He("storagemutated",(t=>{if(!Vn){let e;_e?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,t)):e=new CustomEvent("x-storagemutated-1",{detail:t}),Vn=!0,dispatchEvent(e),Vn=!1}})),addEventListener("x-storagemutated-1",(({detail:t})=>{Vn||Xn(t)})));let Vn=!1;if("undefined"!=typeof BroadcastChannel){const t=new BroadcastChannel("x-storagemutated-1");"function"==typeof t.unref&&t.unref(),He("storagemutated",(e=>{Vn||t.postMessage(e)})),t.onmessage=t=>{t.data&&Xn(t.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){He("storagemutated",(t=>{try{Vn||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((e=>e.postMessage({type:"x-storagemutated-1",changedParts:t}))))}catch(t){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(t=>{if("x-storagemutated-1"===t.key){const e=JSON.parse(t.newValue);e&&Xn(e.changedParts)}}));const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",(function({data:t}){t&&"x-storagemutated-1"===t.type&&Xn(t.changedParts)}))}function Wn(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Mt.rejectionMapper=function(t,e){if(!t||t instanceof X||t instanceof TypeError||t instanceof SyntaxError||!t.name||!J[t.name])return t;var n=new J[t.name](e||t.message,t);return"stack"in t&&u(n,"stack",{get:function(){return this.inner.stack}}),n},K(D,we);class Yn extends zn{constructor(){super("GTFS"),Wn(this,"queue",Object.fromEntries(Yn.TABLES.map((t=>[t,new Array])))),this.instance=this.newInstance()}async newInstance(){const t=await fetch("https://api.511.org/transit/gtfsoperators?api_key=7cf5660e-215b-489d-87b1-78bb3ee006b7");this.agencies=(await t.json()).filter((t=>Yn.SUPPORTED_AGENCIES.includes(t.Id)));const e=this.agencies.reduce(((t,e)=>t+new Date(e.LastGenerated).getTime()),0);let n,i;try{if(n=await this.open(),i=n.verno,e>i){this.needsUpdate=!0;const t=await n.table("LastGenerated").toArray();this.agencies=this.agencies.filter((e=>!t.find((t=>t.Id===e.Id))||new Date(e.LastGenerated)>new Date(t.find((t=>t.Id===e.Id)).LastGenerated)))}}catch(t){console.log(t),this.firstTime=!0,this.needsUpdate=!0}finally{n&&n.close()}const r=Object.fromEntries(Yn.TABLES.map((t=>[t,["id"].concat(Yn.TABLE_MAP[t].includes("agency_id")?[]:["agency_id"]).concat(Yn.TABLE_MAP[t].length>1?`[${Yn.TABLE_MAP[t].join("+")}]`:Yn.TABLE_MAP[t][0]).join(", ")])));return this.version(e).stores(r),await this.open(),this}async batchAdd(t){const e=Yn.TABLES.find((t=>this.queue[t].length>0)),n=this.queue[e].splice(0,Yn.PROCESSING_COUNT),i=new Date;console.log(`Writing ${n.length} records to table "${e}"`),await this.table(e).bulkAdd(n);const r=new Date(new Date-i);console.log(`Finished in ${r.getSeconds()} sec, ${r.getMilliseconds()} ms`),this.currentQueue+=n.length,self.postMessage(this.currentQueue/this.totalQueue),Object.values(this.queue).reduce(((t,e)=>t+e.length))>0&&this.batchAdd()}}Wn(Yn,"PROCESSING_COUNT",2e5),Wn(Yn,"SUPPORTED_AGENCIES",["BA","SC"]),Wn(Yn,"TABLE_MAP",{LastGenerated:["Id"],agency:["agency_id"],mtc_feed_versions:["agency_id"],routes:["route_id"],stops:["stop_id"],trips:["trip_id"],areas:["area_id"],shapes:["shape_id","shape_pt_sequence"],levels:["level_id"],calendar:["service_id"],calendar_dates:["service_id","date"],calendar_attributes:["service_id"],directions:["route_id","direction_id"],fare_products:["fare_product_id","fare_media_id"],pathways:["pathway_id"],rider_categories:["rider_category_id"],stop_areas:["area_id","stop_id"],stop_times:["trip_id","stop_sequence"]}),Wn(Yn,"TABLES",Object.keys(Yn.TABLE_MAP));var Hn=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},$n="propertychange",Qn=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function Jn(t,e){return t>e?1:t<e?-1:0}function ti(t,e,n){const i=t.length;if(t[0]<=e)return 0;if(e<=t[i-1])return i-1;let r;if(n>0){for(r=1;r<i;++r)if(t[r]<e)return r-1}else if(n<0){for(r=1;r<i;++r)if(t[r]<=e)return r}else for(r=1;r<i;++r){if(t[r]==e)return r;if(t[r]<e)return"function"==typeof n?n(e,t[r-1],t[r])>0?r-1:r:t[r-1]-e<e-t[r]?r-1:r}return i-1}function ei(t,e){const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function ni(){return!0}function ii(){return!1}function ri(){}function si(t){for(const e in t)delete t[e]}var oi=class extends Qn{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(e)||i.push(e)}dispatchEvent(t){const e="string"==typeof t,n=e?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const r=e?new Hn(t):t;r.target||(r.target=this.eventTarget_||this);const s=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});let a;n in s||(s[n]=0,o[n]=0),++s[n];for(let t=0,e=i.length;t<e;++t)if(a="handleEvent"in i[t]?i[t].handleEvent(r):i[t].call(this,r),!1===a||r.propagationStopped){a=!1;break}if(0==--s[n]){let t=o[n];for(delete o[n];t--;)this.removeEventListener(n,ri);delete s[n]}return a}disposeInternal(){this.listeners_&&si(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const n=this.listeners_&&this.listeners_[t];if(n){const i=n.indexOf(e);-1!==i&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=ri,++this.pendingRemovals_[t]):(n.splice(i,1),0===n.length&&delete this.listeners_[t]))}}},ai={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function li(t,e,n,i,r){if(i&&i!==t&&(n=n.bind(i)),r){const i=n;n=function(){t.removeEventListener(e,n),i.apply(this,arguments)}}const s={target:t,type:e,listener:n};return t.addEventListener(e,n),s}function hi(t,e,n,i){return li(t,e,n,i,!0)}function ui(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),si(t))}class ci extends oi{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ai.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=li(this,t[r],e);return i}return li(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const i=t.length;n=new Array(i);for(let r=0;r<i;++r)n[r]=hi(this,t[r],e)}else n=hi(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)!function(t){if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)ui(t[e]);else ui(t)}(n);else if(Array.isArray(t))for(let n=0,i=t.length;n<i;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}ci.prototype.on,ci.prototype.once,ci.prototype.un;var di=ci;function fi(){throw new Error("Unimplemented abstract method.")}let gi=0;function pi(t){return t.ol_uid||(t.ol_uid=String(++gi))}class mi extends Hn{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}var _i=class extends di{constructor(t){super(),this.on,this.once,this.un,pi(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new mi(n,t,e)),n=$n,this.hasListener(n)&&this.dispatchEvent(new mi(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const i=this.values_||(this.values_={});if(n)i[t]=e;else{const n=i[t];i[t]=e,n!==e&&this.notify(t,n)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],function(t){let e;for(e in t)return!1;return!e}(this.values_)&&(this.values_=null),e||this.notify(t,n)}}};const yi={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class vi extends Error{constructor(t){const e=yi[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}var wi=vi,bi="add",xi="remove";const Ei="length";class Ci extends Hn{constructor(t,e,n){super(t),this.element=e,this.index=n}}var Ti=class extends _i{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,i=e.length;n<i;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Ei)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ci(bi,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,i=e.length;n<i;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ci(xi,e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ci(xi,n,t)),this.dispatchEvent(new Ci(bi,e,t))}updateLength_(){this.set(Ei,this.array_.length)}assertUnique_(t,e){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===t&&n!==e)throw new wi(58)}};const Ri="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",Pi=Ri.includes("firefox"),Si=(Ri.includes("safari")&&!Ri.includes("chrom")&&(Ri.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Ri)),Ri.includes("webkit")&&!Ri.includes("edge")),Ai=Ri.includes("macintosh"),Ii="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,Mi="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,ki="undefined"!=typeof Image&&Image.prototype.decode,Li=function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}return t}();function Oi(t,e){if(!t)throw new wi(e)}function Fi(t,e){const n=e[0],i=e[1];return e[0]=t[0]*n+t[2]*i+t[4],e[1]=t[1]*n+t[3]*i+t[5],e}function Ni(t,e,n,i,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return t[0]=i*h,t[1]=r*l,t[2]=-i*l,t[3]=r*h,t[4]=o*i*h-a*i*l+e,t[5]=o*r*l+a*r*h+n,t}function Di(t,e){const n=(i=e)[0]*i[3]-i[1]*i[2];var i;Oi(0!==n,32);const r=e[0],s=e[1],o=e[2],a=e[3],l=e[4],h=e[5];return t[0]=a/n,t[1]=-s/n,t[2]=-o/n,t[3]=r/n,t[4]=(o*h-a*l)/n,t[5]=-(r*h-s*l)/n,t}let Ki;new Array(6);var ji={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function zi(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0,i=t.length;n<i;++n)Wi(e,t[n]);return e}function Gi(t,e,n){let i,r;return i=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,r=n<t[1]?t[1]-n:t[3]<n?n-t[3]:0,i*i+r*r}function Bi(t,e){return qi(t,e[0],e[1])}function qi(t,e,n){return t[0]<=e&&e<=t[2]&&t[1]<=n&&n<=t[3]}function Ui(t,e){const n=t[0],i=t[1],r=t[2],s=t[3],o=e[0],a=e[1];let l=ji.UNKNOWN;return o<n?l|=ji.LEFT:o>r&&(l|=ji.RIGHT),a<i?l|=ji.BELOW:a>s&&(l|=ji.ABOVE),l===ji.UNKNOWN&&(l=ji.INTERSECTING),l}function Zi(t,e,n,i,r){return r?(r[0]=t,r[1]=e,r[2]=n,r[3]=i,r):[t,e,n,i]}function Xi(t){return Zi(1/0,1/0,-1/0,-1/0,t)}function Vi(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Wi(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Yi(t,e,n,i,r){for(;n<i;n+=r)Hi(t,e[n],e[n+1]);return t}function Hi(t,e,n){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],n),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],n)}function $i(t,e){let n;return n=e(Ji(t)),n||(n=e(tr(t)),n||(n=e(lr(t)),n||(n=e(ar(t)),n||!1)))}function Qi(t){let e=0;return cr(t)||(e=hr(t)*sr(t)),e}function Ji(t){return[t[0],t[1]]}function tr(t){return[t[2],t[1]]}function er(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function nr(t,e){let n;return"bottom-left"===e?n=Ji(t):"bottom-right"===e?n=tr(t):"top-left"===e?n=ar(t):"top-right"===e?n=lr(t):Oi(!1,13),n}function ir(t,e,n,i,r){const[s,o,a,l,h,u,c,d]=rr(t,e,n,i);return Zi(Math.min(s,a,h,c),Math.min(o,l,u,d),Math.max(s,a,h,c),Math.max(o,l,u,d),r)}function rr(t,e,n,i){const r=e*i[0]/2,s=e*i[1]/2,o=Math.cos(n),a=Math.sin(n),l=r*o,h=r*a,u=s*o,c=s*a,d=t[0],f=t[1];return[d-l+c,f-h-u,d-l-c,f-h+u,d+l-c,f+h+u,d+l+c,f+h-u,d-l+c,f-h-u]}function sr(t){return t[3]-t[1]}function or(t,e,n){const i=n||[1/0,1/0,-1/0,-1/0];return ur(t,e)?(t[0]>e[0]?i[0]=t[0]:i[0]=e[0],t[1]>e[1]?i[1]=t[1]:i[1]=e[1],t[2]<e[2]?i[2]=t[2]:i[2]=e[2],t[3]<e[3]?i[3]=t[3]:i[3]=e[3]):Xi(i),i}function ar(t){return[t[0],t[3]]}function lr(t){return[t[2],t[3]]}function hr(t){return t[2]-t[0]}function ur(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function cr(t){return t[2]<t[0]||t[3]<t[1]}function dr(t,e,n){return Math.min(Math.max(t,e),n)}function fr(t,e,n,i,r,s){const o=r-n,a=s-i;if(0!==o||0!==a){const l=((t-n)*o+(e-i)*a)/(o*o+a*a);l>1?(n=r,i=s):l>0&&(n+=o*l,i+=a*l)}return gr(t,e,n,i)}function gr(t,e,n,i){const r=n-t,s=i-e;return r*r+s*s}function pr(t){return t*Math.PI/180}function mr(t,e){const n=t%e;return n*e<0?n+e:n}function _r(t,e,n){return t+n*(e-t)}function yr(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}function vr(t,e){return Math.floor(yr(t,e))}function wr(t,e){return Math.ceil(yr(t,e))}const br=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,xr=/^([a-z]*)$|^hsla?\(.*\)$/i;const Er=function(){const t={};let e=0;return function(n){let i;if(t.hasOwnProperty(n))i=t[n];else{if(e>=1024){let n=0;for(const i in t)0==(3&n++)&&(delete t[i],--e)}i=function(t){let e,n,i,r,s;if(xr.exec(t)&&(t=function(t){const e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}(t)),br.exec(t)){const o=t.length-1;let a;a=o<=4?1:2;const l=4===o||8===o;e=parseInt(t.substr(1+0*a,a),16),n=parseInt(t.substr(1+1*a,a),16),i=parseInt(t.substr(1+2*a,a),16),r=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,n=(n<<4)+n,i=(i<<4)+i,l&&(r=(r<<4)+r)),s=[e,n,i,r/255]}else t.startsWith("rgba(")?(s=t.slice(5,-1).split(",").map(Number),Tr(s)):t.startsWith("rgb(")?(s=t.slice(4,-1).split(",").map(Number),s.push(1),Tr(s)):Oi(!1,14);return s}(n),t[n]=i,++e}return i}}();function Cr(t){return Array.isArray(t)?t:Er(t)}function Tr(t){return t[0]=dr(t[0]+.5|0,0,255),t[1]=dr(t[1]+.5|0,0,255),t[2]=dr(t[2]+.5|0,0,255),t[3]=dr(t[3],0,1),t}function Rr(t,e,n){return e+":"+t+":"+(n?function(t){return"string"==typeof t?t:function(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let n=t[1];n!=(0|n)&&(n=n+.5|0);let i=t[2];return i!=(0|i)&&(i=i+.5|0),"rgba("+e+","+n+","+i+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}(t)}(n):"null")}const Pr=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];0!=(3&t++)||n.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,n){const i=Rr(t,e,n);return i in this.cache_?this.cache_[i]:null}set(t,e,n,i){const r=Rr(t,e,n);this.cache_[r]=i,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};var Sr="opacity",Ar="visible",Ir="extent",Mr="zIndex",kr="maxResolution",Lr="minResolution",Or="maxZoom",Fr="minZoom",Nr="source",Dr=class extends _i{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e[Sr]=void 0!==t.opacity?t.opacity:1,Oi("number"==typeof e[Sr],64),e[Ar]=void 0===t.visible||t.visible,e[Mr]=t.zIndex,e[kr]=void 0!==t.maxResolution?t.maxResolution:1/0,e[Lr]=void 0!==t.minResolution?t.minResolution:0,e[Fr]=void 0!==t.minZoom?t.minZoom:-1/0,e[Or]=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},n=this.getZIndex();return e.opacity=dr(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==n||e.managed?n:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return fi()}getLayerStatesArray(t){return fi()}getExtent(){return this.get(Ir)}getMaxResolution(){return this.get(kr)}getMinResolution(){return this.get(Lr)}getMinZoom(){return this.get(Fr)}getMaxZoom(){return this.get(Or)}getOpacity(){return this.get(Sr)}getSourceState(){return fi()}getVisible(){return this.get(Ar)}getZIndex(){return this.get(Mr)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ir,t)}setMaxResolution(t){this.set(kr,t)}setMinResolution(t){this.set(Lr,t)}setMaxZoom(t){this.set(Or,t)}setMinZoom(t){this.set(Fr,t)}setOpacity(t){Oi("number"==typeof t,64),this.set(Sr,t)}setVisible(t){this.set(Ar,t)}setZIndex(t){this.set(Mr,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},Kr="precompose",jr="rendercomplete",zr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};const Gr=42,Br=256,qr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var Ur=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||qr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Zr=6378137,Xr=Math.PI*Zr,Vr=[-Xr,-Xr,Xr,Xr],Wr=[-180,-85,180,85],Yr=Zr*Math.log(Math.tan(Math.PI/2));class Hr extends Ur{constructor(t){super({code:t,units:"m",extent:Vr,global:!0,worldExtent:Wr,getPointResolution:function(t,e){return t/Math.cosh(e[1]/Zr)}})}}const $r=[new Hr("EPSG:3857"),new Hr("EPSG:102100"),new Hr("EPSG:102113"),new Hr("EPSG:900913"),new Hr("http://www.opengis.net/def/crs/EPSG/0/3857"),new Hr("http://www.opengis.net/gml/srs/epsg.xml#3857")];const Qr=[-180,-90,180,90],Jr=6378137*Math.PI/180;class ts extends Ur{constructor(t,e){super({code:t,units:"degrees",extent:Qr,axisOrientation:e,global:!0,metersPerUnit:Jr,worldExtent:Qr})}}const es=[new ts("CRS:84"),new ts("EPSG:4326","neu"),new ts("urn:ogc:def:crs:OGC:1.3:CRS84"),new ts("urn:ogc:def:crs:OGC:2:84"),new ts("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ts("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ts("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let ns={},is={};function rs(t,e,n){const i=t.getCode(),r=e.getCode();i in is||(is[i]={}),is[i][r]=n}function ss(t,e){let n=!0;for(let i=t.length-1;i>=0;--i)if(t[i]!=e[i]){n=!1;break}return n}function os(t,e){const n=Math.cos(e),i=Math.sin(e),r=t[0]*n-t[1]*i,s=t[1]*n+t[0]*i;return t[0]=r,t[1]=s,t}const as=6371008.8;function ls(t,e,n){n=n||as;const i=pr(t[1]),r=pr(e[1]),s=(r-i)/2,o=pr(e[0]-t[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(r);return 2*n*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const hs={info:1,warn:2,error:3,none:4};let us=hs.info;function cs(...t){us>hs.warn||console.warn(...t)}let ds=!0;function fs(t,e){if(void 0!==e)for(let n=0,i=t.length;n<i;++n)e[n]=t[n];else e=t.slice();return e}function gs(t,e){if(void 0!==e&&t!==e){for(let n=0,i=t.length;n<i;++n)e[n]=t[n];t=e}return t}function ps(t){!function(t,e){ns[t]=e}(t.getCode(),t),rs(t,t,fs)}function ms(t){return"string"==typeof t?ns[e=t]||ns[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function _s(t,e,n,i){let r;const s=(t=ms(t)).getPointResolutionFunc();if(s){if(r=s(e,n),i&&i!==t.getUnits()){const e=t.getMetersPerUnit();e&&(r=r*e/qr[i])}}else{const s=t.getUnits();if("degrees"==s&&!i||"degrees"==i)r=e;else{const o=bs(t,ms("EPSG:4326"));if(o===gs&&"degrees"!==s)r=e*t.getMetersPerUnit();else{let t=[n[0]-e/2,n[1],n[0]+e/2,n[1],n[0],n[1]-e/2,n[0],n[1]+e/2];t=o(t,t,2),r=(ls(t.slice(0,2),t.slice(2,4))+ls(t.slice(4,6),t.slice(6,8)))/2}const a=i?qr[i]:t.getMetersPerUnit();void 0!==a&&(r/=a)}}return r}function ys(t){!function(t){t.forEach(ps)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&rs(e,t,fs)}))}))}function vs(t,e){return t?"string"==typeof t?ms(t):t:ms(e)}function ws(t,e){if(t===e)return!0;const n=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||bs(t,e)===fs)&&n}function bs(t,e){let n=function(t,e){let n;return t in is&&e in is[t]&&(n=is[t][e]),n}(t.getCode(),e.getCode());return n||(n=gs),n}function xs(t,e){return bs(ms(t),ms(e))}function Es(t,e,n){return xs(e,n)(t,void 0,t.length)}function Cs(t,e,n,i){return function(t,e,n,i){let r=[];if(i>1){const e=t[2]-t[0],n=t[3]-t[1];for(let s=0;s<i;++s)r.push(t[0]+e*s/i,t[1],t[2],t[1]+n*s/i,t[2]-e*s/i,t[3],t[0],t[3]-n*s/i)}else r=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(r,r,2);const s=[],o=[];for(let t=0,e=r.length;t<e;t+=2)s.push(r[t]),o.push(r[t+1]);return function(t,e,n){return Zi(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),n)}(s,o,n)}(t,xs(e,n),void 0,i)}let Ts=null;function Rs(){return Ts}function Ps(t,e){return Ts?Es(t,e,Ts):t}function Ss(t,e){return Ts?Es(t,Ts,e):(ds&&!ss(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(ds=!1,cs("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t)}function As(t,e){return Ts?Cs(t,Ts,e):t}var Is,Ms,ks;function Ls(t,e,n){return function(i,r,s,o,a){if(!i)return;if(!r&&!e)return i;const l=e?0:s[0]*r,h=e?0:s[1]*r,u=a?a[0]:0,c=a?a[1]:0;let d=t[0]+l/2+u,f=t[2]-l/2+u,g=t[1]+h/2+c,p=t[3]-h/2+c;d>f&&(d=(f+d)/2,f=d),g>p&&(g=(p+g)/2,p=g);let m=dr(i[0],d,f),_=dr(i[1],g,p);if(o&&n&&r){const t=30*r;m+=-t*Math.log(1+Math.max(0,d-i[0])/t)+t*Math.log(1+Math.max(0,i[0]-f)/t),_+=-t*Math.log(1+Math.max(0,g-i[1])/t)+t*Math.log(1+Math.max(0,i[1]-p)/t)}return[m,_]}}function Os(t){return t}function Fs(t,e,n,i){const r=hr(e)/n[0],s=sr(e)/n[1];return i?Math.min(t,Math.max(r,s)):Math.min(t,Math.min(r,s))}function Ns(t,e,n){let i=Math.min(t,e);return i*=Math.log(1+50*Math.max(0,t/e-1))/50+1,n&&(i=Math.max(i,n),i/=Math.log(1+50*Math.max(0,n/t-1))/50+1),dr(i,n/2,2*e)}function Ds(t,e,n,i,r){return n=void 0===n||n,function(s,o,a,l){if(void 0!==s){const o=i?Fs(t,i,a,r):t;return n&&l?Ns(s,o,e):dr(s,e,o)}}}function Ks(t){if(void 0!==t)return 0}function js(t){if(void 0!==t)return t}function zs(t){return Math.pow(t,3)}function Gs(t){return 1-zs(1-t)}function Bs(t){return 3*t*t-2*t*t*t}function qs(t){return t}ys($r),ys(es),Is=$r,Ms=function(t,e,n){const i=t.length;n=n>1?n:2,void 0===e&&(e=n>2?t.slice():new Array(i));for(let r=0;r<i;r+=n){e[r]=Xr*t[r]/180;let n=Zr*Math.log(Math.tan(Math.PI*(+t[r+1]+90)/360));n>Yr?n=Yr:n<-Yr&&(n=-Yr),e[r+1]=n}return e},ks=function(t,e,n){const i=t.length;n=n>1?n:2,void 0===e&&(e=n>2?t.slice():new Array(i));for(let r=0;r<i;r+=n)e[r]=180*t[r]/Xr,e[r+1]=360*Math.atan(Math.exp(t[r+1]/Zr))/Math.PI-90;return e},es.forEach((function(t){Is.forEach((function(e){rs(t,e,Ms),rs(e,t,ks)}))}));const Us=[1,0,0,1,0,0];var Zs=class extends _i{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(t){let e,n,i,r=!1;return function(){const s=Array.prototype.slice.call(arguments);return r&&this===i&&ei(s,n)||(r=!0,i=this,n=s,e=t.apply(this,arguments)),e}}((function(t,e,n){if(!n)return this.getSimplifiedGeometry(e);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(e)}))}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return fi()}closestPointXY(t,e,n,i){return fi()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return fi()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Xi(t),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){fi()}scale(t,e,n){fi()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return fi()}getType(){return fi()}applyTransform(t){fi()}intersectsExtent(t){return fi()}translate(t,e){fi()}transform(t,e){const n=ms(t),i="tile-pixels"==n.getUnits()?function(t,i,r){const s=n.getExtent(),o=n.getWorldExtent(),a=sr(o)/sr(s);return Ni(Us,o[0],o[3],a,-a,0,0,0),function(t,e,n,i,r,s){s=s||[];let o=0;for(let e=0;e<n;e+=i){const n=t[e],i=t[e+1];s[o++]=r[0]*n+r[2]*i+r[4],s[o++]=r[1]*n+r[3]*i+r[5]}s&&s.length!=o&&(s.length=o)}(t,0,t.length,r,Us,i),xs(n,e)(t,i,r)}:xs(n,e);return this.applyTransform(i),this}};function Xs(t){let e;return"XY"==t?e=2:"XYZ"==t||"XYM"==t?e=3:"XYZM"==t&&(e=4),e}var Vs=class extends Zs{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return e=this.flatCoordinates,n=this.flatCoordinates.length,i=this.stride,Yi(Xi(t),e,0,n,i);var e,n,i}getCoordinates(){return fi()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Xs(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){fi()}setLayout(t,e,n){let i;if(t)i=Xs(t);else{for(let t=0;t<n;++t){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}i=e.length,t=function(t){let e;return 2==t?e="XY":3==t?e="XYZ":4==t&&(e="XYZM"),e}(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();!function(t,e,n,i,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],u=s[1];let c=0;for(let e=0;e<n;e+=i){const n=t[e]-h,r=t[e+1]-u;o[c++]=h+n*a-r*l,o[c++]=u+n*l+r*a;for(let n=e+2;n<e+i;++n)o[c++]=t[n]}o&&o.length!=c&&(o.length=c)}(n,0,n.length,i,t,e,n),this.changed()}}scale(t,e,n){void 0===e&&(e=t),n||(n=er(this.getExtent()));const i=this.getFlatCoordinates();if(i){const r=this.getStride();!function(t,e,n,i,r,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let e=0;e<n;e+=i){const n=t[e]-l,o=t[e+1]-h;a[u++]=l+r*n,a[u++]=h+s*o;for(let n=e+2;n<e+i;++n)a[u++]=t[n]}a&&a.length!=u&&(a.length=u)}(i,0,i.length,r,t,e,n,i),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();!function(t,e,n,i,r,s,o){o=o||[];let a=0;for(let e=0;e<n;e+=i){o[a++]=t[e]+r,o[a++]=t[e+1]+s;for(let n=e+2;n<e+i;++n)o[a++]=t[n]}o&&o.length!=a&&(o.length=a)}(n,0,n.length,i,t,e,n),this.changed()}}};function Ws(t,e,n,i,r,s,o){const a=t[e],l=t[e+1],h=t[n]-a,u=t[n+1]-l;let c;if(0===h&&0===u)c=e;else{const d=((r-a)*h+(s-l)*u)/(h*h+u*u);if(d>1)c=n;else{if(d>0){for(let r=0;r<i;++r)o[r]=_r(t[e+r],t[n+r],d);return void(o.length=i)}c=e}}for(let e=0;e<i;++e)o[e]=t[c+e];o.length=i}function Ys(t,e,n,i,r){let s=t[e],o=t[e+1];for(e+=i;e<n;e+=i){const n=t[e],i=t[e+1],a=gr(s,o,n,i);a>r&&(r=a),s=n,o=i}return r}function Hs(t,e,n,i,r,s,o,a,l,h,u){if(e==n)return h;let c,d;if(0===r){if(d=gr(o,a,t[e],t[e+1]),d<h){for(c=0;c<i;++c)l[c]=t[e+c];return l.length=i,d}return h}u=u||[NaN,NaN];let f=e+i;for(;f<n;)if(Ws(t,f-i,f,i,o,a,u),d=gr(o,a,u[0],u[1]),d<h){for(h=d,c=0;c<i;++c)l[c]=u[c];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(s&&(Ws(t,n-i,e,i,o,a,u),d=gr(o,a,u[0],u[1]),d<h)){for(h=d,c=0;c<i;++c)l[c]=u[c];l.length=i}return h}function $s(t,e,n,i){for(let r=0,s=n.length;r<s;++r){const s=n[r];for(let n=0;n<i;++n)t[e++]=s[n]}return e}function Qs(t,e){return e*Math.round(t/e)}function Js(t,e,n,i,r,s,o){if(e==n)return o;let a,l,h=Qs(t[e],r),u=Qs(t[e+1],r);e+=i,s[o++]=h,s[o++]=u;do{if(a=Qs(t[e],r),l=Qs(t[e+1],r),(e+=i)==n)return s[o++]=a,s[o++]=l,o}while(a==h&&l==u);for(;e<n;){const n=Qs(t[e],r),c=Qs(t[e+1],r);if(e+=i,n==a&&c==l)continue;const d=a-h,f=l-u,g=n-h,p=c-u;d*p==f*g&&(d<0&&g<d||d==g||d>0&&g>d)&&(f<0&&p<f||f==p||f>0&&p>f)?(a=n,l=c):(s[o++]=a,s[o++]=l,h=a,u=l,a=n,l=c)}return s[o++]=a,s[o++]=l,o}function to(t,e,n,i,r){r=void 0!==r?r:[];let s=0;for(let o=e;o<n;o+=i)r[s++]=t.slice(o,o+i);return r.length=s,r}function eo(t,e,n,i){let r=0,s=t[n-i],o=t[n-i+1];for(;e<n;e+=i){const n=t[e],i=t[e+1];r+=o*n-s*i,s=n,o=i}return r/2}class no extends Vs{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new no(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,i){return i<Gi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ys(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))}getArea(){return eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return to(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=function(t,e,n,i,r,s,o){const a=(n-e)/i;if(a<3){for(;e<n;e+=i)s[o++]=t[e],s[o++]=t[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,n-i];let u=0;for(;h.length>0;){const n=h.pop(),s=h.pop();let o=0;const a=t[s],c=t[s+1],d=t[n],f=t[n+1];for(let e=s+i;e<n;e+=i){const n=fr(t[e],t[e+1],a,c,d,f);n>o&&(u=e,o=n)}o>r&&(l[(u-e)/i]=1,s+i<u&&h.push(s,u),u+i<n&&h.push(u,n))}for(let n=0;n<a;++n)l[n]&&(s[o++]=t[e+n*i],s[o++]=t[e+n*i+1]);return o}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new no(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$s(this.flatCoordinates,0,t,this.stride),this.changed()}}var io=no;class ro extends Vs{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ro(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){const r=this.flatCoordinates,s=gr(t,e,r[0],r[1]);if(s<i){const t=this.stride;for(let e=0;e<t;++e)n[e]=r[e];return n.length=t,s}return i}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return function(t,e){const n=t[0],i=t[1];return Zi(n,i,n,i,e)}(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return qi(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,n,i){for(let i=0,r=n.length;i<r;++i)t[e++]=n[i];return e}(this.flatCoordinates,0,t,this.stride),this.changed()}}var so=ro;function oo(t,e,n,i,r){return!$i(r,(function(r){return!ao(t,e,n,i,r[0],r[1])}))}function ao(t,e,n,i,r,s){let o=0,a=t[n-i],l=t[n-i+1];for(;e<n;e+=i){const n=t[e],i=t[e+1];l<=s?i>s&&(n-a)*(s-l)-(r-a)*(i-l)>0&&o++:i<=s&&(n-a)*(s-l)-(r-a)*(i-l)<0&&o--,a=n,l=i}return 0!==o}function lo(t,e,n,i,r,s){if(0===n.length)return!1;if(!ao(t,e,n[0],i,r,s))return!1;for(let e=1,o=n.length;e<o;++e)if(ao(t,n[e-1],n[e],i,r,s))return!1;return!0}function ho(t,e,n,i,r){const s=Yi([1/0,1/0,-1/0,-1/0],t,e,n,i);return!!ur(r,s)&&(a=s,(o=r)[0]<=a[0]&&a[2]<=o[2]&&o[1]<=a[1]&&a[3]<=o[3]||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]||function(t,e,n,i,s){let o;for(e+=i;e<n;e+=i)if(a=t.slice(e-i,e),l=t.slice(e,e+i),o=function(t,e,n){let i=!1;const r=Ui(t,e),s=Ui(t,n);if(r===ji.INTERSECTING||s===ji.INTERSECTING)i=!0;else{const o=t[0],a=t[1],l=t[2],h=t[3],u=e[0],c=e[1],d=n[0],f=n[1],g=(f-c)/(d-u);let p,m;s&ji.ABOVE&&!(r&ji.ABOVE)&&(p=d-(f-h)/g,i=p>=o&&p<=l),i||!(s&ji.RIGHT)||r&ji.RIGHT||(m=f-(d-l)*g,i=m>=a&&m<=h),i||!(s&ji.BELOW)||r&ji.BELOW||(p=d-(f-a)/g,i=p>=o&&p<=l),i||!(s&ji.LEFT)||r&ji.LEFT||(m=f-(d-o)*g,i=m>=a&&m<=h)}return i}(r,a,l),o)return o;var a,l;return!1}(t,e,n,i));var o,a}function uo(t,e,n,i,r){return!!(ho(t,e,n,i,r)||ao(t,e,n,i,r[0],r[1])||ao(t,e,n,i,r[0],r[3])||ao(t,e,n,i,r[2],r[1])||ao(t,e,n,i,r[2],r[3]))}function co(t,e,n,i){for(;e<n-i;){for(let r=0;r<i;++r){const s=t[e+r];t[e+r]=t[n-i+r],t[n-i+r]=s}e+=i,n-=i}}function fo(t,e,n,i){let r=0,s=t[n-i],o=t[n-i+1];for(;e<n;e+=i){const n=t[e],i=t[e+1];r+=(n-s)*(i+o),s=n,o=i}return 0===r?void 0:r>0}function go(t,e,n,i,r){r=void 0!==r&&r;for(let s=0,o=n.length;s<o;++s){const o=n[s],a=fo(t,e,o,i);(0===s?r&&a||!r&&!a:r&&!a||!r&&a)&&co(t,e,o,i),e=o}return e}class po extends Vs{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?function(t,e){const n=Array.isArray(e)?e:[e],i=n.length;for(let e=0;e<i;e++)t[t.length]=n[e]}(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new po(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Gi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,n,i,r){for(let s=0,o=n.length;s<o;++s){const o=n[s];r=Ys(t,e,o,i,r),e=o}return r}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,n,i,r,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,d=n.length;c<d;++c){const d=n[c];h=Hs(t,e,d,i,r,s,o,a,l,h,u),e=d}return h}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return lo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return function(t,e,n,i){let r=0;for(let s=0,o=n.length;s<o;++s){const o=n[s];r+=eo(t,e,o,i),e=o}return r}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),go(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,function(t,e,n,i,r){r=void 0!==r?r:[];let s=0;for(let o=0,a=n.length;o<a;++o){const a=n[o];r[s++]=to(t,e,a,i,r[s]),e=a}return r.length=s,r}(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=er(this.getExtent());this.flatInteriorPoint_=function(t,e,n,i,r,s,o){let a,l,h,u,c,d,f;const g=r[s+1],p=[];for(let r=0,s=n.length;r<s;++r){const s=n[r];for(u=t[s-i],d=t[s-i+1],a=e;a<s;a+=i)c=t[a],f=t[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(c-u)+u,p.push(h)),u=c,d=f}let m=NaN,_=-1/0;for(p.sort(Jn),u=p[0],a=1,l=p.length;a<l;++a){c=p[a];const r=Math.abs(c-u);r>_&&(h=(u+c)/2,lo(t,e,n,i,h,g)&&(m=h,_=r)),u=c}return isNaN(m)&&(m=r[s]),o?(o.push(m,g,_),o):[m,g,_]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new so(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new io(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[];let r=0;for(let s=0,o=n.length;s<o;++s){const o=n[s],a=new io(e.slice(r,o),t);i.push(a),r=o}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function(t,e,n,i,r){r=void 0!==r&&r;for(let s=0,o=n.length;s<o;++s){const o=n[s],a=fo(t,e,o,i);if(0===s){if(r&&a||!r&&!a)return!1}else if(r&&!a||!r&&a)return!1;e=o}return!0}(t,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=go(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=function(t,e,n,i,r,s,o,a){for(let l=0,h=n.length;l<h;++l){const h=n[l];o=Js(t,e,h,i,r,s,o),a.push(o),e=h}return o}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new po(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return function(t,e,n,i,r){if(!uo(t,e,n[0],i,r))return!1;if(1===n.length)return!0;for(let e=1,s=n.length;e<s;++e)if(oo(t,n[e-1],n[e],i,r)&&!ho(t,n[e-1],n[e],i,r))return!1;return!0}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=function(t,e,n,i,r){r=r||[];let s=0;for(let o=0,a=n.length;o<a;++o){const a=$s(t,e,n[o],i);r[s++]=a,e=a}return r.length=s,r}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}var mo=po;function _o(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=[e,n,e,r,i,r,i,n,e,n];return new po(s,"XY",[s.length])}function yo(t,e){setTimeout((function(){t(e)}),0)}function vo(t){return!(t.sourceCenter&&t.targetCenter&&!ss(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}function wo(t,e,n,i,r){const s=Math.cos(-r);let o=Math.sin(-r),a=t[0]*s-t[1]*o,l=t[1]*s+t[0]*o;return a+=(e[0]/2-n[0])*i,l+=(n[1]-e[1]/2)*i,o=-o,[a*s-l*o,l*s+a*o]}var bo=class extends _i{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=vs(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&function(t){ds=!(void 0===t||t)}(),t.center&&(t.center=Ss(t.center,this.projection_)),t.extent&&(t.extent=As(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const t in zr)delete e[t];this.setProperties(e,!0);const n=function(t){let e,n,i;let r=void 0!==t.minZoom?t.minZoom:0,s=void 0!==t.maxZoom?t.maxZoom:28;const o=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,l=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,h=void 0!==t.showFullExtent&&t.showFullExtent,u=vs(t.projection,"EPSG:3857"),c=u.getExtent();let d=t.constrainOnlyCenter,f=t.extent;if(a||f||!u.isGlobal()||(d=!1,f=c),void 0!==t.resolutions){const o=t.resolutions;n=o[r],i=void 0!==o[s]?o[s]:o[o.length-1],e=t.constrainResolution?function(t,e,n,i){return e=void 0===e||e,function(r,s,o,a){if(void 0!==r){const l=t[0],h=t[t.length-1],u=n?Fs(l,n,o,i):l;if(a)return e?Ns(r,u,h):dr(r,h,u);const c=Math.min(u,r),d=Math.floor(ti(t,c,s));return t[d]>u&&d<t.length-1?t[d+1]:t[d]}}}(o,l,!d&&f,h):Ds(n,i,l,!d&&f,h)}else{const a=(c?Math.max(hr(c),sr(c)):360*qr.degrees/u.getMetersPerUnit())/Br/Math.pow(2,0),g=a/Math.pow(2,28);n=t.maxResolution,void 0!==n?r=0:n=a/Math.pow(o,r),i=t.minResolution,void 0===i&&(i=void 0!==t.maxZoom?void 0!==t.maxResolution?n/Math.pow(o,s):a/Math.pow(o,s):g),s=r+Math.floor(Math.log(n/i)/Math.log(o)),i=n/Math.pow(o,s-r),e=t.constrainResolution?function(t,e,n,i,r,s){return i=void 0===i||i,n=void 0!==n?n:0,function(o,a,l,h){if(void 0!==o){const u=r?Fs(e,r,l,s):e;if(h)return i?Ns(o,u,n):dr(o,n,u);const c=1e-9,d=Math.ceil(Math.log(e/u)/Math.log(t)-c),f=-a*(.5-c)+.5,g=Math.min(u,o),p=Math.floor(Math.log(e/g)/Math.log(t)+f),m=Math.max(d,p);return dr(e/Math.pow(t,m),n,u)}}}(o,n,i,l,!d&&f,h):Ds(n,i,l,!d&&f,h)}return{constraint:e,maxResolution:n,minResolution:i,minZoom:r,zoomFactor:o}}(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const i=function(t){if(void 0!==t.extent){const e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Ls(t.extent,t.constrainOnlyCenter,e)}const e=vs(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Ls(t,!1,!1)}return Os}(t),r=n.constraint,s=function(t){if(void 0===t.enableRotation||t.enableRotation){const n=t.constrainRotation;return void 0===n||!0===n?(e=e||pr(5),function(t,n){return n?t:void 0!==t?Math.abs(t)<=e?0:t:void 0}):!1===n?js:"number"==typeof n?function(t){const e=2*Math.PI/t;return function(t,n){return n?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(n):js}var e;return Ks}(t);this.constraints_={center:i,resolution:r,rotation:s},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const i=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),s=r/2*(i[3]-e[3]+e[1]-i[1]),o=r/2*(i[0]-e[0]+e[2]-i[2]);this.setCenterInternal([n[0]+s,n[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let t=0;t<e.length;++t){let n=arguments[t];n.center&&(n=Object.assign({},n),n.center=Ss(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Ss(n.anchor,this.getProjection())),e[t]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e,n=arguments.length;n>1&&"function"==typeof arguments[n-1]&&(e=arguments[n-1],--n);let i=0;for(;i<n&&!this.isDef();++i){const t=arguments[i];t.center&&this.setCenterInternal(t.center),void 0!==t.zoom?this.setZoom(t.zoom):t.resolution&&this.setResolution(t.resolution),void 0!==t.rotation&&this.setRotation(t.rotation)}if(i===n)return void(e&&yo(e,!0));let r=Date.now(),s=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const l=[];for(;i<n;++i){const t=arguments[i],n={start:r,complete:!1,anchor:t.anchor,duration:void 0!==t.duration?t.duration:1e3,easing:t.easing||Bs,callback:e};if(t.center&&(n.sourceCenter=s,n.targetCenter=t.center.slice(),s=n.targetCenter),void 0!==t.zoom?(n.sourceResolution=o,n.targetResolution=this.getResolutionForZoom(t.zoom),o=n.targetResolution):t.resolution&&(n.sourceResolution=o,n.targetResolution=t.resolution,o=n.targetResolution),void 0!==t.rotation){n.sourceRotation=a;const e=mr(t.rotation-a+Math.PI,2*Math.PI)-Math.PI;n.targetRotation=a+e,a=n.targetRotation}vo(n)?n.complete=!0:r+=n.duration,l.push(n)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,n=this.animations_.length;e<n;++e){const n=this.animations_[e];if(n[0].callback&&yo(n[0].callback,!1),!t)for(let e=0,i=n.length;e<i;++e){const i=n[e];if(!i.complete){t=i.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let r=!0;for(let n=0,s=i.length;n<s;++n){const s=i[n];if(s.complete)continue;const o=t-s.start;let a=s.duration>0?o/s.duration:1;a>=1?(s.complete=!0,a=1):r=!1;const l=s.easing(a);if(s.sourceCenter){const t=s.sourceCenter[0],e=s.sourceCenter[1],n=s.targetCenter[0],i=s.targetCenter[1];this.nextCenter_=s.targetCenter;const r=t+l*(n-t),o=e+l*(i-e);this.targetCenter_=[r,o]}if(s.sourceResolution&&s.targetResolution){const t=1===l?s.targetResolution:s.sourceResolution+l*(s.targetResolution-s.sourceResolution);if(s.anchor){const e=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(n,s.anchor)}this.nextResolution_=s.targetResolution,this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){const t=1===l?mr(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+l*(s.targetRotation-s.sourceRotation);if(s.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,s.anchor)}this.nextRotation_=s.targetRotation,this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!s.complete)break}if(r){this.animations_[n]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const t=i[0].callback;t&&yo(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const i=this.getCenterInternal();var r,s;return void 0!==i&&(n=[i[0]-e[0],i[1]-e[1]],os(n,t-this.getRotation()),s=e,(r=n)[0]+=+s[0],r[1]+=+s[1]),n}calculateCenterZoom(t,e){let n;const i=this.getCenterInternal(),r=this.getResolution();return void 0!==i&&void 0!==r&&(n=[e[0]-t*(e[0]-i[0])/r,e[1]-t*(e[1]-i[1])/r]),n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],i=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t?Ps(t,this.getProjection()):t}getCenterInternal(){return this.get(zr.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return e=this.calculateExtentInternal(t),n=this.getProjection(),Ts?Cs(e,n,Ts):e;var e,n}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Oi(e,1);const n=this.getResolution();Oi(void 0!==n,2);const i=this.getRotation();return Oi(void 0!==i,3),ir(e,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(zr.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(As(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=hr(t)/e[0],i=sr(t)/e[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(t);return function(n){return e/Math.pow(t,n*i)}}getRotation(){return this.get(zr.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(n/i)/e;return function(t){return Math.log(n/t)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const r=this.padding_;if(r){const t=this.getViewportSizeMinusPadding_();i=wo(i,this.getViewportSize_(),[t[0]/2+r[3],t[1]/2+r[0]],e,n)}return{center:i.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,n,i=this.minZoom_||0;if(this.resolutions_){const r=ti(this.resolutions_,t,1);i=r,e=this.resolutions_[r],n=r==this.resolutions_.length-1?2:e/this.resolutions_[r+1]}else e=this.maxResolution_,n=this.zoomFactor_;return i+Math.log(e/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=dr(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,dr(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(Oi(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))Oi(!cr(t),25),n=_o(As(t,this.getProjection()));else if("Circle"===t.getType()){const e=As(t.getExtent(),this.getProjection());n=_o(e),n.rotate(this.getRotation(),er(e))}else{const e=Rs();n=e?t.clone().transform(e,this.getProjection()):t}this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),i=Math.sin(-e),r=t.getFlatCoordinates(),s=t.getStride();let o=1/0,a=1/0,l=-1/0,h=-1/0;for(let t=0,e=r.length;t<e;t+=s){const e=r[t]*n-r[t+1]*i,s=r[t]*i+r[t+1]*n;o=Math.min(o,e),a=Math.min(a,s),l=Math.max(l,e),h=Math.max(h,s)}return[o,a,l,h]}fitInternal(t,e){let n=(e=e||{}).size;n||(n=this.getViewportSizeMinusPadding_());const i=void 0!==e.padding?e.padding:[0,0,0,0],r=void 0!==e.nearest&&e.nearest;let s;s=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const o=this.rotatedExtentForGeometry(t);let a=this.getResolutionForExtentInternal(o,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);a=isNaN(a)?s:Math.max(a,s),a=this.getConstrainedResolution(a,r?0:1);const l=this.getRotation(),h=Math.sin(l),u=Math.cos(l),c=er(o);c[0]+=(i[1]-i[3])/2*a,c[1]+=(i[0]-i[2])/2*a;const d=c[0]*u-c[1]*h,f=c[1]*u+c[0]*h,g=this.getConstrainedCenter([d,f],a),p=e.callback?e.callback:ri;void 0!==e.duration?this.animateInternal({resolution:a,center:g,duration:e.duration,easing:e.easing},p):(this.targetResolution_=a,this.targetCenter_=g,this.applyTargetState_(!1,!0),yo(p,!0))}centerOn(t,e,n){this.centerOnInternal(Ss(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(wo(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,i){let r;const s=this.padding_;if(s&&t){const o=this.getViewportSizeMinusPadding_(-n),a=wo(t,i,[o[0]/2+s[3],o[1]/2+s[0]],e,n);r=[t[0]-a[0],t[1]-a[1]]}return r}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=Ps(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Ss(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,i,n);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Ss(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t?Ss(t,this.getProjection()):t)}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,0,r,n),o=this.constraints_.center(this.targetCenter_,s,r,n,this.calculateCenterShift(this.targetCenter_,s,i,r));this.get(zr.ROTATION)!==i&&this.set(zr.ROTATION,i),this.get(zr.RESOLUTION)!==s&&(this.set(zr.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),o&&this.get(zr.CENTER)&&ss(this.get(zr.CENTER),o)||this.set(zr.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=void 0!==t?t:200;const i=e||0,r=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,i,s),a=this.constraints_.center(this.targetCenter_,o,s,!1,this.calculateCenterShift(this.targetCenter_,o,r,s));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=r,this.targetCenter_=a,void this.applyTargetState_();n=n||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===r&&this.getCenterInternal()&&ss(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:a,resolution:o,duration:t,easing:Gs,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,n){n=n&&Ss(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(1,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}};function xo(t,e){if(!t.visible)return!1;const n=e.resolution;if(n<t.minResolution||n>=t.maxResolution)return!1;const i=e.zoom;return i>t.minZoom&&i<=t.maxZoom}var Eo=class extends Dr{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Nr,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(Nr)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ui(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=li(t,ai.CHANGE,this.handleSourceChange_,this),"ready"===t.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}isVisible(t){let e;e=t instanceof bo?{viewState:t.getState(),extent:t.calculateExtent()}:t;const n=this.getExtent();return this.getVisible()&&xo(this.getLayerState(),e.viewState)&&(!n||ur(n,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];let i=e(t instanceof bo?t.getViewStateAndExtent():t);return Array.isArray(i)||(i=[i]),i}render(t,e){const n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(ui(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ui(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=li(t,Kr,(function(t){const e=t.frameState.layerStatesArray,n=this.getLayerState(!1);Oi(!e.some((function(t){return t.layer===n.layer})),67),e.push(n)}),this),this.mapRenderKey_=li(this,ai.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Nr,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function Co(t,e){Pr.expire()}var To=class extends Qn{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){fi()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,i=t.pixelToCoordinateTransform;Ni(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Di(i,n)}forEachFeatureAtCoordinate(t,e,n,i,r,s,o,a){let l;const h=e.viewState;function u(t,e,n,i){return r.call(s,e,t?n:null,i)}const c=h.projection,d=function(t,e){if(e.canWrapX()){const n=hr(e.getExtent()),i=function(t,e,n){const i=e.getExtent();let r=0;return e.canWrapX()&&(t[0]<i[0]||t[0]>i[2])&&(n=n||hr(i),r=Math.floor((t[0]-i[0])/n)),r}(t,e,n);i&&(t[0]-=i*n)}return t}(t.slice(),c),f=[[0,0]];if(c.canWrapX()&&i){const t=hr(c.getExtent());f.push([-t,0],[t,0])}const g=e.layerStatesArray,p=g.length,m=[],_=[];for(let i=0;i<f.length;i++)for(let r=p-1;r>=0;--r){const s=g[r],c=s.layer;if(c.hasRenderer()&&xo(s,h)&&o.call(a,c)){const r=c.getRenderer(),o=c.getSource();if(r&&o){const a=o.getWrapX()?d:t,h=u.bind(null,s.managed);_[0]=a[0]+f[i][0],_[1]=a[1]+f[i][1],l=r.forEachFeatureAtCoordinate(_,e,n,h,m)}if(l)return l}}if(0===m.length)return;const y=1/m.length;return m.forEach(((t,e)=>t.distanceSq+=e*y)),m.sort(((t,e)=>t.distanceSq-e.distanceSq)),m.some((t=>l=t.callback(t.feature,t.layer,t.geometry))),l}hasFeatureAtCoordinate(t,e,n,i,r,s){return void 0!==this.forEachFeatureAtCoordinate(t,e,n,i,ni,this,r,s)}getMap(){return this.map_}renderFrame(t){fi()}scheduleExpireIconCache(t){Pr.canExpireCache()&&t.postRenderFunctions.push(Co)}},Ro=class extends Hn{constructor(t,e,n,i){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=i}};const Po="ol-hidden",So="ol-unselectable",Ao="ol-control",Io="ol-collapsed";new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i");function Mo(t,e,n,i){let r;return r=n&&n.length?n.shift():Mi?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(r.width=t),e&&(r.height=e),r.getContext("2d",i)}function ko(t){const e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}function Lo(t,e){const n=e.parentNode;n&&n.replaceChild(t,e)}function Oo(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}const Fo=new _i;!function(){const t=["monospace","serif"];t.length}();var No=class extends To{constructor(t){super(t),this.fontChangeListenerKey_=li(Fo,$n,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=So+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const i=new Ro(t,void 0,e);n.dispatchEvent(i)}}disposeInternal(){ui(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(Kr,t);const e=t.layerStatesArray.sort((function(t,e){return t.zIndex-e.zIndex})),n=t.viewState;this.children_.length=0;const i=[];let r=null;for(let s=0,o=e.length;s<o;++s){const o=e[s];t.layerIndex=s;const a=o.layer,l=a.getSourceState();if(!xo(o,n)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const h=a.render(t,r);h&&(h!==r&&(this.children_.push(h),r=h),"getDeclutter"in a&&i.push(a))}for(let e=i.length-1;e>=0;--e)i[e].renderDeclutter(t);!function(t,e){const n=t.childNodes;for(let i=0;;++i){const r=n[i],s=e[i];if(!r&&!s)break;r!==s&&(r?s?t.insertBefore(s,r):(t.removeChild(r),--i):t.appendChild(s))}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}};class Do extends Hn{constructor(t,e){super(t),this.layer=e}}const Ko="layers";class jo extends Dr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ko,this.handleLayersChanged_),n?Array.isArray(n)?n=new Ti(n.slice(),{unique:!0}):Oi("function"==typeof n.getArray,43):n=new Ti(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ui),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(li(t,bi,this.handleLayersAdd_,this),li(t,xi,this.handleLayersRemove_,this));for(const t in this.listenerKeys_)this.listenerKeys_[t].forEach(ui);si(this.listenerKeys_);const e=t.getArray();for(let t=0,n=e.length;t<n;t++){const n=e[t];this.registerLayerListeners_(n),this.dispatchEvent(new Do("addlayer",n))}this.changed()}registerLayerListeners_(t){const e=[li(t,$n,this.handleLayerChange_,this),li(t,ai.CHANGE,this.handleLayerChange_,this)];t instanceof jo&&e.push(li(t,"addlayer",this.handleLayerGroupAdd_,this),li(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[pi(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Do("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Do("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Do("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=pi(e);this.listenerKeys_[n].forEach(ui),delete this.listenerKeys_[n],this.dispatchEvent(new Do("removelayer",e)),this.changed()}getLayers(){return this.get(Ko)}setLayers(t){const e=this.getLayers();if(e){const t=e.getArray();for(let e=0,n=t.length;e<n;++e)this.dispatchEvent(new Do("removelayer",t[e]))}this.set(Ko,t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach((function(e){e.getLayersArray(t)})),t}getLayerStatesArray(t){const e=void 0!==t?t:[],n=e.length;this.getLayers().forEach((function(t){t.getLayerStatesArray(e)}));const i=this.getLayerState();let r=i.zIndex;t||void 0!==i.zIndex||(r=0);for(let t=n,s=e.length;t<s;t++){const n=e[t];n.opacity*=i.opacity,n.visible=n.visible&&i.visible,n.maxResolution=Math.min(n.maxResolution,i.maxResolution),n.minResolution=Math.max(n.minResolution,i.minResolution),n.minZoom=Math.max(n.minZoom,i.minZoom),n.maxZoom=Math.min(n.maxZoom,i.maxZoom),void 0!==i.extent&&(void 0!==n.extent?n.extent=or(n.extent,i.extent):n.extent=i.extent),void 0===n.zIndex&&(n.zIndex=r)}return e}getSourceState(){return"ready"}}var zo=jo,Go=class extends Hn{constructor(t,e,n){super(t),this.map=e,this.frameState=void 0!==n?n:null}},Bo=class extends Go{constructor(t,e,n,i,r,s){super(t,e,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==i&&i,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},qo={SINGLECLICK:"singleclick",CLICK:ai.CLICK,DBLCLICK:ai.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Uo="pointerdown",Zo=class extends oi{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=li(n,Uo,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=li(n,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ai.TOUCHMOVE,this.boundHandleTouchMove_,!!Li&&{passive:!1})}emulateClick_(t){let e=new Bo(qo.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Bo(qo.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const e=new Bo(qo.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}),250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==qo.POINTERUP||e.type==qo.POINTERCANCEL){delete this.trackedTouches_[n];for(const t in this.trackedTouches_)if(this.trackedTouches_[t].target!==e.target){delete this.trackedTouches_[t];break}}else e.type!=qo.POINTERDOWN&&e.type!=qo.POINTERMOVE||(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Bo(qo.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(ui),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new Bo(qo.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),0===this.dragListenerKeys_.length){const t=this.map_.getOwnerDocument();this.dragListenerKeys_.push(li(t,qo.POINTERMOVE,this.handlePointerMove_,this),li(t,qo.POINTERUP,this.handlePointerUp_,this),li(this.element_,qo.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==t&&this.dragListenerKeys_.push(li(this.element_.getRootNode(),qo.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Bo(qo.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Bo(qo.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(ui(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ai.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ui(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ui),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},Xo="postrender",Vo="loadstart",Wo="loadend",Yo="layergroup",Ho="size",$o="target",Qo="view";const Jo=1/0;var ta=class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,si(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){Oi(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=Jo&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,i=e.length,r=e[t],s=n[t],o=t;for(;t<i>>1;){const r=this.getLeftChildIndex_(t),s=this.getRightChildIndex_(t),o=s<i&&n[s]<n[r]?s:r;e[t]=e[o],n[t]=n[o],t=o}e[t]=r,n[t]=s,this.siftDown_(o,t)}siftDown_(t,e){const n=this.elements_,i=this.priorities_,r=n[e],s=i[e];for(;e>t;){const t=this.getParentIndex_(e);if(!(i[t]>s))break;n[e]=n[t],i[e]=i[t],e=t}n[e]=r,i[e]=s}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let i=0;const r=e.length;let s,o,a;for(o=0;o<r;++o)s=e[o],a=t(s),a==Jo?delete this.queuedElements_[this.keyFunction_(s)]:(n[i]=a,e[i++]=s);e.length=i,n.length=i,this.heapify_()}},ea=class extends ta{constructor(t,e){super((function(e){return t.apply(null,e)}),(function(t){return t[0].getKey()})),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(ai.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(2===n||3===n||4===n){3!==n&&e.removeEventListener(ai.CHANGE,this.boundHandleTileChange_);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n,i,r,s=0;for(;this.tilesLoading_<t&&s<e&&this.getCount()>0;)i=this.dequeue()[0],r=i.getKey(),n=i.getState(),0!==n||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++s,i.load())}},na=class extends _i{constructor(t){super();const e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Oo(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Oo(this.element);for(let t=0,e=this.listenerKeys.length;t<e;++t)ui(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ri&&this.listenerKeys.push(li(t,Xo,this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},ia=class extends na{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",n=void 0!==t.tipLabel?t.tipLabel:"Attributions",i=void 0!==t.expandClassName?t.expandClassName:e+"-expand",r=void 0!==t.collapseLabel?t.collapseLabel:"",s=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=s):this.collapseLabel_=r;const o=void 0!==t.label?t.label:"i";"string"==typeof o?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=i):this.label_=o;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(ai.CLICK,this.handleClick_.bind(this),!1);const l=e+" "+So+" "+Ao+(this.collapsed_&&this.collapsible_?" "+Io:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=l,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap((e=>e.getAttributions(t))))),n=!this.getMap().getAllLayers().some((t=>t.getSource()&&!1===t.getSource().getAttributionsCollapsible()));return this.overrideCollapsible_||this.setCollapsible(n),e}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!ei(e,this.renderedAttributions_)){!function(t){for(;t.lastChild;)t.removeChild(t.lastChild)}(this.ulElement_);for(let t=0,n=e.length;t<n;++t){const n=document.createElement("li");n.innerHTML=e[t],this.ulElement_.appendChild(n)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Io),this.collapsed_?Lo(this.collapseLabel_,this.label_):Lo(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},ra=class extends na{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",n=void 0!==t.label?t.label:"",i=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof n?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));const r=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=e+"-reset",s.setAttribute("type","button"),s.title=r,s.appendChild(this.label_),s.addEventListener(ai.CLICK,this.handleClick_.bind(this),!1);const o=e+" "+So+" "+Ao,a=this.element;a.className=o,a.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Po)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Gs}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const t="rotate("+n+"rad)";if(this.autoHide_){const t=this.element.classList.contains(Po);t||0!==n?t&&0!==n&&this.element.classList.remove(Po):this.element.classList.add(Po)}this.label_.style.transform=t}this.rotation_=n}},sa=class extends na{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",n=void 0!==t.delta?t.delta:1,i=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",r=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",s=void 0!==t.zoomInLabel?t.zoomInLabel:"+",o=void 0!==t.zoomOutLabel?t.zoomOutLabel:"",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",l=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=i,h.setAttribute("type","button"),h.title=a,h.appendChild("string"==typeof s?document.createTextNode(s):s),h.addEventListener(ai.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=l,u.appendChild("string"==typeof o?document.createTextNode(o):o),u.addEventListener(ai.CLICK,this.handleClick_.bind(this,-n),!1);const c=e+" "+So+" "+Ao,d=this.element;d.className=c,d.appendChild(h),d.appendChild(u),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const n=e.getZoom();if(void 0!==n){const i=e.getConstrainedZoom(n+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:i,duration:this.duration_,easing:Gs})):e.setZoom(i)}}},oa="active";function aa(t,e,n,i){const r=t.getZoom();if(void 0===r)return;const s=t.getConstrainedZoom(r+e),o=t.getResolutionForZoom(s);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:o,anchor:n,duration:void 0!==i?i:250,easing:Gs})}var la=class extends _i{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(oa)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(oa,t)}setMap(t){this.map_=t}},ha=class extends la{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==qo.DBLCLICK){const n=t.originalEvent,i=t.map,r=t.coordinate,s=n.shiftKey?-this.delta_:this.delta_;aa(i.getView(),s,r,this.duration_),n.preventDefault(),e=!0}return!e}};function ua(t){const e=t.length;let n=0,i=0;for(let r=0;r<e;r++)n+=t[r].clientX,i+=t[r].clientY;return{clientX:n/e,clientY:i/e}}var ca=class extends la{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==qo.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==qo.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(t.type==qo.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==qo.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function da(t){const e=arguments;return function(t){let n=!0;for(let i=0,r=e.length;i<r&&(n=n&&e[i](t),n);++i);return n}}const fa=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ga=function(t){return!t.map.getTargetElement().hasAttribute("tabindex")||function(t){const e=t.map.getTargetElement(),n=t.map.getOwnerDocument().activeElement;return e.contains(n)}(t)},pa=ni,ma=function(t){const e=t.originalEvent;return 0==e.button&&!(Si&&Ai&&e.ctrlKey)},_a=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ya=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},va=function(t){const e=t.originalEvent,n=e.target.tagName;return"INPUT"!==n&&"SELECT"!==n&&"TEXTAREA"!==n&&!e.target.isContentEditable},wa=function(t){const e=t.originalEvent;return Oi(void 0!==e,56),"mouse"==e.pointerType},ba=function(t){const e=t.originalEvent;return Oi(void 0!==e,56),e.isPrimary&&0===e.button};var xa=class extends ca{constructor(t){super({stopDown:ii}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:da(_a,ba);this.condition_=t.onFocusOnly?da(ga,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,i=e.getEventPixel(ua(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const e=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],n=t.map.getView();r=e,s=n.getResolution(),r[0]*=s,r[1]*=s,os(e,n.getRotation()),n.adjustCenterInternal(e)}}else this.kinetic_&&this.kinetic_.begin();var r,s;this.lastCentroid=i,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),r=n.getCenterInternal(),s=e.getPixelFromCoordinateInternal(r),o=e.getCoordinateFromPixelInternal([s[0]-t*Math.cos(i),s[1]-t*Math.sin(i)]);n.animateInternal({center:n.getConstrainedCenter(o),duration:500,easing:Gs})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Ea=class extends ca{constructor(t){t=t||{},super({stopDown:ii}),this.condition_=t.condition?t.condition:fa,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!wa(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===Ks)return;const i=e.getSize(),r=t.pixel,s=Math.atan2(i[1]/2-r[1],r[0]-i[0]/2);if(void 0!==this.lastAngle_){const t=s-this.lastAngle_;n.adjustRotationInternal(-t)}this.lastAngle_=s}handleUpEvent(t){return!wa(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!wa(t)&&(!(!ma(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}},Ca=class extends Qn{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(t[0],e[0])+n,i.top=Math.min(t[1],e[1])+n,i.width=Math.abs(e[0]-t[0])+n,i.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new mo([n])}getGeometry(){return this.geometry_}};class Ta extends Hn{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}var Ra=class extends ca{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Ca(t.className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:ma,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const i=n[0]-e[0],r=n[1]-e[1];return i*i+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ta("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ta(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ta("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},Pa=class extends Ra{constructor(t){super({condition:(t=t||{}).condition?t.condition:ya,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const e=this.getMap().getView();let n=this.getGeometry();if(this.out_){const t=e.rotatedExtentForGeometry(n),i=e.getResolutionForExtentInternal(t),r=e.getResolution()/i;n=n.clone(),n.scale(r*r)}e.fitInternal(n,{duration:this.duration_,easing:Gs})}},Sa=class extends la{constructor(t){super(),t=t||{},this.defaultCondition_=function(t){return _a(t)&&va(t)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==ai.KEYDOWN){const n=t.originalEvent,i=n.keyCode;if(this.condition_(t)&&(40==i||37==i||39==i||38==i)){const r=t.map.getView(),s=r.getResolution()*this.pixelDelta_;let o=0,a=0;40==i?a=-s:37==i?o=-s:39==i?o=s:a=s;const l=[o,a];os(l,r.getRotation()),function(t,e,n){const i=t.getCenterInternal();if(i){const r=[i[0]+e[0],i[1]+e[1]];t.animateInternal({duration:void 0!==n?n:250,easing:qs,center:t.getConstrainedCenter(r)})}}(r,l,this.duration_),n.preventDefault(),e=!0}}return!e}},Aa=class extends la{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:va,this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if(t.type==ai.KEYDOWN||t.type==ai.KEYPRESS){const n=t.originalEvent,i=n.key;if(this.condition_(t)&&("+"===i||"-"===i)){const r=t.map,s="+"===i?this.delta_:-this.delta_;aa(r.getView(),s,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}},Ia=class extends la{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:pa;this.condition_=t.onFocusOnly?da(ga,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t))return!0;if(t.type!==ai.WHEEL)return!0;const e=t.map,n=t.originalEvent;let i;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==ai.WHEEL&&(i=n.deltaY,Pi&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=Ii),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)),0===i)return!1;this.lastDelta_=i;const r=Date.now();void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(i)<4?"trackpad":"wheel");const s=e.getView();if("trackpad"===this.mode_&&!s.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(s.getAnimating()&&s.cancelAnimations(),s.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),s.adjustZoom(-i/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=i;const o=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),o),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-dr(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),aa(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Ma=class extends ca{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=ii),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],i=this.targetPointers[1],r=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(void 0!==this.lastAngle_){const t=r-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=r;const s=t.map,o=s.getView();o.getConstraints().rotation!==Ks&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(ua(this.targetPointers))),this.rotating_&&(s.render(),o.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},ka=class extends ca{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=ii),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],i=this.targetPointers[1],r=n.clientX-i.clientX,s=n.clientY-i.clientY,o=Math.sqrt(r*r+s*s);void 0!==this.lastDistance_&&(e=this.lastDistance_/o),this.lastDistance_=o;const a=t.map,l=a.getView();1!=e&&(this.lastScaleDelta_=e),this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(ua(this.targetPointers))),a.render(),l.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function La(t){return t[0]>0&&t[1]>0}function Oa(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}function Fa(t){t instanceof Eo?t.setMapInternal(null):t instanceof zo&&t.getLayers().forEach(Fa)}function Na(t,e){if(t instanceof Eo)t.setMapInternal(e);else if(t instanceof zo){const n=t.getLayers().getArray();for(let t=0,i=n.length;t<i;++t)Na(n[t],e)}}var Da=class extends _i{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);const n={},i=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new zo({layers:t.layers});let r,s,o;return n[Yo]=i,n[$o]=t.target,n[Qo]=t.view instanceof bo?t.view:new bo,void 0!==t.controls&&(Array.isArray(t.controls)?r=new Ti(t.controls.slice()):(Oi("function"==typeof t.controls.getArray,47),r=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?s=new Ti(t.interactions.slice()):(Oi("function"==typeof t.interactions.getArray,48),s=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?o=new Ti(t.overlays.slice()):(Oi("function"==typeof t.overlays.getArray,49),o=t.overlays):o=new Ti,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:n}}(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Ii,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=e.controls||function(t){t=t||{};const e=new Ti;return(void 0===t.zoom||t.zoom)&&e.push(new sa(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&e.push(new ra(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&e.push(new ia(t.attributionOptions)),e}(),this.interactions=e.interactions||function(t){t=t||{};const e=new Ti,n=new class{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const i=this.points_[e+2]-this.points_[n+2];if(i<1e3/60)return!1;const r=this.points_[e]-this.points_[n],s=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(s,r),this.initialVelocity_=Math.sqrt(r*r+s*s)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&e.push(new Ea),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&e.push(new ha({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&e.push(new xa({onFocusOnly:t.onFocusOnly,kinetic:n})),(void 0===t.pinchRotate||t.pinchRotate)&&e.push(new Ma),(void 0===t.pinchZoom||t.pinchZoom)&&e.push(new ka({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(e.push(new Sa),e.push(new Aa({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&e.push(new Ia({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&e.push(new Pa({duration:t.zoomDuration})),e}({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ea(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Yo,this.handleLayerGroupChanged_),this.addChangeListener(Qo,this.handleViewChanged_),this.addChangeListener(Ho,this.handleSizeChanged_),this.addChangeListener($o,this.handleTargetChanged_),this.setProperties(e.values);const n=this;!t.view||t.view instanceof bo||t.view.then((function(t){n.setView(new bo(t))})),this.controls.addEventListener(bi,(t=>{t.element.setMap(this)})),this.controls.addEventListener(xi,(t=>{t.element.setMap(null)})),this.interactions.addEventListener(bi,(t=>{t.element.setMap(this)})),this.interactions.addEventListener(xi,(t=>{t.element.setMap(null)})),this.overlays_.addEventListener(bi,(t=>{this.addOverlayInternal_(t.element)})),this.overlays_.addEventListener(xi,(t=>{const e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)})),this.controls.forEach((t=>{t.setMap(this)})),this.interactions.forEach((t=>{t.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Na(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(t),r=void 0!==(n=void 0!==n?n:{}).hitTolerance?n.hitTolerance:0,s=void 0!==n.layerFilter?n.layerFilter:ni,o=!1!==n.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,r,o,e,null,s,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,(function(t){n.push(t)}),e),n}getAllLayers(){const t=[];return function e(n){n.forEach((function(n){n instanceof zo?e(n.getLayers()):t.push(n)}))}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t),i=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:ni,r=void 0!==e.hitTolerance?e.hitTolerance:0,s=!1!==e.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,s,i,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),n=this.getSize(),i=e.width/n[0],r=e.height/n[1],s="changedTouches"in t?t.changedTouches[0]:t;return[(s.clientX-e.left)/i,(s.clientY-e.top)/r]}getTarget(){return this.get($o)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Ps(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Fi(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Yo)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Ti)return void e.setLayers(t);const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const n=t[e];if(!n.visible)continue;const i=n.layer.getRenderer();if(i&&!i.ready)return!0;const r=n.layer.getSource();if(r&&r.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Ss(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Fi(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Ho)}getView(){return this.get(Qo)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,i){return function(t,e,n,i,r){if(!t||!(n in t.wantedTiles))return Jo;if(!t.wantedTiles[n][e.getKey()])return Jo;const s=t.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}(this.frameState_,t,e,n,i)}handleBrowserEvent(t,e){e=e||t.type;const n=new Bo(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===Uo||n===ai.WHEEL||n===ai.KEYDOWN){const t=this.getOwnerDocument(),n=this.viewport_.getRootNode?this.viewport_.getRootNode():t,i=e.target;if(this.overlayContainerStopEvent_.contains(i)||!(n===t?t.documentElement:n).contains(i))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const e=this.getInteractions().getArray().slice();for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.getMap()===this&&i.getActive()&&this.getTargetElement()&&(!i.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,i=n;if(t){const e=t.viewHints;if(e[0]||e[1]){const e=Date.now()-t.time>8;n=e?0:8,i=e?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,i))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener(jr)&&this.renderer_.dispatchRenderEvent(jr,t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new Go(Wo,this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new Go(Vo,this,t))));const n=this.postRenderFunctions_;for(let e=0,i=n.length;e<i;++e)n[e](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)ui(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ai.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ai.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Oo(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const t=this.targetElement_.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.unobserve(t.host)}const t=this.getTarget(),e="string"==typeof t?document.getElementById(t):t;if(this.targetElement_=e,e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new No(this)),this.mapBrowserEventHandler_=new Zo(this,this.moveTolerance_);for(const t in qo)this.mapBrowserEventHandler_.addEventListener(qo[t],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ai.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ai.WHEEL,this.boundHandleBrowserEvent_,!!Li&&{passive:!1});const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[li(t,ai.KEYDOWN,this.handleBrowserEvent,this),li(t,ai.KEYPRESS,this.handleBrowserEvent,this)];const n=e.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(e)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(ui(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ui(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=li(t,$n,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=li(t,ai.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ui),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Do("addlayer",t)),this.layerGroupPropertyListenerKeys_=[li(t,$n,this.render,this),li(t,ai.CHANGE,this.render,this),li(t,"addlayer",this.handleLayerAdd_,this),li(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Fa(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),i=this.frameState_;let r=null;if(void 0!==e&&La(e)&&n&&n.isDef()){const i=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),s=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:ir(s.center,s.resolution,s.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:s,viewHints:i,wantedTiles:{},mapId:pi(this),renderTargets:{}},s.nextCenter&&s.nextResolution){const t=isNaN(s.nextRotation)?s.rotation:s.nextRotation;r.nextExtent=ir(s.nextCenter,s.nextResolution,t,e)}}var s,o;this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),i&&(!this.previousExtent_||!cr(this.previousExtent_)&&!Vi(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Go("movestart",this,i)),this.previousExtent_=Xi(this.previousExtent_)),this.previousExtent_&&!r.viewHints[0]&&!r.viewHints[1]&&!Vi(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Go("moveend",this,r)),s=r.extent,(o=this.previousExtent_)?(o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3]):s.slice())),this.dispatchEvent(new Go(Xo,this,r)),this.renderComplete_=this.hasListener(Vo)||this.hasListener(Wo)||this.hasListener(jr)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Do("removelayer",e)),this.set(Yo,t)}setSize(t){this.set(Ho,t)}setTarget(t){this.set($o,t)}setView(t){if(!t||t instanceof bo)return void this.set(Qo,t);this.set(Qo,new bo);const e=this;t.then((function(t){e.setView(new bo(t))}))}updateSize(){const t=this.getTargetElement();let e;if(t){const n=getComputedStyle(t),i=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),r=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);isNaN(i)||isNaN(r)||(e=[i,r],!La(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&cs("No map visible because the map container's width or height are 0."))}const n=this.getSize();!e||n&&ei(e,n)||(this.setSize(e),this.updateViewportSize_())}updateViewportSize_(){const t=this.getView();if(t){let e;const n=getComputedStyle(this.viewport_);n.width&&n.height&&(e=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(e)}}},Ka=class extends oi{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===n.transition?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(ai.CHANGE)}release(){3===this.state&&this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){fi()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(n){if(-1===n)return 1}else n=e,this.transitionStarts_[t]=n;const i=e-n+1e3/60;return i>=this.transition_?1:zs(i/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}};var ja=class extends Ka{constructor(t,e,n,i,r,s){super(t,e,s),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,null!==i&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=3,this.unlistenImage_(),this.image_=function(){const t=Mo(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=2:this.state=4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=function(t,e,n){const i=t;let r=!0,s=!1,o=!1;const a=[hi(i,ai.LOAD,(function(){o=!0,s||e()}))];return i.src&&ki?(s=!0,i.decode().then((function(){r&&e()})).catch((function(t){r&&(o?e():n())}))):a.push(hi(i,ai.ERROR,n)),function(){r=!1,a.forEach(ui)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};let za;const Ga=[];function Ba(t,e,n,i,r){t.beginPath(),t.moveTo(0,0),t.lineTo(e,n),t.lineTo(i,r),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,i)+1,Math.max(n,r)),t.restore()}function qa(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function Ua(t,e,n,i){const r=Es(n,e,t);let s=_s(e,i,n);const o=e.getMetersPerUnit();void 0!==o&&(s*=o);const a=t.getMetersPerUnit();void 0!==a&&(s/=a);const l=t.getExtent();if(!l||Bi(l,r)){const e=_s(t,s,r)/s;isFinite(e)&&e>0&&(s/=e)}return s}var Za=class extends Ka{constructor(t,e,n,i,r,s,o,a,l,h,u,c){super(r,0,{interpolate:!!c}),this.renderEdges_=void 0!==u&&u,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=i,this.wrappedTileCoord_=s||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const d=i.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const p=f?or(d,f):d;if(0===Qi(p))return void(this.state=4);const m=t.getExtent();m&&(g=g?or(g,m):m);const _=i.getResolution(this.wrappedTileCoord_[0]),y=function(t,e,n,i){const r=er(n);let s=Ua(t,e,r,i);return(!isFinite(s)||s<=0)&&$i(n,(function(n){return s=Ua(t,e,n,i),isFinite(s)&&s>0})),s}(t,n,p,_);if(!isFinite(y)||y<=0)return void(this.state=4);const v=void 0!==h?h:.5;if(this.triangulation_=new class{constructor(t,e,n,i,r,s){this.sourceProj_=t,this.targetProj_=e;let o={};const a=xs(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=i,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&hr(i)==hr(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?hr(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?hr(this.targetProj_.getExtent()):null;const l=ar(n),h=lr(n),u=tr(n),c=Ji(n),d=this.transformInv_(l),f=this.transformInv_(h),g=this.transformInv_(u),p=this.transformInv_(c),m=10+(s?Math.max(0,Math.ceil(Math.log2(Qi(n)/(s*s*256*256)))):0);if(this.addQuad_(l,h,u,c,d,f,g,p,m),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach((function(e,n,i){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach((e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const n=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];n[0][0]-t>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-t>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-t>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);const i=Math.min(n[0][0],n[1][0],n[2][0]);Math.max(n[0][0],n[1][0],n[2][0])-i<this.sourceWorldWidth_/2&&(e.source=n)}}))}o={}}addTriangle_(t,e,n,i,r,s){this.triangles_.push({source:[i,r,s],target:[t,e,n]})}addQuad_(t,e,n,i,r,s,o,a,l){const h=zi([r,s,o,a]),u=this.sourceWorldWidth_?hr(h)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(f=hr(zi([t,e,n,i]))/this.targetWorldWidth_>.25||f),!d&&this.sourceProj_.isGlobal()&&u&&(f=u>.25||f)),!f&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!ur(h,this.maxSourceExtent_))return;let g=0;if(!(f||isFinite(r[0])&&isFinite(r[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])))if(l>0)f=!0;else if(g=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(s[0])&&isFinite(s[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=g&&2!=g&&4!=g&&8!=g)return;if(l>0){if(!f){const e=[(t[0]+n[0])/2,(t[1]+n[1])/2],i=this.transformInv_(e);let s;s=d?(mr(r[0],c)+mr(o[0],c))/2-mr(i[0],c):(r[0]+o[0])/2-i[0];const a=(r[1]+o[1])/2-i[1];f=s*s+a*a>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const h=[(e[0]+n[0])/2,(e[1]+n[1])/2],u=this.transformInv_(h),c=[(i[0]+t[0])/2,(i[1]+t[1])/2],d=this.transformInv_(c);this.addQuad_(t,e,h,c,r,s,u,d,l-1),this.addQuad_(c,h,n,i,d,u,o,a,l-1)}else{const h=[(t[0]+e[0])/2,(t[1]+e[1])/2],u=this.transformInv_(h),c=[(n[0]+i[0])/2,(n[1]+i[1])/2],d=this.transformInv_(c);this.addQuad_(t,h,c,i,r,u,d,a,l-1),this.addQuad_(h,e,n,c,u,s,o,d,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&g)&&this.addTriangle_(t,n,i,r,o,a),0==(14&g)&&this.addTriangle_(t,n,e,r,o,s),g&&(0==(13&g)&&this.addTriangle_(e,i,t,s,a,r),0==(7&g)&&this.addTriangle_(e,i,n,s,a,o))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,n,i){const r=e.source;Wi(t,r[0]),Wi(t,r[1]),Wi(t,r[2])})),t}getTriangles(){return this.triangles_}}(t,n,p,g,y*v,_),0===this.triangulation_.getTriangles().length)return void(this.state=4);this.sourceZ_=e.getZForResolution(y);let w=this.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(w[1]=dr(w[1],g[1],g[3]),w[3]=dr(w[3],g[1],g[3])):w=or(w,g)),Qi(w)){const t=e.getTileRangeForExtentAndZ(w,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let n=t.minY;n<=t.maxY;n++){const t=l(this.sourceZ_,e,n,o);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((e=>{e&&2==e.getState()&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})})),this.sourceTiles_.length=0,0===t.length)this.state=3;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),i="number"==typeof n?n:n[0],r="number"==typeof n?n:n[1],s=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function(t,e,n,i,r,s,o,a,l,h,u,c){const d=Mo(Math.round(n*t),Math.round(n*e),Ga);if(c||(d.imageSmoothingEnabled=!1),0===l.length)return d.canvas;function f(t){return Math.round(t*n)/n}d.scale(n,n),d.globalCompositeOperation="lighter";const g=[1/0,1/0,-1/0,-1/0];l.forEach((function(t,e,n){var i,r;i=g,(r=t.extent)[0]<i[0]&&(i[0]=r[0]),r[2]>i[2]&&(i[2]=r[2]),r[1]<i[1]&&(i[1]=r[1]),r[3]>i[3]&&(i[3]=r[3])}));const p=hr(g),m=sr(g),_=Mo(Math.round(n*p/i),Math.round(n*m/i),Ga);c||(_.imageSmoothingEnabled=!1);const y=n/i;l.forEach((function(t,e,n){const i=t.extent[0]-g[0],r=-(t.extent[3]-g[3]),s=hr(t.extent),o=sr(t.extent);t.image.width>0&&t.image.height>0&&_.drawImage(t.image,h,h,t.image.width-2*h,t.image.height-2*h,i*y,r*y,s*y,o*y)}));const v=ar(o);return a.getTriangles().forEach((function(t,e,r){const o=t.source,a=t.target;let l=o[0][0],h=o[0][1],u=o[1][0],p=o[1][1],m=o[2][0],y=o[2][1];const w=f((a[0][0]-v[0])/s),b=f(-(a[0][1]-v[1])/s),x=f((a[1][0]-v[0])/s),E=f(-(a[1][1]-v[1])/s),C=f((a[2][0]-v[0])/s),T=f(-(a[2][1]-v[1])/s),R=l,P=h;l=0,h=0,u-=R,p-=P,m-=R,y-=P;const S=function(t){const e=t.length;for(let n=0;n<e;n++){let i=n,r=Math.abs(t[n][n]);for(let s=n+1;s<e;s++){const e=Math.abs(t[s][n]);e>r&&(r=e,i=s)}if(0===r)return null;const s=t[i];t[i]=t[n],t[n]=s;for(let i=n+1;i<e;i++){const r=-t[i][n]/t[n][n];for(let s=n;s<e+1;s++)n==s?t[i][s]=0:t[i][s]+=r*t[n][s]}}const n=new Array(e);for(let i=e-1;i>=0;i--){n[i]=t[i][e]/t[i][i];for(let r=i-1;r>=0;r--)t[r][e]-=t[r][i]*n[i]}return n}([[u,p,0,0,x-w],[m,y,0,0,C-w],[0,0,u,p,E-b],[0,0,m,y,T-b]]);if(S){if(d.save(),d.beginPath(),function(){if(void 0===za){const t=Mo(6,6,Ga);t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",Ba(t,4,5,4,0),Ba(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;za=qa(e,0)||qa(e,4)||qa(e,8),ko(t),Ga.push(t.canvas)}return za}()||!c){d.moveTo(x,E);const t=4,e=w-x,n=b-E;for(let i=0;i<t;i++)d.lineTo(x+f((i+1)*e/t),E+f(i*n/(t-1))),i!=t-1&&d.lineTo(x+f((i+1)*e/t),E+f((i+1)*n/(t-1)));d.lineTo(C,T)}else d.moveTo(x,E),d.lineTo(w,b),d.lineTo(C,T);d.clip(),d.transform(S[0],S[2],S[1],S[3],w,b),d.translate(g[0]-R,g[3]-P),d.scale(i/n,-i/n),d.drawImage(_.canvas,0,0),d.restore()}})),ko(_),Ga.push(_.canvas),u&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach((function(t,e,n){const i=t.target,r=(i[0][0]-v[0])/s,o=-(i[0][1]-v[1])/s,a=(i[1][0]-v[0])/s,l=-(i[1][1]-v[1])/s,h=(i[2][0]-v[0])/s,u=-(i[2][1]-v[1])/s;d.beginPath(),d.moveTo(a,l),d.lineTo(r,o),d.lineTo(h,u),d.closePath(),d.stroke()})),d.restore()),d.canvas}(i,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),s,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()}load(){if(0==this.state){this.state=1,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((e=>{const n=e.getState();if(0==n||1==n){t++;const n=li(e,ai.CHANGE,(function(i){const r=e.getState();2!=r&&3!=r&&4!=r||(ui(n),t--,0===t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(n)}})),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,n){0==t.getState()&&t.load()}))}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ui),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ko(this.canvas_.getContext("2d")),Ga.push(this.canvas_),this.canvas_=null),super.release()}},Xa=class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return Oi(void 0!==n,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return Oi(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,n=0;for(e=this.newest_;e;e=e.older)t[n++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,n=0;for(e=this.newest_;e;e=e.older)t[n++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Oi(!(t in this.entries_),16);const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}};function Va(t,e,n,i){return void 0!==i?(i[0]=t,i[1]=e,i[2]=n,i):[t,e,n]}function Wa(t,e,n){return t+"/"+e+"/"+n}function Ya(t){return Wa(t[0],t[1],t[2])}var Ha=class extends Xa{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const t=this.peekFirstKey().split("/").map(Number)[0];this.forEach((e=>{e.tileCoord[0]!==t&&(this.remove(Ya(e.tileCoord)),e.release())}))}};function $a(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var Qa=class extends _i{constructor(t){super(),this.projection=ms(t.projection),this.attributions_=$a(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise((function(t,n){e.viewResolver=t,e.viewRejector=n}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=$a(t),this.changed()}setState(t){this.state_=t,this.changed()}};class Ja{constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function tl(t,e,n,i,r){return void 0!==r?(r.minX=t,r.maxX=e,r.minY=n,r.maxY=i,r):new Ja(t,e,n,i)}var el=Ja;const nl=[0,0,0];var il=class{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,Oi(function(t,e,n){const i=function(t,e){return e-t}||Jn;return t.every((function(e,n){if(0===n)return!0;const r=i(t[n-1],e);return!(r>0||0===r)}))}(this.resolutions_),17),!t.origins)for(let t=0,n=this.resolutions_.length-1;t<n;++t)if(e){if(this.resolutions_[t]/this.resolutions_[t+1]!==e){e=void 0;break}}else e=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,Oi(this.origins_.length==this.resolutions_.length,20));const n=t.extent;void 0===n||this.origin_||this.origins_||(this.origin_=ar(n)),Oi(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,Oi(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Br,Oi(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==n?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){const i=new el(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(n){const t=this.getTileRangeForExtentAndZ(n,e);i.minX=Math.max(t.minX,i.minX),i.maxX=Math.min(t.maxX,i.maxX),i.minY=Math.max(t.minY,i.minY),i.maxY=Math.min(t.maxY,i.maxY)}return i}),this):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const i=this.getTileRangeForExtentAndZ(t,e);for(let t=i.minX,r=i.maxX;t<=r;++t)for(let r=i.minY,s=i.maxY;r<=s;++r)n([e,t,r])}forEachTileCoordParentTileRange(t,e,n,i){let r,s,o,a=null,l=t[0]-1;for(2===this.zoomFactor_?(s=t[1],o=t[2]):a=this.getTileCoordExtent(t,i);l>=this.minZoom;){if(2===this.zoomFactor_?(s=Math.floor(s/2),o=Math.floor(o/2),r=tl(s,s,o,o,n)):r=this.getTileRangeForExtentAndZ(a,l,n),e(l,r))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const n=2*t[1],i=2*t[2];return tl(n,n+1,i,i+1,e)}const i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const i=t[0],r=t[1],s=t[2];if(e===i)return tl(r,s,r,s,n);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-i),o=Math.floor(r*t),a=Math.floor(s*t);return e<i?tl(o,o,a,a,n):tl(o,Math.floor(t*(r+1))-1,a,Math.floor(t*(s+1))-1,n)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,n)}getTileRangeExtent(t,e,n){const i=this.getOrigin(t),r=this.getResolution(t),s=Oa(this.getTileSize(t),this.tmpSize_),o=i[0]+e.minX*s[0]*r,a=i[0]+(e.maxX+1)*s[0]*r;return Zi(o,i[1]+e.minY*s[1]*r,a,i[1]+(e.maxY+1)*s[1]*r,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,nl);const i=nl[1],r=nl[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,nl),tl(i,nl[1],r,nl[2],n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=Oa(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*i[0]*n,e[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=Oa(this.getTileSize(t[0]),this.tmpSize_),s=n[0]+t[1]*r[0]*i,o=n[1]-(t[2]+1)*r[1]*i;return Zi(s,o,s+r[0]*i,o+r[1]*i,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,i,r){const s=this.getZForResolution(n),o=n/this.getResolution(s),a=this.getOrigin(s),l=Oa(this.getTileSize(s),this.tmpSize_);let h=o*(t-a[0])/n/l[0],u=o*(a[1]-e)/n/l[1];return i?(h=wr(h,5)-1,u=wr(u,5)-1):(h=vr(h,5),u=vr(u,5)),Va(s,h,u,r)}getTileCoordForXYAndZ_(t,e,n,i,r){const s=this.getOrigin(n),o=this.getResolution(n),a=Oa(this.getTileSize(n),this.tmpSize_);let l=(t-s[0])/o/a[0],h=(s[1]-e)/o/a[1];return i?(l=wr(l,5)-1,h=wr(h,5)-1):(l=vr(l,5),h=vr(h,5)),Va(n,l,h,r)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return dr(ti(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return uo(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let i=this.minZoom;i<e;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}};function rl(t){let e=t.getDefaultTileGrid();return e||(e=function(t,e,n,i){return function(t,e,n,i){i=void 0!==i?i:"top-left";const r=sl(t,undefined,n);return new il({extent:t,origin:nr(t,i),resolutions:r,tileSize:n})}(ol(t),0,void 0,void 0)}(t),t.setDefaultTileGrid(e)),e}function sl(t,e,n,i){e=void 0!==e?e:Gr,n=Oa(void 0!==n?n:Br);const r=sr(t),s=hr(t);i=i>0?i:Math.max(s/n[0],r/n[1]);const o=e+1,a=new Array(o);for(let t=0;t<o;++t)a[t]=i/Math.pow(2,t);return a}function ol(t){let e=(t=ms(t)).getExtent();if(!e){const n=180*qr.degrees/t.getMetersPerUnit();e=Zi(-n,-n,n,n)}return e}class al extends Hn{constructor(t,e){super(t),this.tile=e}}var ll=class extends Qa{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;this.tileGrid&&Oa(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new Ha(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,i){const r=this.getTileCacheForProjection(t);if(!r)return!1;let s,o,a,l=!0;for(let t=n.minX;t<=n.maxX;++t)for(let h=n.minY;h<=n.maxY;++h)o=Wa(e,t,h),a=!1,r.containsKey(o)&&(s=r.get(o),a=2===s.getState(),a&&(a=!1!==i(s))),a||(l=!1);return l}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,i,r){return fi()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:rl(t)}getTileCacheForProjection(t){const e=this.getProjection();return Oi(null===e||ws(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const i=this.getTileGridForProjection(n),r=this.getTilePixelRatio(e),s=Oa(i.getTileSize(t),this.tmpSize);return 1==r?s:(o=s,a=r,void 0===(l=this.tmpSize)&&(l=[0,0]),l[0]=o[0]*a+.5|0,l[1]=o[1]*a+.5|0,l);var o,a,l}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function(t,e,n){const i=e[0],r=t.getTileCoordCenter(e),s=ol(n);if(!Bi(s,r)){const e=hr(s),n=Math.ceil((s[0]-r[0])/e);return r[0]+=e*n,t.getTileCoordForCoordAndZ(r,i)}return e}(n,t,e)),function(t,e){const n=t[0],i=t[1],r=t[2];if(e.getMinZoom()>n||n>e.getMaxZoom())return!1;const s=e.getFullTileRange(n);return!s||s.containsXY(i,r)}(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,i){}};function hl(t,e){const n=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return t.replace(n,o[0].toString()).replace(i,o[1].toString()).replace(r,o[2].toString()).replace(s,(function(){const t=o[0],n=e.getFullTileRange(t);return Oi(n,55),(n.getHeight()-o[2]-1).toString()}))}}class ul extends ll{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ul.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=pi(e),i=e.getState();let r;1==i?(this.tileLoadingKeys_[n]=!0,r="tileloadstart"):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=3==i?"tileloaderror":2==i?"tileloadend":void 0),null!=r&&this.dispatchEvent(new al(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=function(t){const e=[];let n=/\{([a-z])-([a-z])\}/.exec(t);if(n){const i=n[1].charCodeAt(0),r=n[2].charCodeAt(0);let s;for(s=i;s<=r;++s)e.push(t.replace(n[0],String.fromCharCode(s)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t),n){const i=parseInt(n[2],10);for(let r=parseInt(n[1],10);r<=i;r++)e.push(t.replace(n[0],r.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){const n=t.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=hl(t[r],e);return function(t){return 1===t.length?t[0]:function(e,n,i){if(!e)return;const r=function(t){return(t[1]<<t[0])+t[2]}(e),s=mr(r,t.length);return t[s](e,n,i)}}(i)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const i=Wa(t,e,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}var cl=ul;function dl(t,e){t.getImage().src=e}var fl=class extends cl{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:dl,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:ja,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const t in this.tileCacheForProjection){const i=this.tileCacheForProjection[t];i.expireCache(i==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!ws(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!ws(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||ws(e,t)))return this.tileGrid;const n=pi(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=rl(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||ws(e,t))return this.tileCache;const n=pi(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Ha(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,i,r,s){const o=[t,e,n],a=this.getTileCoordForTileUrlFunction(o,r),l=a?this.tileUrlFunction(a,i,r):void 0,h=new this.tileClass(o,void 0!==l?0:4,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=s,h.addEventListener(ai.CHANGE,this.handleTileChange.bind(this)),h}getTile(t,e,n,i,r){const s=this.getProjection();if(!s||!r||ws(s,r))return this.getTileInternal(t,e,n,i,s||r);const o=this.getTileCacheForProjection(r),a=[t,e,n];let l;const h=Ya(a);o.containsKey(h)&&(l=o.get(h));const u=this.getKey();if(l&&l.key==u)return l;const c=this.getTileGridForProjection(s),d=this.getTileGridForProjection(r),f=this.getTileCoordForTileUrlFunction(a,r),g=new Za(s,c,r,d,a,f,this.getTilePixelRatio(i),this.getGutter(),((t,e,n,i)=>this.getTileInternal(t,e,n,i,s)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return g.key=u,l?(g.interimTile=l,g.refreshInterimChain(),o.replace(h,g)):o.set(h,g),g}getTileInternal(t,e,n,i,r){let s=null;const o=Wa(t,e,n),a=this.getKey();if(this.tileCache.containsKey(o)){if(s=this.tileCache.get(o),s.key!=a){const l=s;s=this.createTile_(t,e,n,i,r,a),0==l.getState()?s.interimTile=l.interimTile:s.interimTile=l,s.refreshInterimChain(),this.tileCache.replace(o,s)}}else s=this.createTile_(t,e,n,i,r,a),this.tileCache.set(o,s);return s}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){const n=ms(t);if(n){const t=pi(n);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},gl=class extends fl{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",n=void 0!==t.tileGrid?t.tileGrid:function(t){const e=t||{},n=e.extent||ms("EPSG:3857").getExtent(),i={extent:n,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:sl(n,e.maxZoom,e.tileSize,e.maxResolution)};return new il(i)}({extent:ol(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},pl=class extends gl{constructor(t){let e;e=void 0!==(t=t||{}).attributions?t.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const n=void 0!==t.crossOrigin?t.crossOrigin:"anonymous",i=void 0!==t.url?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,opaque:void 0===t.opaque||t.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:i,wrapX:t.wrapX,zDirection:t.zDirection})}},ml="preload",_l="useInterimTilesOnError",yl=class extends Eo{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(ml)}setPreload(t){this.set(ml,t)}getUseInterimTilesOnError(){return this.get(_l)}setUseInterimTilesOnError(t){this.set(_l,t)}getData(t){return super.getData(t)}},vl=class extends di{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return fi()}getData(t){return null}prepareFrame(t){return fi()}renderFrame(t,e){return fi()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(i,r)=>{const s=this.loadedTileCallback.bind(this,n,i);return t.forEachLoadedTile(e,i,r,s)}}forEachFeatureAtCoordinate(t,e,n,i,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){2===t.target.getState()&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return 2!=e&&3!=e&&t.addEventListener(ai.CHANGE,this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}};let wl=null;var bl=class extends vl{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){let i;wl||(wl=Mo(1,1,void 0,{willReadFrequently:!0})),wl.clearRect(0,0,1,1);try{wl.drawImage(t,e,n,1,1,0,0,1,1),i=wl.getImageData(0,0,1,1).data}catch(t){return wl=null,null}return i}getBackground(t){let e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,n){const i=this.getLayer().getClassName();let r,s;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&ei(Cr(t.style.backgroundColor),Cr(n)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(s=e.getContext("2d"))}if(s&&s.canvas.style.transform===e?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=i;let t=r.style;t.position="absolute",t.width="100%",t.height="100%",s=Mo();const e=s.canvas;r.appendChild(e),t=e.style,t.position="absolute",t.left="0",t.transformOrigin="top left",this.container=r,this.context=s}this.containerReused||!n||this.container.style.backgroundColor||(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const i=ar(n),r=lr(n),s=tr(n),o=Ji(n);Fi(e.coordinateToPixelTransform,i),Fi(e.coordinateToPixelTransform,r),Fi(e.coordinateToPixelTransform,s),Fi(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;Fi(a,i),Fi(a,r),Fi(a,s),Fi(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){const r=new Ro(t,this.inversePixelTransform,n,e);i.dispatchEvent(r)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){this.dispatchRenderEvent_("postrender",t,e)}getRenderTransform(t,e,n,i,r,s,o){const a=r/2,l=s/2,h=i/e,u=-h,c=-t[0]+o,d=-t[1];return Ni(this.tempTransform,a,l,h,u,-n,c,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},xl=class extends bl{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new el(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),i=e.getUseInterimTilesOnError();return 2==n||4==n||3==n&&!i}getTile(t,e,n,i){const r=i.pixelRatio,s=i.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(t,e,n,r,s);return 3==a.getState()&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=Fi(e.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!Bi(r,i))return null;const s=e.pixelRatio,o=e.viewState.projection,a=e.viewState,l=n.getRenderSource(),h=l.getTileGridForProjection(a.projection),u=l.getTilePixelRatio(e.pixelRatio);for(let t=h.getZForResolution(a.resolution);t>=h.getMinZoom();--t){const e=h.getTileCoordForCoordAndZ(i,t),n=l.getTile(t,e[1],e[2],s,o);if(!(n instanceof ja||n instanceof Za)||n instanceof Za&&4===n.getState())return null;if(2!==n.getState())continue;const r=h.getOrigin(t),c=Oa(h.getTileSize(t)),d=h.getResolution(t),f=Math.floor(u*((i[0]-r[0])/d-e[1]*c[0])),g=Math.floor(u*((r[1]-i[1])/d-e[2]*c[1])),p=Math.round(u*l.getGutterForProjection(a.projection));return this.getImageData(n.getImage(),f+p,g+p)}return null}loadedTileCallback(t,e,n){return!!this.isDrawableTile(n)&&super.loadedTileCallback(t,e,n)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],i=t.viewState,r=i.projection,s=i.resolution,o=i.center,a=i.rotation,l=t.pixelRatio,h=this.getLayer(),u=h.getSource(),c=u.getRevision(),d=u.getTileGridForProjection(r),f=d.getZForResolution(s,u.zDirection),g=d.getResolution(f);let p=t.extent;const m=t.viewState.resolution,_=u.getTilePixelRatio(l),y=Math.round(hr(p)/m*l),v=Math.round(sr(p)/m*l),w=n.extent&&As(n.extent,r);w&&(p=or(p,As(n.extent,r)));const b=g*y/2/_,x=g*v/2/_,E=[o[0]-b,o[1]-x,o[0]+b,o[1]+x],C=d.getTileRangeForExtentAndZ(p,f),T={};T[f]={};const R=this.createLoadedTileFinder(u,r,T),P=this.tmpExtent,S=this.tmpTileRange_;this.newTiles_=!1;const A=a?rr(i.center,m,a,t.size):void 0;for(let e=C.minX;e<=C.maxX;++e)for(let i=C.minY;i<=C.maxY;++i){if(a&&!d.tileCoordIntersectsViewport([f,e,i],A))continue;const r=this.getTile(f,e,i,t);if(this.isDrawableTile(r)){const e=pi(this);if(2==r.getState()){T[f][r.tileCoord.toString()]=r;let t=r.inTransition(e);t&&1!==n.opacity&&(r.endTransition(e),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(r)||(this.newTiles_=!0)}if(1===r.getAlpha(e,t.time))continue}const s=d.getTileCoordChildTileRange(r.tileCoord,S,P);let o=!1;s&&(o=R(f+1,s)),o||d.forEachTileCoordParentTileRange(r.tileCoord,R,S,P)}const I=g/s*l/_;Ni(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/l,1/l,a,-y/2,-v/2);const M=function(t){const e="matrix("+t.join(", ")+")";if(Mi)return e;const n=Ki||(Ki=document.createElement("div"));return n.style.transform=e,n.style.transform}(this.pixelTransform);this.useContainer(e,M,this.getBackground(t));const k=this.context,L=k.canvas;Di(this.inversePixelTransform,this.pixelTransform),Ni(this.tempTransform,y/2,v/2,I,I,0,-y/2,-v/2),L.width!=y||L.height!=v?(L.width=y,L.height=v):this.containerReused||k.clearRect(0,0,y,v),w&&this.clipUnrotated(k,t,w),u.getInterpolate()||(k.imageSmoothingEnabled=!1),this.preRender(k,t),this.renderedTiles.length=0;let O,F,N,D=Object.keys(T).map(Number);D.sort(Jn),1!==n.opacity||this.containerReused&&!u.getOpaque(t.viewState.projection)?(O=[],F=[]):D=D.reverse();for(let e=D.length-1;e>=0;--e){const n=D[e],i=u.getTilePixelSize(n,l,r),s=d.getResolution(n)/g,o=i[0]*s*I,a=i[1]*s*I,h=d.getTileCoordForCoordAndZ(ar(E),n),c=d.getTileCoordExtent(h),p=Fi(this.tempTransform,[_*(c[0]-E[0])/g,_*(E[3]-c[3])/g]),m=_*u.getGutterForProjection(r),y=T[n];for(const e in y){const i=y[e],r=i.tileCoord,s=h[1]-r[1],l=Math.round(p[0]-(s-1)*o),c=h[2]-r[2],d=Math.round(p[1]-(c-1)*a),g=Math.round(p[0]-s*o),_=Math.round(p[1]-c*a),v=l-g,w=d-_,b=f===n,x=b&&1!==i.getAlpha(pi(this),t.time);let E=!1;if(!x)if(O){N=[g,_,g+v,_,g+v,_+w,g,_+w];for(let t=0,e=O.length;t<e;++t)if(f!==n&&n<F[t]){const e=O[t];ur([g,_,g+v,_+w],[e[0],e[3],e[4],e[7]])&&(E||(k.save(),E=!0),k.beginPath(),k.moveTo(N[0],N[1]),k.lineTo(N[2],N[3]),k.lineTo(N[4],N[5]),k.lineTo(N[6],N[7]),k.moveTo(e[6],e[7]),k.lineTo(e[4],e[5]),k.lineTo(e[2],e[3]),k.lineTo(e[0],e[1]),k.clip())}O.push(N),F.push(n)}else k.clearRect(g,_,v,w);this.drawTileImage(i,t,g,_,v,w,m,b),O&&!x?(E&&k.restore(),this.renderedTiles.unshift(i)):this.renderedTiles.push(i),this.updateUsedTiles(t.usedTiles,u,i)}}return this.renderedRevision=c,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!Vi(this.renderedExtent_,E),this.renderedExtent_=E,this.renderedPixelRatio=l,this.renderedProjection=r,this.manageTilePyramid(t,u,d,l,r,p,f,h.getPreload()),this.scheduleExpireCache(t,u),this.postRender(k,t),n.extent&&k.restore(),k.imageSmoothingEnabled=!0,M!==L.style.transform&&(L.style.transform=M),this.container}drawTileImage(t,e,n,i,r,s,o,a){const l=this.getTileImage(t);if(!l)return;const h=pi(this),u=e.layerStatesArray[e.layerIndex],c=u.opacity*(a?t.getAlpha(h,e.time):1),d=c!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=c),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,n,i,r,s),d&&this.context.restore(),c!==u.opacity?e.animate=!0:a&&t.endTransition(h)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(t,e,n){const i=pi(t);i in n.usedTiles&&t.expireCache(n.viewState.projection,n.usedTiles[i])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const i=pi(e);i in t||(t[i]={}),t[i][n.getKey()]=!0}manageTilePyramid(t,e,n,i,r,s,o,a,l){const h=pi(e);h in t.wantedTiles||(t.wantedTiles[h]={});const u=t.wantedTiles[h],c=t.tileQueue,d=n.getMinZoom(),f=t.viewState.rotation,g=f?rr(t.viewState.center,t.viewState.resolution,f,t.size):void 0;let p,m,_,y,v,w,b=0;for(w=d;w<=o;++w)for(m=n.getTileRangeForExtentAndZ(s,w,m),_=n.getResolution(w),y=m.minX;y<=m.maxX;++y)for(v=m.minY;v<=m.maxY;++v)f&&!n.tileCoordIntersectsViewport([w,y,v],g)||(o-w<=a?(++b,p=e.getTile(w,y,v,i,r),0==p.getState()&&(u[p.getKey()]=!0,c.isKeyQueued(p.getKey())||c.enqueue([p,h,n.getTileCoordCenter(p.tileCoord),_])),void 0!==l&&l(p)):e.useTile(w,y,v,r));e.updateCacheSize(b,r)}},El=class extends yl{constructor(t){super(t)}createRenderer(){return new xl(this)}};function Cl(){}function Tl(t){return null==t?Cl:function(){return this.querySelector(t)}}function Rl(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function Pl(){return[]}function Sl(t){return null==t?Pl:function(){return this.querySelectorAll(t)}}function Al(t){return function(){return this.matches(t)}}function Il(t){return function(e){return e.matches(t)}}var Ml=Array.prototype.find;function kl(){return this.firstElementChild}var Ll=Array.prototype.filter;function Ol(){return Array.from(this.children)}function Fl(t){return new Array(t.length)}function Nl(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Dl(t,e,n,i,r,s){for(var o,a=0,l=e.length,h=s.length;a<h;++a)(o=e[a])?(o.__data__=s[a],i[a]=o):n[a]=new Nl(t,s[a]);for(;a<l;++a)(o=e[a])&&(r[a]=o)}function Kl(t,e,n,i,r,s,o){var a,l,h,u=new Map,c=e.length,d=s.length,f=new Array(c);for(a=0;a<c;++a)(l=e[a])&&(f[a]=h=o.call(l,l.__data__,a,e)+"",u.has(h)?r[a]=l:u.set(h,l));for(a=0;a<d;++a)h=o.call(t,s[a],a,s)+"",(l=u.get(h))?(i[a]=l,l.__data__=s[a],u.delete(h)):n[a]=new Nl(t,s[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(f[a])===l&&(r[a]=l)}function jl(t){return t.__data__}function zl(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Gl(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Nl.prototype={constructor:Nl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Bl="http://www.w3.org/1999/xhtml",ql={svg:"http://www.w3.org/2000/svg",xhtml:Bl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ul(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),ql.hasOwnProperty(e)?{space:ql[e],local:t}:t}function Zl(t){return function(){this.removeAttribute(t)}}function Xl(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Vl(t,e){return function(){this.setAttribute(t,e)}}function Wl(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Yl(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Hl(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function $l(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ql(t){return function(){this.style.removeProperty(t)}}function Jl(t,e,n){return function(){this.style.setProperty(t,e,n)}}function th(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function eh(t,e){return t.style.getPropertyValue(e)||$l(t).getComputedStyle(t,null).getPropertyValue(e)}function nh(t){return function(){delete this[t]}}function ih(t,e){return function(){this[t]=e}}function rh(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function sh(t){return t.trim().split(/^|\s+/)}function oh(t){return t.classList||new ah(t)}function ah(t){this._node=t,this._names=sh(t.getAttribute("class")||"")}function lh(t,e){for(var n=oh(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function hh(t,e){for(var n=oh(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function uh(t){return function(){lh(this,t)}}function ch(t){return function(){hh(this,t)}}function dh(t,e){return function(){(e.apply(this,arguments)?lh:hh)(this,t)}}function fh(){this.textContent=""}function gh(t){return function(){this.textContent=t}}function ph(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function mh(){this.innerHTML=""}function _h(t){return function(){this.innerHTML=t}}function yh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function vh(){this.nextSibling&&this.parentNode.appendChild(this)}function wh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function bh(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Bl&&e.documentElement.namespaceURI===Bl?e.createElement(t):e.createElementNS(n,t)}}function xh(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Eh(t){var e=Ul(t);return(e.local?xh:bh)(e)}function Ch(){return null}function Th(){var t=this.parentNode;t&&t.removeChild(this)}function Rh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ph(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Sh(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,s=e.length;i<s;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function Ah(t,e,n){return function(){var i,r=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),void(i.value=e);this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function Ih(t,e,n){var i=$l(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Mh(t,e){return function(){return Ih(this,t,e)}}function kh(t,e){return function(){return Ih(this,t,e.apply(this,arguments))}}ah.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Lh=[null];function Oh(t,e){this._groups=t,this._parents=e}function Fh(){return new Oh([[document.documentElement]],Lh)}Oh.prototype=Fh.prototype={constructor:Oh,select:function(t){"function"!=typeof t&&(t=Tl(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o,a=e[r],l=a.length,h=i[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(o=t.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),h[u]=o);return new Oh(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return Rl(t.apply(this,arguments))}}(t):Sl(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,h=0;h<l;++h)(o=a[h])&&(i.push(t.call(o,o.__data__,h,a)),r.push(o));return new Oh(i,r)},selectChild:function(t){return this.select(null==t?kl:function(t){return function(){return Ml.call(this.children,t)}}("function"==typeof t?t:Il(t)))},selectChildren:function(t){return this.selectAll(null==t?Ol:function(t){return function(){return Ll.call(this.children,t)}}("function"==typeof t?t:Il(t)))},filter:function(t){"function"!=typeof t&&(t=Al(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o=e[r],a=o.length,l=i[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new Oh(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,jl);var n=e?Kl:Dl,i=this._parents,r=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),h=0;h<s;++h){var u=i[h],c=r[h],d=c.length,f=zl(t.call(u,u&&u.__data__,h,i)),g=f.length,p=a[h]=new Array(g),m=o[h]=new Array(g);n(u,c,p,m,l[h]=new Array(d),f,e);for(var _,y,v=0,w=0;v<g;++v)if(_=p[v]){for(v>=w&&(w=v+1);!(y=m[w])&&++w<g;);_._next=y||null}}return(o=new Oh(o,i))._enter=a,o._exit=l,o},enter:function(){return new Oh(this._enter||this._groups.map(Fl),this._parents)},exit:function(){return new Oh(this._exit||this._groups.map(Fl),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,s=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?s.remove():n(s),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var h,u=n[l],c=i[l],d=u.length,f=a[l]=new Array(d),g=0;g<d;++g)(h=u[g]||c[g])&&(f[g]=h);for(;l<r;++l)a[l]=n[l];return new Oh(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],s=r.length-1,o=r[s];--s>=0;)(i=r[s])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Gl);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o,a=n[s],l=a.length,h=r[s]=new Array(l),u=0;u<l;++u)(o=a[u])&&(h[u]=o);h.sort(e)}return new Oh(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,s=e[n],o=0,a=s.length;o<a;++o)(r=s[o])&&t.call(r,r.__data__,o,s);return this},attr:function(t,e){var n=Ul(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?Xl:Zl:"function"==typeof e?n.local?Hl:Yl:n.local?Wl:Vl)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Ql:"function"==typeof e?th:Jl)(t,e,null==n?"":n)):eh(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?nh:"function"==typeof e?rh:ih)(t,e)):this.node()[t]},classed:function(t,e){var n=sh(t+"");if(arguments.length<2){for(var i=oh(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?dh:e?uh:ch)(n,e))},text:function(t){return arguments.length?this.each(null==t?fh:("function"==typeof t?ph:gh)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?mh:("function"==typeof t?yh:_h)(t)):this.node().innerHTML},raise:function(){return this.each(vh)},lower:function(){return this.each(wh)},append:function(t){var e="function"==typeof t?t:Eh(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Eh(t),i=null==e?Ch:"function"==typeof e?e:Tl(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(Th)},clone:function(t){return this.select(t?Ph:Rh)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,s=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?Ah:Sh,i=0;i<o;++i)this.each(a(s[i],e,n));return this}var a=this.node().__on;if(a)for(var l,h=0,u=a.length;h<u;++h)for(i=0,l=a[h];i<o;++i)if((r=s[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?kh:Mh)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],s=0,o=r.length;s<o;++s)(i=r[s])&&(yield i)}};var Nh=Fh,Dh={value:()=>{}};function Kh(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new jh(i)}function jh(t){this._=t}function zh(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function Gh(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=Dh,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}jh.prototype=Kh.prototype={constructor:jh,on:function(t,e){var n,i,r=this._,s=(i=r,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)r[n]=Gh(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Gh(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=zh(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new jh(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(i=this._[t]).length;s<n;++s)i[s].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};var Bh,qh,Uh=Kh,Zh=0,Xh=0,Vh=0,Wh=1e3,Yh=0,Hh=0,$h=0,Qh="object"==typeof performance&&performance.now?performance:Date,Jh="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function tu(){return Hh||(Jh(eu),Hh=Qh.now()+$h)}function eu(){Hh=0}function nu(){this._call=this._time=this._next=null}function iu(t,e,n){var i=new nu;return i.restart(t,e,n),i}function ru(){Hh=(Yh=Qh.now())+$h,Zh=Xh=0;try{!function(){tu(),++Zh;for(var t,e=Bh;e;)(t=Hh-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Zh}()}finally{Zh=0,function(){for(var t,e,n=Bh,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Bh=e);qh=t,ou(i)}(),Hh=0}}function su(){var t=Qh.now(),e=t-Yh;e>Wh&&($h-=e,Yh=t)}function ou(t){Zh||(Xh&&(Xh=clearTimeout(Xh)),t-Hh>24?(t<1/0&&(Xh=setTimeout(ru,t-Qh.now()-$h)),Vh&&(Vh=clearInterval(Vh))):(Vh||(Yh=Qh.now(),Vh=setInterval(su,Wh)),Zh=1,Jh(ru)))}function au(t,e,n){var i=new nu;return e=null==e?0:+e,i.restart((n=>{i.stop(),t(n+e)}),e,n),i}nu.prototype=iu.prototype={constructor:nu,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?tu():+n)+(null==e?0:+e),this._next||qh===this||(qh?qh._next=this:Bh=this,qh=this),this._call=t,this._time=n,ou()},stop:function(){this._call&&(this._call=null,this._time=1/0,ou())}};var lu=Uh("start","end","cancel","interrupt"),hu=[],uu=0,cu=2,du=3,fu=5,gu=6;function pu(t,e,n,i,r,s){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function s(l){var h,u,c,d;if(1!==n.state)return a();for(h in r)if((d=r[h]).name===n.name){if(d.state===du)return au(s);4===d.state?(d.state=gu,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[h]):+h<e&&(d.state=gu,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[h])}if(au((function(){n.state===du&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))})),n.state=cu,n.on.call("start",t,t.__data__,n.index,n.group),n.state===cu){for(n.state=du,i=new Array(c=n.tween.length),h=0,u=-1;h<c;++h)(d=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=d);i.length=u+1}}function o(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=fu,1),s=-1,o=i.length;++s<o;)i[s].call(t,r);n.state===fu&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var i in n.state=gu,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=iu((function(t){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=t&&s(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:lu,tween:hu,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:uu})}function mu(t,e){var n=yu(t,e);if(n.state>uu)throw new Error("too late; already scheduled");return n}function _u(t,e){var n=yu(t,e);if(n.state>du)throw new Error("too late; already running");return n}function yu(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function vu(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var wu,bu=180/Math.PI,xu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Eu(t,e,n,i,r,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*bu,skewX:Math.atan(l)*bu,scaleX:o,scaleY:a}}function Cu(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,i,r,s,o,a){if(t!==r||i!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:vu(t,r)},{i:l-2,x:vu(i,s)})}else(r||s)&&o.push("translate("+r+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(r(n)+"rotate(",null,i)-2,x:vu(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(r(n)+"skewX(",null,i)-2,x:vu(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(s.skewX,o.skewX,a,l),function(t,e,n,i,s,o){if(t!==n||e!==i){var a=s.push(r(s)+"scale(",null,",",null,")");o.push({i:a-4,x:vu(t,n)},{i:a-2,x:vu(e,i)})}else 1===n&&1===i||s.push(r(s)+"scale("+n+","+i+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,i=l.length;++n<i;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var Tu=Cu((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?xu:Eu(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Ru=Cu((function(t){return null==t?xu:(wu||(wu=document.createElementNS("http://www.w3.org/2000/svg","g")),wu.setAttribute("transform",t),(t=wu.transform.baseVal.consolidate())?Eu((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):xu)}),", ",")",")");function Pu(t,e){var n,i;return function(){var r=_u(this,t),s=r.tween;if(s!==n)for(var o=0,a=(i=n=s).length;o<a;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function Su(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var s=_u(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:e,value:n},l=0,h=r.length;l<h;++l)if(r[l].name===e){r[l]=a;break}l===h&&r.push(a)}s.tween=r}}function Au(t,e,n){var i=t._id;return t.each((function(){var t=_u(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return yu(t,i).value[e]}}function Iu(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Mu(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ku(){}var Lu=.7,Ou=1/Lu,Fu="\\s*([+-]?\\d+)\\s*",Nu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Du="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ku=/^#([0-9a-f]{3,8})$/,ju=new RegExp(`^rgb\\(${Fu},${Fu},${Fu}\\)$`),zu=new RegExp(`^rgb\\(${Du},${Du},${Du}\\)$`),Gu=new RegExp(`^rgba\\(${Fu},${Fu},${Fu},${Nu}\\)$`),Bu=new RegExp(`^rgba\\(${Du},${Du},${Du},${Nu}\\)$`),qu=new RegExp(`^hsl\\(${Nu},${Du},${Du}\\)$`),Uu=new RegExp(`^hsla\\(${Nu},${Du},${Du},${Nu}\\)$`),Zu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Xu(){return this.rgb().formatHex()}function Vu(){return this.rgb().formatRgb()}function Wu(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ku.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Yu(e):3===n?new Qu(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Hu(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Hu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ju.exec(t))?new Qu(e[1],e[2],e[3],1):(e=zu.exec(t))?new Qu(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Gu.exec(t))?Hu(e[1],e[2],e[3],e[4]):(e=Bu.exec(t))?Hu(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=qu.exec(t))?rc(e[1],e[2]/100,e[3]/100,1):(e=Uu.exec(t))?rc(e[1],e[2]/100,e[3]/100,e[4]):Zu.hasOwnProperty(t)?Yu(Zu[t]):"transparent"===t?new Qu(NaN,NaN,NaN,0):null}function Yu(t){return new Qu(t>>16&255,t>>8&255,255&t,1)}function Hu(t,e,n,i){return i<=0&&(t=e=n=NaN),new Qu(t,e,n,i)}function $u(t,e,n,i){return 1===arguments.length?function(t){return t instanceof ku||(t=Wu(t)),t?new Qu((t=t.rgb()).r,t.g,t.b,t.opacity):new Qu}(t):new Qu(t,e,n,null==i?1:i)}function Qu(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ju(){return`#${ic(this.r)}${ic(this.g)}${ic(this.b)}`}function tc(){const t=ec(this.opacity);return`${1===t?"rgb(":"rgba("}${nc(this.r)}, ${nc(this.g)}, ${nc(this.b)}${1===t?")":`, ${t})`}`}function ec(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function nc(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ic(t){return((t=nc(t))<16?"0":"")+t.toString(16)}function rc(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new oc(t,e,n,i)}function sc(t){if(t instanceof oc)return new oc(t.h,t.s,t.l,t.opacity);if(t instanceof ku||(t=Wu(t)),!t)return new oc;if(t instanceof oc)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(o=e===s?(n-i)/a+6*(n<i):n===s?(i-e)/a+2:(e-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new oc(o,a,l,t.opacity)}function oc(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function ac(t){return(t=(t||0)%360)<0?t+360:t}function lc(t){return Math.max(0,Math.min(1,t||0))}function hc(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function uc(t,e,n,i,r){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*i+o*r)/6}Iu(ku,Wu,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Xu,formatHex:Xu,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return sc(this).formatHsl()},formatRgb:Vu,toString:Vu}),Iu(Qu,$u,Mu(ku,{brighter(t){return t=null==t?Ou:Math.pow(Ou,t),new Qu(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Lu:Math.pow(Lu,t),new Qu(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Qu(nc(this.r),nc(this.g),nc(this.b),ec(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ju,formatHex:Ju,formatHex8:function(){return`#${ic(this.r)}${ic(this.g)}${ic(this.b)}${ic(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:tc,toString:tc})),Iu(oc,(function(t,e,n,i){return 1===arguments.length?sc(t):new oc(t,e,n,null==i?1:i)}),Mu(ku,{brighter(t){return t=null==t?Ou:Math.pow(Ou,t),new oc(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Lu:Math.pow(Lu,t),new oc(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Qu(hc(t>=240?t-240:t+120,r,i),hc(t,r,i),hc(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new oc(ac(this.h),lc(this.s),lc(this.l),ec(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ec(this.opacity);return`${1===t?"hsl(":"hsla("}${ac(this.h)}, ${100*lc(this.s)}%, ${100*lc(this.l)}%${1===t?")":`, ${t})`}`}}));var cc=t=>()=>t;function dc(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):cc(isNaN(t)?e:t)}var fc=function t(e){var n=function(t){return 1==(t=+t)?dc:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):cc(isNaN(e)?n:e)}}(e);function i(t,e){var i=n((t=$u(t)).r,(e=$u(e)).r),r=n(t.g,e.g),s=n(t.b,e.b),o=dc(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=s(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function gc(t){return function(e){var n,i,r=e.length,s=new Array(r),o=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=$u(e[n]),s[n]=i.r||0,o[n]=i.g||0,a[n]=i.b||0;return s=t(s),o=t(o),a=t(a),i.opacity=1,function(t){return i.r=s(t),i.g=o(t),i.b=a(t),i+""}}}gc((function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],s=t[i+1],o=i>0?t[i-1]:2*r-s,a=i<e-1?t[i+2]:2*s-r;return uc((n-i/e)*e,o,r,s,a)}})),gc((function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],s=t[i%e],o=t[(i+1)%e],a=t[(i+2)%e];return uc((n-i/e)*e,r,s,o,a)}}));var pc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mc=new RegExp(pc.source,"g");function _c(t,e){var n,i,r,s=pc.lastIndex=mc.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=pc.exec(t))&&(i=mc.exec(e));)(r=i.index)>s&&(r=e.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:vu(n,i)})),s=mc.lastIndex;return s<e.length&&(r=e.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)a[(n=l[i]).i]=n.x(t);return a.join("")})}function yc(t,e){var n;return("number"==typeof e?vu:e instanceof Wu?fc:(n=Wu(e))?(e=n,fc):_c)(t,e)}function vc(t){return function(){this.removeAttribute(t)}}function wc(t){return function(){this.removeAttributeNS(t.space,t.local)}}function bc(t,e,n){var i,r,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===i?r:r=e(i=o,n)}}function xc(t,e,n){var i,r,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===i?r:r=e(i=o,n)}}function Ec(t,e,n){var i,r,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===i&&a===r?s:(r=a,s=e(i=o,l));this.removeAttribute(t)}}function Cc(t,e,n){var i,r,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===i&&a===r?s:(r=a,s=e(i=o,l));this.removeAttributeNS(t.space,t.local)}}function Tc(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,r)),n}return r._value=e,r}function Rc(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,r)),n}return r._value=e,r}function Pc(t,e){return function(){mu(this,t).delay=+e.apply(this,arguments)}}function Sc(t,e){return e=+e,function(){mu(this,t).delay=e}}function Ac(t,e){return function(){_u(this,t).duration=+e.apply(this,arguments)}}function Ic(t,e){return e=+e,function(){_u(this,t).duration=e}}var Mc=Nh.prototype.constructor;function kc(t){return function(){this.style.removeProperty(t)}}var Lc=0;function Oc(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Fc(){return++Lc}var Nc=Nh.prototype;Oc.prototype=function(t){return Nh().transition(t)}.prototype={constructor:Oc,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Tl(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a,l,h=i[o],u=h.length,c=s[o]=new Array(u),d=0;d<u;++d)(a=h[d])&&(l=t.call(a,a.__data__,d,h))&&("__data__"in a&&(l.__data__=a.__data__),c[d]=l,pu(c[d],e,n,d,c,yu(a,n)));return new Oc(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Sl(t));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l,h=i[a],u=h.length,c=0;c<u;++c)if(l=h[c]){for(var d,f=t.call(l,l.__data__,c,h),g=yu(l,n),p=0,m=f.length;p<m;++p)(d=f[p])&&pu(d,e,n,p,f,g);s.push(f),o.push(l)}return new Oc(s,o,e,n)},selectChild:Nc.selectChild,selectChildren:Nc.selectChildren,filter:function(t){"function"!=typeof t&&(t=Al(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o=e[r],a=o.length,l=i[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new Oc(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l,h=e[a],u=n[a],c=h.length,d=o[a]=new Array(c),f=0;f<c;++f)(l=h[f]||u[f])&&(d[f]=l);for(;a<i;++a)o[a]=e[a];return new Oc(o,this._parents,this._name,this._id)},selection:function(){return new Mc(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Fc(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o,a=i[s],l=a.length,h=0;h<l;++h)if(o=a[h]){var u=yu(o,e);pu(o,t,n,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Oc(i,this._parents,t,n)},call:Nc.call,nodes:Nc.nodes,node:Nc.node,size:Nc.size,empty:Nc.empty,each:Nc.each,on:function(t,e){var n=this._id;return arguments.length<2?yu(this.node(),n).on.on(t):this.each(function(t,e,n){var i,r,s=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?mu:_u;return function(){var o=s(this,t),a=o.on;a!==i&&(r=(i=a).copy()).on(e,n),o.on=r}}(n,t,e))},attr:function(t,e){var n=Ul(t),i="transform"===n?Ru:yc;return this.attrTween(t,"function"==typeof e?(n.local?Cc:Ec)(n,i,Au(this,"attr."+t,e)):null==e?(n.local?wc:vc)(n):(n.local?xc:bc)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=Ul(t);return this.tween(n,(i.local?Tc:Rc)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?Tu:yc;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var s=eh(this,t),o=(this.style.removeProperty(t),eh(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}(t,i)).on("end.style."+t,kc(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,s;return function(){var o=eh(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=eh(this,t)),o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a))}}(t,i,Au(this,"style."+t,e))).each(function(t,e){var n,i,r,s,o="style."+e,a="end."+o;return function(){var l=_u(this,t),h=l.on,u=null==l.value[o]?s||(s=kc(e)):void 0;h===n&&r===u||(i=(n=h).copy()).on(a,r=u),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,s=n+"";return function(){var o=eh(this,t);return o===s?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,function(t,e,n){var i,r;function s(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&function(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}(t,s,n)),i}return s._value=e,s}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Au(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){return function(e){this.textContent=t.call(this,e)}}(i)),e}return i._value=t,i}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=yu(this.node(),n).tween,s=0,o=r.length;s<o;++s)if((i=r[s]).name===t)return i.value;return null}return this.each((null==e?Pu:Su)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Pc:Sc)(e,t)):yu(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Ac:Ic)(e,t)):yu(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){_u(this,t).ease=e}}(e,t)):yu(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;_u(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0==--r&&s()}};n.each((function(){var n=_u(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e})),0===r&&s()}))},[Symbol.iterator]:Nc[Symbol.iterator]};var Dc={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Kc(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Nh.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var n,i,r,s=t.__transition,o=!0;if(s){for(r in e=null==e?null:e+"",s)(n=s[r]).name===e?(i=n.state>cu&&n.state<fu,n.state=gu,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[r]):o=!1;o&&delete t.__transition}}(this,t)}))},Nh.prototype.transition=function(t){var e,n;t instanceof Oc?(e=t._id,t=t._name):(e=Fc(),(n=Dc).time=tu(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o,a=i[s],l=a.length,h=0;h<l;++h)(o=a[h])&&pu(o,t,e,h,a,n||Kc(o,e));return new Oc(i,this._parents,t,e)};const{abs:jc,max:zc,min:Gc}=Math;function Bc(t){return{type:t}}function qc(t){return"string"==typeof t?new Oh([[document.querySelector(t)]],[document.documentElement]):new Oh([[t]],Lh)}function Uc(t,e,n){this.k=t,this.x=e,this.y=n}["w","e"].map(Bc),["n","s"].map(Bc),["n","w","e","s","nw","ne","sw","se"].map(Bc),Uc.prototype={constructor:Uc,scale:function(t){return 1===t?this:new Uc(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Uc(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new Uc(1,0,0),Uc.prototype,qc("body"),qc(".main-container");const Zc=qc("#map"),Xc=qc(".loading-container"),Vc=qc(".error-container"),Wc=qc(".welcome-container"),Yc=(qc("header"),qc(".content")),Hc=qc("footer"),$c=qc(".center"),Qc=function(t){return new Oh([document.querySelectorAll(t)],[document.documentElement])}(".side-buttons"),Jc=qc("nav"),td=qc(".fa-bars"),ed=qc(".agency-list"),nd=qc(".feed-progress"),id=qc(".continue");td.on("click",(()=>{"250px"===Jc.style("width")?(td.style("margin-left","20px"),Yc.style("margin-left",0),Hc.style("margin-left",0),Jc.style("width",0)):(td.style("margin-left","270px"),Yc.style("margin-left","250px"),Hc.style("margin-left","250px"),Jc.style("width","250px"))}));const rd=()=>{Wc.style("opacity",0),Xc.style("opacity",0),$c.style("opacity",1),setTimeout((()=>{Qc.style("opacity",1),Yc.style("opacity",1),Hc.style("opacity",1),Zc.style("opacity",1)}),1500)};id.on("click",rd),new class{constructor(){Ts=ms("EPSG:4326");const t=new El({source:new pl});t.on("postrender",(t=>{t.context&&(t.context.globalCompositeOperation="color",t.context.fillStyle="rgba(0,0,0,1)",t.context.fillRect(0,0,t.context.canvas.width,t.context.canvas.height),t.context.globalCompositeOperation="overlay",t.context.fillStyle="rgb("+[200,200,200].toString()+")",t.context.fillRect(0,0,t.context.canvas.width,t.context.canvas.height),t.context.globalCompositeOperation="source-over",t.context.canvas.style.filter="invert(99%)")})),this.map=new Da({target:"map",layers:[t],view:new bo({center:[-122.080796,37.66882],zoom:10}),controls:[]})}},(async()=>{try{const e=new Worker(new URL(t.p+t.u(374),t.b));await new Promise((t=>{e.onmessage=e=>{isNaN(e.data)||nd.text(`Feed ${Math.round(100*e.data)}% downloaded.`),"completed"===e.data&&t()}}));const n=await(new Yn).instance;localStorage.getItem("firstLoad")?rd():setTimeout((()=>{Xc.style("opacity",0),Wc.style("opacity",1),localStorage.setItem("firstLoad",!0)}),1500);const i=await n.agency.toArray();console.log(i),i.forEach((t=>{ed.append("li").append("a").attr("href",t.agency_url).attr("target","_blank").text(t.agency_name)}))}catch(t){console.log(t),Xc.style("opacity",0),Vc.style("opacity",1)}})()}()}();
//# sourceMappingURL=main.js.map