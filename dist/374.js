!function(){"use strict";var e,t,n,r,i,a,o={374:function(e,t,n){n.a(e,(async function(e,t){try{var r=n(6576),i=n(8976),a=n(2712);const e=await(new r.Z).instance;if(self.postMessage("Loaded db-worker.js"),e.needsUpdate){self.postMessage("Running update.");const t=e.agencies.map((async e=>{const t=await fetch(`https://api.511.org/transit/datafeeds?operator_id=${e.Id}&api_key=7cf5660e-215b-489d-87b1-78bb3ee006b7`),n=await t.blob(),r=new a.Nt(n),o=new a.Mr(r),s=(await o.getEntries()).map((async e=>{const t=e.filename.slice(0,e.filename.indexOf(".")),n=new a.Ek,r=await e.getData(n);return[t,(0,i.ueB)(r,i.rA8)]})),c=Object.fromEntries(await Promise.all(s));return await o.close(),[e.Id,c]})),n=Object.fromEntries(await Promise.all(t));if(self.postMessage("Data received."),!e.firstTime){const t=e.tables.map((t=>t.where("agency_id").anyOf(e.agencies.map((e=>e.Id))).delete()));await Promise.all(t),self.postMessage("Cleared tables.")}for(let t in n){const i=n[t];for(let n in i)if(r.Z.TABLES.includes(n)){const a=i[n].map((e=>({id:[t].concat(r.Z.TABLE_MAP[n].map((t=>e[t]))).join("_"),agency_id:t,...e})));e.queue[n]=e.queue[n].concat(a)}}e.queue.LastGenerated=e.agencies.map((e=>(e.id=e.Id,e))),e.totalQueue=Object.values(e.queue).reduce(((e,t)=>e+t.length),0),e.currentQueue=0,e.batchAdd()}postMessage("completed"),t()}catch(e){t(e)}}),1)},6576:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(9520);function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a extends r.ZP{constructor(){super("GTFS"),i(this,"queue",Object.fromEntries(a.TABLES.map((e=>[e,new Array])))),this.instance=this.newInstance()}async newInstance(){const e=await fetch("https://api.511.org/transit/gtfsoperators?api_key=7cf5660e-215b-489d-87b1-78bb3ee006b7");this.agencies=(await e.json()).filter((e=>a.SUPPORTED_AGENCIES.includes(e.Id)));const t=this.agencies.reduce(((e,t)=>e+new Date(t.LastGenerated).getTime()),0);let n,r;try{if(n=await this.open(),r=n.verno,t>r){this.needsUpdate=!0;const e=await n.table("LastGenerated").toArray();this.agencies=this.agencies.filter((t=>!e.find((e=>e.Id===t.Id))||new Date(t.LastGenerated)>new Date(e.find((e=>e.Id===t.Id)).LastGenerated)))}}catch(e){console.log(e),this.firstTime=!0,this.needsUpdate=!0}finally{n&&n.close()}const i=Object.fromEntries(a.TABLES.map((e=>[e,["id"].concat(a.TABLE_MAP[e].includes("agency_id")?[]:["agency_id"]).concat(a.TABLE_MAP[e].length>1?`[${a.TABLE_MAP[e].join("+")}]`:a.TABLE_MAP[e][0]).join(", ")])));return this.version(t).stores(i),await this.open(),this}async batchAdd(e){const t=a.TABLES.find((e=>this.queue[e].length>0)),n=this.queue[t].splice(0,a.PROCESSING_COUNT),r=new Date;console.log(`Writing ${n.length} records to table "${t}"`),await this.table(t).bulkAdd(n);const i=new Date(new Date-r);console.log(`Finished in ${i.getSeconds()} sec, ${i.getMilliseconds()} ms`),this.currentQueue+=n.length,self.postMessage(this.currentQueue/this.totalQueue),Object.values(this.queue).reduce(((e,t)=>e+t.length))>0&&this.batchAdd()}}i(a,"PROCESSING_COUNT",2e5),i(a,"SUPPORTED_AGENCIES",["BA","SC"]),i(a,"TABLE_MAP",{LastGenerated:["Id"],agency:["agency_id"],mtc_feed_versions:["agency_id"],routes:["route_id"],stops:["stop_id"],trips:["trip_id"],areas:["area_id"],shapes:["shape_id","shape_pt_sequence"],levels:["level_id"],calendar:["service_id"],calendar_dates:["service_id","date"],calendar_attributes:["service_id"],directions:["route_id","direction_id"],fare_products:["fare_product_id","fare_media_id"],pathways:["pathway_id"],rider_categories:["rider_category_id"],stop_areas:["area_id","stop_id"],stop_times:["trip_id","stop_sequence"]}),i(a,"TABLES",Object.keys(a.TABLE_MAP))}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return o[e](n,n.exports,c),n.exports}c.m=o,c.x=function(){var e=c.O(void 0,[781],(function(){return c(374)}));return c.O(e)},e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=function(e){e&&!e.d&&(e.d=1,e.forEach((function(e){e.r--})),e.forEach((function(e){e.r--?e.r++:e()})))},c.a=function(i,a,o){var s;o&&((s=[]).d=1);var c,u,f,d=new Set,l=i.exports,p=new Promise((function(e,t){f=t,u=e}));p[t]=l,p[e]=function(e){s&&e(s),d.forEach(e),p.catch((function(){}))},i.exports=p,a((function(i){var a;c=function(i){return i.map((function(i){if(null!==i&&"object"==typeof i){if(i[e])return i;if(i.then){var a=[];a.d=0,i.then((function(e){o[t]=e,r(a)}),(function(e){o[n]=e,r(a)}));var o={};return o[e]=function(e){e(a)},o}}var s={};return s[e]=function(){},s[t]=i,s}))}(i);var o=function(){return c.map((function(e){if(e[n])throw e[n];return e[t]}))},u=new Promise((function(t){(a=function(){t(o)}).r=0;var n=function(e){e!==s&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)))};c.map((function(t){t[e](n)}))}));return a.r?u:o()}),(function(e){e?f(p[n]=e):u(l),r(s)})),s&&(s.d=0)},i=[],c.O=function(e,t,n,r){if(!t){var a=1/0;for(f=0;f<i.length;f++){t=i[f][0],n=i[f][1],r=i[f][2];for(var o=!0,s=0;s<t.length;s++)(!1&r||a>=r)&&Object.keys(c.O).every((function(e){return c.O[e](t[s])}))?t.splice(s--,1):(o=!1,r<a&&(a=r));if(o){i.splice(f--,1);var u=n();void 0!==u&&(e=u)}}return e}r=r||0;for(var f=i.length;f>0&&i[f-1][2]>r;f--)i[f]=i[f-1];i[f]=[t,n,r]},c.d=function(e,t){for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.f={},c.e=function(e){return Promise.all(Object.keys(c.f).reduce((function(t,n){return c.f[n](e,t),t}),[]))},c.u=function(e){return e+".js"},c.miniCssF=function(e){},c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;c.g.importScripts&&(e=c.g.location+"");var t=c.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),c.p=e}(),function(){var e={374:1};c.f.i=function(t,n){e[t]||importScripts(c.p+c.u(t))};var t=self.webpackChunkontime_transit=self.webpackChunkontime_transit||[],n=t.push.bind(t);t.push=function(t){var r=t[0],i=t[1],a=t[2];for(var o in i)c.o(i,o)&&(c.m[o]=i[o]);for(a&&a(c);r.length;)e[r.pop()]=1;n(t)}}(),a=c.x,c.x=function(){return c.e(781).then(a)},c.x()}();
//# sourceMappingURL=374.js.map