{"version":3,"file":"374.js","mappings":"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","sources":["webpack://ontime-transit/webpack/runtime/async module","webpack://ontime-transit/webpack/runtime/chunk loaded","webpack://ontime-transit/webpack/runtime/startup chunk dependencies","webpack://ontime-transit/./src/db-worker.js","webpack://ontime-transit/./src/scripts/transitAccess.js","webpack://ontime-transit/webpack/bootstrap","webpack://ontime-transit/webpack/runtime/define property getters","webpack://ontime-transit/webpack/runtime/ensure chunk","webpack://ontime-transit/webpack/runtime/get javascript chunk filename","webpack://ontime-transit/webpack/runtime/get mini-css chunk filename","webpack://ontime-transit/webpack/runtime/global","webpack://ontime-transit/webpack/runtime/hasOwnProperty shorthand","webpack://ontime-transit/webpack/runtime/publicPath","webpack://ontime-transit/webpack/runtime/importScripts chunk loading","webpack://ontime-transit/webpack/startup"],"sourcesContent":["var webpackQueues = typeof Symbol === \"function\" ? Symbol(\"webpack queues\") : \"__webpack_queues__\";\nvar webpackExports = typeof Symbol === \"function\" ? Symbol(\"webpack exports\") : \"__webpack_exports__\";\nvar webpackError = typeof Symbol === \"function\" ? Symbol(\"webpack error\") : \"__webpack_error__\";\nvar resolveQueue = function(queue) {\n\tif(queue && !queue.d) {\n\t\tqueue.d = 1;\n\t\tqueue.forEach(function(fn) { fn.r--; });\n\t\tqueue.forEach(function(fn) { fn.r-- ? fn.r++ : fn(); });\n\t}\n}\nvar wrapDeps = function(deps) { return deps.map(function(dep) {\n\tif(dep !== null && typeof dep === \"object\") {\n\t\tif(dep[webpackQueues]) return dep;\n\t\tif(dep.then) {\n\t\t\tvar queue = [];\n\t\t\tqueue.d = 0;\n\t\t\tdep.then(function(r) {\n\t\t\t\tobj[webpackExports] = r;\n\t\t\t\tresolveQueue(queue);\n\t\t\t}, function(e) {\n\t\t\t\tobj[webpackError] = e;\n\t\t\t\tresolveQueue(queue);\n\t\t\t});\n\t\t\tvar obj = {};\n\t\t\tobj[webpackQueues] = function(fn) { fn(queue); };\n\t\t\treturn obj;\n\t\t}\n\t}\n\tvar ret = {};\n\tret[webpackQueues] = function() {};\n\tret[webpackExports] = dep;\n\treturn ret;\n}); };\n__webpack_require__.a = function(module, body, hasAwait) {\n\tvar queue;\n\thasAwait && ((queue = []).d = 1);\n\tvar depQueues = new Set();\n\tvar exports = module.exports;\n\tvar currentDeps;\n\tvar outerResolve;\n\tvar reject;\n\tvar promise = new Promise(function(resolve, rej) {\n\t\treject = rej;\n\t\touterResolve = resolve;\n\t});\n\tpromise[webpackExports] = exports;\n\tpromise[webpackQueues] = function(fn) { queue && fn(queue), depQueues.forEach(fn), promise[\"catch\"](function() {}); };\n\tmodule.exports = promise;\n\tbody(function(deps) {\n\t\tcurrentDeps = wrapDeps(deps);\n\t\tvar fn;\n\t\tvar getResult = function() { return currentDeps.map(function(d) {\n\t\t\tif(d[webpackError]) throw d[webpackError];\n\t\t\treturn d[webpackExports];\n\t\t}); }\n\t\tvar promise = new Promise(function(resolve) {\n\t\t\tfn = function() { resolve(getResult); };\n\t\t\tfn.r = 0;\n\t\t\tvar fnQueue = function(q) { q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, q.push(fn))); };\n\t\t\tcurrentDeps.map(function(dep) { dep[webpackQueues](fnQueue); });\n\t\t});\n\t\treturn fn.r ? promise : getResult();\n\t}, function(err) { (err ? reject(promise[webpackError] = err) : outerResolve(exports)), resolveQueue(queue); });\n\tqueue && (queue.d = 0);\n};","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = function() {\n\treturn __webpack_require__.e(781).then(next);\n};","import TransitAccess from \"./scripts/transitAccess\";\nimport { csvParse, autoType } from 'd3';\nimport { ZipReader, BlobReader, TextWriter } from \"@zip.js/zip.js\";\n\nconst access = await new TransitAccess().instance;\nself.postMessage('Loaded db-worker.js');\n\nif (access.needsUpdate) {\n    self.postMessage('Running update.');\n\n    const agencyPromises = access.agencies.map(async agency => {\n        const agencyGTFSZip = await fetch(`https://api.511.org/transit/datafeeds?operator_id=${agency['Id']}&api_key=7cf5660e-215b-489d-87b1-78bb3ee006b7`)\n        const agencyGTFSBlob = await agencyGTFSZip.blob();\n        const agencyGTFSZipFileReader = new BlobReader(agencyGTFSBlob);\n        const agencyGTFSZipReader = new ZipReader(agencyGTFSZipFileReader);\n        const agencyGTFSEntries = await agencyGTFSZipReader.getEntries();\n        const entryPromises = agencyGTFSEntries.map(async entry => {\n            const name = entry.filename.slice(0, entry.filename.indexOf('.'));\n            const writer = new TextWriter();\n            const text = await entry.getData(writer);\n            const parsed = csvParse(text, autoType);\n            return [name, parsed];\n        });\n\n        const entries = Object.fromEntries(await Promise.all(entryPromises));\n        await agencyGTFSZipReader.close();\n\n        return [agency['Id'], entries];\n    });\n\n    const data = Object.fromEntries(await Promise.all(agencyPromises));\n    self.postMessage('Data received.');\n\n    if (!access.firstTime) {\n        const clearTables = access.tables.map(table => table.where('agency_id').anyOf(access.agencies.map(agency => agency['Id'])).delete());\n        await Promise.all(clearTables);\n        self.postMessage('Cleared tables.')\n    }\n    \n    for (let agency_id in data) {\n        const agency = data[agency_id];\n        for (let table in agency) {\n            if (TransitAccess.TABLES.includes(table)) {\n                const records = agency[table].map(record => {\n                    return { \n                        id: [ agency_id ].concat(TransitAccess.TABLE_MAP[table].map(id => record[id])).join('_'),\n                        agency_id,\n                        ...record \n                    } \n                });\n    \n                access.queue[table] = access.queue[table].concat(records);\n            }\n        }\n    }\n\n    access.queue['LastGenerated'] = access.agencies.map(agency => {\n        agency.id = agency.Id;\n        return agency;\n    });\n\n    access.totalQueue = Object.values(access.queue).reduce((acc, arr) => acc + arr.length, 0);\n    access.currentQueue = 0;\n    \n    access.batchAdd();\n}\n\npostMessage('completed');","import Dexie from 'dexie';\n\nexport default class TransitAccess extends Dexie {\n    queue = Object.fromEntries(TransitAccess.TABLES.map(table => [table, new Array()]));\n\n    static PROCESSING_COUNT = 200000;\n    static SUPPORTED_AGENCIES = ['BA', 'SC'];\n    static TABLE_MAP = {\n        'LastGenerated': ['Id'],\n        'agency': ['agency_id'],\n        'mtc_feed_versions': ['agency_id'],\n        'routes': ['route_id'],\n        // 'route_attributes': ['route_id'],\n        'stops': ['stop_id'],\n        'trips': ['trip_id'],\n        'areas': ['area_id'],\n        'shapes': ['shape_id', 'shape_pt_sequence'],\n        'levels': ['level_id'],\n        'calendar': ['service_id'],\n        'calendar_dates': ['service_id', 'date'],\n        'calendar_attributes': ['service_id'],\n        'directions': ['route_id', 'direction_id'],\n        'fare_products': ['fare_product_id', 'fare_media_id'],\n        'pathways': ['pathway_id'],\n        'rider_categories': ['rider_category_id'],\n        'stop_areas': ['area_id', 'stop_id'],\n        'stop_times': ['trip_id', 'stop_sequence'],\n    }\n\n    static TABLES = Object.keys(this.TABLE_MAP);\n\n    constructor() {\n        super(\"GTFS\");\n        this.instance = this.newInstance();\n    }\n\n    async newInstance() {\n        const agenciesData = await fetch('https://api.511.org/transit/gtfsoperators?api_key=7cf5660e-215b-489d-87b1-78bb3ee006b7');\n        this.agencies = (await agenciesData.json()).filter(agency => TransitAccess.SUPPORTED_AGENCIES.includes(agency['Id']));\n        const version = this.agencies.reduce((acc, agency) => acc + new Date(agency['LastGenerated']).getTime(), 0);\n\n        let openedDb;\n        let verno;\n        try {\n            openedDb = await this.open();\n            verno = openedDb.verno;\n            if (version > verno) {\n                this.needsUpdate = true;\n                const lastGenerated = await openedDb.table('LastGenerated').toArray();\n                // console.log(new Date(this.agencies[0]['LastGenerated']) > new Date(lastGenerated.find(obj => obj['Id'] === this.agencies[0]['Id'])['LastGenerated']))\n                this.agencies = this.agencies.filter(agency => !lastGenerated.find(obj => obj['Id'] === agency['Id']) || new Date(agency['LastGenerated']) > new Date(lastGenerated.find(obj => obj['Id'] === agency['Id'])['LastGenerated']));\n            }\n        } catch(e) {\n            console.log(e)\n            this.firstTime = true;\n            this.needsUpdate = true;\n        } finally {\n            if (openedDb) openedDb.close();\n        }\n        // throw new Error();\n        \n        const schema = Object.fromEntries(TransitAccess.TABLES.map(table => [ table, ['id'].concat(TransitAccess.TABLE_MAP[table].includes('agency_id') ? [] : [ 'agency_id' ]).concat(TransitAccess.TABLE_MAP[table].length > 1 ? `[${TransitAccess.TABLE_MAP[table].join('+')}]` : TransitAccess.TABLE_MAP[table][0]).join(', ') ]));\n        \n        this.version(version).stores(schema);\n        await this.open();\n\n        return this;\n    }\n\n    async batchAdd(func) {\n        const currentTable = TransitAccess.TABLES.find(table => this.queue[table].length > 0);\n        const batch = this.queue[currentTable].splice(0, TransitAccess.PROCESSING_COUNT);\n        const startTime = new Date();\n        console.log(`Writing ${batch.length} records to table \"${currentTable}\"`);\n        await this.table(currentTable).bulkAdd(batch);\n        const timeElapsed = new Date(new Date() - startTime);\n        console.log(`Finished in ${timeElapsed.getSeconds()} sec, ${timeElapsed.getMilliseconds()} ms`);\n        this.currentQueue += batch.length;\n        self.postMessage(this.currentQueue / this.totalQueue);\n        if (Object.values(this.queue).reduce((acc, queue) => acc + queue.length) > 0) this.batchAdd();\n    }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = function() {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [781], function() { return __webpack_require__(374); })\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = function(chunkId) {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t374: 1\n};\n\n// importScripts chunk loading\nvar installChunk = function(data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = function(chunkId, promises) {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkontime_transit\"] = self[\"webpackChunkontime_transit\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["webpackQueues","webpackExports","webpackError","resolveQueue","deferred","next","access","TransitAccess","instance","self","postMessage","needsUpdate","agencyPromises","agencies","map","async","agencyGTFSZip","fetch","agency","agencyGTFSBlob","blob","agencyGTFSZipFileReader","BlobReader","agencyGTFSZipReader","ZipReader","entryPromises","getEntries","name","entry","filename","slice","indexOf","writer","TextWriter","text","getData","csvParse","autoType","entries","Object","fromEntries","Promise","all","close","data","firstTime","clearTables","tables","table","where","anyOf","delete","agency_id","records","record","id","concat","join","queue","Id","totalQueue","values","reduce","acc","arr","length","currentQueue","batchAdd","Dexie","constructor","super","_defineProperty","TABLES","Array","this","newInstance","agenciesData","json","filter","SUPPORTED_AGENCIES","includes","version","Date","getTime","openedDb","verno","open","lastGenerated","toArray","find","obj","e","console","log","schema","TABLE_MAP","stores","func","currentTable","batch","splice","PROCESSING_COUNT","startTime","bulkAdd","timeElapsed","getSeconds","getMilliseconds","keys","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","x","__webpack_exports__","O","Symbol","d","forEach","fn","r","a","body","hasAwait","currentDeps","outerResolve","reject","depQueues","Set","promise","resolve","rej","deps","dep","then","ret","wrapDeps","getResult","fnQueue","q","has","add","push","err","result","chunkIds","priority","notFulfilled","Infinity","i","fulfilled","j","every","key","definition","o","defineProperty","enumerable","get","f","chunkId","promises","u","miniCssF","g","globalThis","Function","window","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","Error","replace","p","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","bind","moreModules","runtime","pop"],"sourceRoot":""}